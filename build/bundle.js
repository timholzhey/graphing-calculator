(()=>{"use strict";var e={85:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDomain=t.canvasDrawFunction=t.driveCanvas=t.canvasDraw=t.resetCanvas=t.getOffset=t.getScale=t.canvasGetImageDataURL=t.canvasFreezeFrame=t.enablePreview=t.initCanvas=t.mainCanvas=void 0;const r=n(283),o=n(607),a=n(750),i=n(984),l=n(99),s=n(533),u=n(195);t.mainCanvas=document.getElementById("main-canvas");const c=t.mainCanvas.getContext("2d"),E=document.querySelector(".zoom-in-button"),g=document.querySelector(".zoom-out-button"),f=document.querySelector(".fps-display"),T=document.getElementById("app"),h=new r.Vector(0,0);let d=1;const M=16,p=new r.Vector(0,0),m=new r.Vector(0,0);let k=!1,L=!0,I="";const R=function(e){const t=(d*(e>0?1+.2*e:1/(1-.2*e))-d)/10;let n=0;const r=setInterval((function(){d+=t,(0,o.scheduleRedraw)(),n++,n>=10&&clearInterval(r)}),10)};t.initCanvas=function(){t.mainCanvas.addEventListener("mousedown",(function(e){p.set(h.x,h.y),m.set(e.clientX,e.clientY),k=!0})),(0,a.onMouseDrag)(t.mainCanvas,(e=>{k&&(h.x=p.x+e.x-m.x,h.y=p.y+e.y-m.y,(0,o.scheduleRedraw)())})),t.mainCanvas.addEventListener("mouseup",(()=>{k=!1})),t.mainCanvas.addEventListener("mouseleave",(()=>{k=!1})),t.mainCanvas.addEventListener("wheel",(e=>{!function(e){const t=e>0?1+.2*e:1/(1-.2*e);d*=t,h.x*=t,h.y*=t,(0,o.scheduleRedraw)()}(-e.deltaY/200)})),E.addEventListener("click",(()=>{R(1)})),g.addEventListener("click",(()=>{R(-1)})),(0,l.bindExternVariable)("scale",(()=>d),(e=>{d=e,(0,o.scheduleRedraw)()})),(0,l.bindExternVariable)("grid",(()=>L?1:0),(e=>{L=e>0,(0,o.scheduleRedraw)()})),(0,l.bindExternVariable)("offset",(()=>[h.x,h.y]),(e=>{A(e[0],e[1]),(0,o.scheduleRedraw)()})),window.onresize=()=>(0,o.scheduleRedraw)();const e=new URLSearchParams(window.location.search),n=e.get("plot"),r=e.get("scale"),i=e.get("preview");return n&&(0,s.loadPlots)(n.split(";"),[]),r&&(d=parseFloat(r)),!(!i||"true"!==i||((0,t.enablePreview)(),T.classList.add("preview"),0))},t.enablePreview=function(){L=!1,T.classList.add("fullscreen"),(0,o.scheduleRedraw)(),setTimeout((()=>{(0,o.scheduleSnapshot)(),(0,o.scheduleExit)()}),100)},t.canvasFreezeFrame=function(){const e=document.getElementById("shader-canvas");if(!c)return;c.drawImage(e,0,0,t.mainCanvas.width,t.mainCanvas.height);const n=document.createElement("img");n.src=t.mainCanvas.toDataURL("image/png"),I=n.src,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.objectFit="cover",document.body.appendChild(n)},t.canvasGetImageDataURL=()=>I;const A=function(e,n){h.x=-e*(t.mainCanvas.width/M),h.y=n*(t.mainCanvas.height/M)};t.getScale=()=>d,t.getOffset=()=>h,t.resetCanvas=function(){d=1,h.set(0,0),L=!0,(0,o.scheduleRedraw)()},t.canvasDraw=function(){c&&(t.mainCanvas.width=t.mainCanvas.clientWidth,t.mainCanvas.height=t.mainCanvas.clientHeight,c.clearRect(0,0,t.mainCanvas.width,t.mainCanvas.height),v())},t.driveCanvas=function(){f.innerHTML=(0,o.getFPSSmoothed)().toFixed(0)};const S=function(e,t,n,r){c&&(c.beginPath(),c.moveTo(e,t),c.lineTo(n,r),c.stroke())},v=function(){if(!c||!L)return;const e=t.mainCanvas.width,n=t.mainCanvas.height,r=e/n;c.strokeStyle="#fff",c.lineWidth=2,S(e/2+h.x,0,e/2+h.x,n),S(0,n/2+h.y,e,n/2+h.y);const o=Math.pow(2,Math.floor(Math.log(d)/Math.log(2))),a=n/M/o*d;let i=-Math.floor(M/d/2*o)/o-Math.floor(h.y/a)/o-(h.y<0?1/o:0)-1/o;const l=(n%(2*a)-2*a)/2,s=h.y%a;for(let t=0;t<n+2*a;t+=a,i+=1/o)c.strokeStyle="#666",c.lineWidth=.5,S(0,t+l+s,e,t+l+s),c.strokeStyle="transparent",c.fillStyle="#fff",c.textAlign="right",0!==i&&(c.beginPath(),c.fillText((-i).toString(),e/2+h.x-10,t+l+s+4));const u=e/M/o/r*d;let E=-Math.floor(M/d/2*o*r)/o-Math.floor(h.x/u)/o-(h.x<0?1/o:0)-1/o;const g=(e%(2*u)-2*u)/2,f=h.x%u;for(let t=0;t<e+u;t+=u,E+=1/o)c.strokeStyle="#666",c.lineWidth=.5,S(t+g+f,0,t+g+f,n),c.strokeStyle="transparent",c.fillStyle="#fff",c.textAlign="center",0!==E?(c.beginPath(),c.fillText(E.toString(),t+g+f,n/2+h.y+20)):(c.beginPath(),c.fillText((-E).toString(),t+g+f-18,n/2+h.y+20))};t.canvasDrawFunction=function(e,n,o){if(!c||!e)return;if(o===u.PlotDisplayMode.VECTOR_FIELD)return void function(e,n){if(!c||!e)return;const o=t.mainCanvas.width,a=t.mainCanvas.height,l=o/a;c.strokeStyle=n,c.lineWidth=3,c.fillStyle="transparent",c.beginPath();const s=o/M/l*d,u=h.x/s,E=a/M*d,g=h.y/E;for(let t=-8.5/d+g;t<8/d+g;t+=1/d)for(let s=-8*l/d-u;s<8*l/d-u;s+=1/d){const u=(0,i.constantEvalXY)(e,s,t);if(!(0,r.isIterable)(u))return;const E=u,g=new r.Vector(E[0],E[1]);if(g.mult(d*c.lineWidth),g.mag()>50&&g.setMag(50),g.y*=-1,(0,i.constantEvalGetError)())return;const f=(0,r.map)(s,-8*l/d,8*l/d,0,o)+h.x,T=(0,r.map)(t,-8.5/d,8/d,a,0)+h.y,M=f+g.x,p=T+g.y;c.moveTo(f,T),c.lineTo(M,p);const m=g.copy().mult(.7),k=new r.Vector(f,T).add(m),L=new r.Vector(M,p),I=3.141592653589,R=k.copy().add(m.copy().rotate(I/2).mult(.1)),A=k.copy().add(m.copy().rotate(-I/2).mult(.1));c.fillStyle=n,c.moveTo(L.x,L.y),c.lineTo(R.x,R.y),c.lineTo(A.x,A.y),c.lineTo(L.x,L.y),c.fillStyle="transparent"}c.stroke()}(e,n);const a=t.mainCanvas.width,l=t.mainCanvas.height,s=a/l;c.strokeStyle=n,c.lineWidth=2.5,c.fillStyle="transparent",c.beginPath();const E=a/M/s*d,g=h.x/E;let f=!0;for(let t=-8*s/d-g;t<8*s/d-g;t+=.01/d){const n=(0,i.constantEvalX)(e,t),o="number"==typeof n?n:n.re;if((0,i.constantEvalGetError)())return;const u=(0,r.map)(t,-8*s/d,8*s/d,0,a)+h.x,E=(0,r.map)(o,-8/d,8/d,l,0)+h.y;f&&(c.moveTo(u,E),f=!1),c.lineTo(u,E)}c.stroke()},t.getDomain=function(){const e=t.mainCanvas.width,n=t.mainCanvas.height,r=e/n,o=e/M/r*d,a=h.x/o,i=-8*r/d-a,l=8*r/d-a,s=n/M*d,u=h.y/s;return{minX:i,maxX:l,minY:-8/d+u,maxY:8/d+u}}},984:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.constantEvalGetError=t.constantEvalXY=t.constantEvalX=t.constantEval=void 0;const r=n(607),o=n(99),a=n(750),i=n(283);let l,s,u=null,c=0,E=1;t.constantEval=function(e){return e?(u=null,c=0,E=1,f(e)):0},t.constantEvalX=function(e,n){l=n;const r=(0,t.constantEval)(e);return l=null,r},t.constantEvalXY=function(e,n,r){l=n,s=r;const o=(0,t.constantEval)(e);return l=null,s=null,o};const g=function(e){return console.error("Error during constant evaluation: "+e),u=e,0};t.constantEvalGetError=()=>u;const f=function(e){var t,n;let u,T;switch(e.op.tok){case o.Token.UNDEF:return g("Token UNDEFINED is not allowed");case o.Token.NONE:return 0;case o.Token.PAREN_OP:return g("Token OPEN PARENTHESIS is not allowed");case o.Token.PAREN_CL:return g("Token CLOSE PARENTHESIS is not allowed");case o.Token.BRACKET_OP:return g("Token OPEN BRACKET is not allowed");case o.Token.BRACKET_CL:return g("Token CLOSE BRACKET is not allowed");case o.Token.BRACE_OP:return g("Token OPEN BRACE is not allowed");case o.Token.BRACE_CL:return g("Token CLOSE BRACE is not allowed");case o.Token.NUM:return"number"!=typeof e.op.val?g("Token NUMBER must be a number"):(0,i.cpx)(e.op.val);case o.Token.CONST:return"number"!=typeof e.op.val?g("Token CONSTANT must be a number"):(0,i.cpx)(e.op.val);case o.Token.VAR:return null==l?g("Token VARIABLE is not defined"):(0,i.cpx)(l);case o.Token.VAR2:return null==s?g("Token VARIABLE2 is not defined"):(0,i.cpx)(s);case o.Token.TIME:return(0,r.scheduleRedraw)(),(0,i.cpx)((0,r.getGlobalTime)());case o.Token.ADD:return null==e.left||null==e.right?g("Missing arguments for Token ADDITION"):(u=f(e.left),T=f(e.right),{re:u.re+T.re,im:u.im+T.im});case o.Token.SUB:return null==e.left||null==e.right?g("Missing arguments for Token SUBTRACTION"):(u=f(e.left),T=f(e.right),{re:u.re-T.re,im:u.im-T.im});case o.Token.MULT:return null==e.left||null==e.right?g("Missing arguments for Token MULTIPLICATION"):(u=f(e.left),T=f(e.right),0===u.im&&0===T.im?(0,i.cpx)(u.re*T.re):{re:u.re*T.re-u.im*T.im,im:u.re*T.im+u.im*T.re});case o.Token.DIV:{if(null==e.left||null==e.right)return g("Missing arguments for Token DIVISION");if(u=f(e.left),T=f(e.right),0===T.re&&0===T.im)return g("Division by zero");if(0===u.im&&0===T.im)return(0,i.cpx)(u.re/T.re);const t=T.re*T.re+T.im*T.im;return{re:(u.re*T.re+u.im*T.im)/t,im:(u.im*T.re-u.re*T.im)/t}}case o.Token.POW:{if(null==e.left||null==e.right)return g("Missing arguments for Token POWER");if(u=f(e.left),T=f(e.right),0===u.im&&0===T.im)return(0,i.cpx)(Math.pow(u.re,T.re));if(0!==T.im)return g("Imaginary power is not allowed");const t=Math.sqrt(u.re*u.re+u.im*u.im),n=Math.atan2(u.im,u.re),r=Math.pow(t,T.re),o=T.re*n;return{re:r*Math.cos(o),im:r*Math.sin(o)}}case o.Token.SQRT:return null==e.right?g("Missing argument for Token SQUARE ROOT"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.sqrt(T.re)):g("SQUARE ROOT is not defined for complex numbers"));case o.Token.LOG:return null==e.right?g("Missing argument for Token LOGARITHM"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.log(T.re)):g("LOGARITHM is not defined for complex numbers"));case o.Token.EXP:return null==e.right?g("Missing argument for Token EXPOENTIAL"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.exp(T.re)):{re:Math.exp(T.re)*Math.cos(T.im),im:Math.exp(T.re)*Math.sin(T.im)});case o.Token.SIN:return null==e.right?g("Missing argument for Token SINE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.sin(T.re)):{re:Math.sin(T.re)*Math.cosh(T.im),im:Math.cos(T.re)*Math.sinh(T.im)});case o.Token.COS:return null==e.right?g("Missing argument for Token COSINE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.cos(T.re)):{re:Math.cos(T.re)*Math.cosh(T.im),im:-Math.sin(T.re)*Math.sinh(T.im)});case o.Token.TAN:return null==e.right?g("Missing argument for Token TANGENT"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.tan(T.re)):{re:Math.sin(2*T.re)/(Math.cos(2*T.re)+Math.cosh(2*T.im)),im:Math.sinh(2*T.im)/(Math.cos(2*T.re)+Math.cosh(2*T.im))});case o.Token.ASIN:return null==e.right?g("Missing argument for Token ARC SINE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.asin(T.re)):{re:Math.log(T.re+Math.sqrt(1-T.re*T.re)),im:Math.sign(T.im)*Math.sqrt(1-T.re*T.re)});case o.Token.SINH:return null==e.right?g("Missing argument for Token SINE HYPERBOLICUS"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.sinh(T.re)):{re:Math.cosh(T.re)*Math.cos(T.im),im:Math.sinh(T.re)*Math.sin(T.im)});case o.Token.COSH:return null==e.right?g("Missing argument for Token COSINE HYPERBOLICUS"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.cosh(T.re)):{re:Math.cosh(T.re)*Math.cos(T.im),im:Math.sinh(T.re)*Math.sin(T.im)});case o.Token.TANH:return null==e.right?g("Missing argument for Token TANGENT HYPERBOLICUS"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.tanh(T.re)):{re:Math.cosh(2*T.re)/(Math.cos(2*T.re)+Math.cosh(2*T.im)),im:Math.sinh(2*T.im)/(Math.cos(2*T.re)+Math.cosh(2*T.im))});case o.Token.ACOS:return null==e.right?g("Missing argument for Token ARC COSINE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.acos(T.re)):{re:Math.log(T.re+Math.sqrt(1-T.re*T.re)),im:-Math.sign(T.im)*Math.sqrt(1-T.re*T.re)});case o.Token.ATAN:return null==e.right?g("Missing argument for Token ARC TANGENT"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.atan(T.re)):{re:Math.atan(T.re/T.im),im:Math.log((1+T.im)/(1-T.im))/2});case o.Token.FLOOR:return null==e.right?g("Missing argument for Token FLOOR"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.floor(T.re)):g("FLOOR is not defined for complex numbers"));case o.Token.MIN:{if(null==e.right)return g("Missing argument for Token MIN");if(!(0,i.isIterable)(f(e.right)))return g("Malformed argument for Token MIN");const t=[...f(e.right)];return(0,i.cpx)(Math.min(...t))}case o.Token.MAX:{if(null==e.right)return g("Missing argument for Token MAX");if(!(0,i.isIterable)(f(e.right)))return g("Malformed argument for Token MAX");const t=[...f(e.right)];return(0,i.cpx)(Math.max(...t))}case o.Token.DELIM:{if(null==e.left||null==e.right)return g("Missing arguments for Token DELIMITER");u=f(e.left),T=f(e.right);const t=[];return"number"==typeof(null==u?void 0:u.re)?t.push(null==u?void 0:u.re):t.concat(null==u?void 0:u.re),"number"==typeof(null==T?void 0:T.re)?t.push(null==T?void 0:T.re):t.concat(null==T?void 0:T.re),t}case o.Token.ABS:return null==e.right?g("Missing argument for Token ABSOLUTE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.abs(T.re)):(0,i.cpx)(Math.sqrt(T.re*T.re+T.im*T.im)));case o.Token.RAND:return null==e.right?g("Missing argument for Token RANDOM"):(0,i.cpx)(Math.random()*f(e.right));case o.Token.PERLIN:{if(null==e.right)return g("Missing arguments for Token PERLIN");if(!(0,i.isIterable)(f(e.right)))return g("Malformed argument for Token PERLIN");const[t,n]=f(e.right);return(0,i.cpx)((0,i.perlin2)(t,n))}case o.Token.MOD:return null==e.left||null==e.right?g("Missing arguments for Token MODULUS"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re%T.re):g("MODULUS is not defined for complex numbers"));case o.Token.LEVEL_SET:return g("Token LEVEL SET is not allowed");case o.Token.VECTOR_FIELD:return null==e.right?g("Missing argument for Token VECTOR FIELD"):f(e.right);case o.Token.LESS:return null==e.left||null==e.right?g("Missing arguments for Token LESS THAN"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re<T.re?1:0):g("LESS THAN is not defined for complex numbers"));case o.Token.GREATER:return null==e.left||null==e.right?g("Missing arguments for Token GREATER THAN"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re>T.re?1:0):g("GREATER THAN is not defined for complex numbers"));case o.Token.LESS_OR_EQUAL:return null==e.left||null==e.right?g("Missing arguments for Token LESS THAN OR EQUAL TO"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re<=T.re?1:0):g("LESS THAN OR EQUAL TO is not defined for complex numbers"));case o.Token.GREATER_OR_EQUAL:return null==e.left||null==e.right?g("Missing arguments for Token GREATER THAN OR EQUAL TO"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re>=T.re?1:0):g("GREATER THAN OR EQUAL TO is not defined for complex numbers"));case o.Token.EQUAL:return null==e.left||null==e.right?g("Missing arguments for Token EQUAL TO"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(Math.abs(u.re-T.re)<1e-10?1:0):(0,i.cpx)(Math.abs(u.re-T.re)<1e-10&&Math.abs(u.im-T.im)<1e-10?1:0));case o.Token.AND:return null==e.left||null==e.right?g("Missing arguments for Token AND"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re&&T.re?1:0):g("AND is not defined for complex numbers"));case o.Token.OR:return null==e.left||null==e.right?g("Missing arguments for Token OR"):(u=f(e.left),T=f(e.right),0===T.im?(0,i.cpx)(u.re||T.re?1:0):g("OR is not defined for complex numbers"));case o.Token.USERVAR:return(0,i.cpx)((0,o.getUserVariable)(e.op.val));case o.Token.FACTORIAL:return null==e.right?g("Missing argument for Token FACTORIAL"):(T=f(e.right),0===T.im?(0,i.cpx)((0,i.factorial)(T.re)):g("FACTORIAL is not defined for complex numbers"));case o.Token.SIGMOID:return null==e.right?g("Missing argument for Token SIGMOID"):(T=f(e.right),0===T.im?(0,i.cpx)((0,i.sigmoid)(T.re)):g("SIGMOID is not defined for complex numbers"));case o.Token.CIRCLE:return g("Token CIRCLE is not allowed");case o.Token.POINT:return g("Token POINT is not allowed");case o.Token.TRUE:return(0,i.cpx)(1);case o.Token.FALSE:return(0,i.cpx)(0);case o.Token.POLAR:return g("Token POLAR is not allowed");case o.Token.CARTESIAN:return g("Token CARTESIAN is not allowed");case o.Token.MOUSEX:return(0,i.cpx)((0,a.getMousePos)().x);case o.Token.MOUSEY:return(0,i.cpx)((0,a.getMousePos)().y);case o.Token.MOUSE:return[(0,a.getMousePos)().x,(0,a.getMousePos)().y];case o.Token.IMAGINARY:return{re:0,im:1};case o.Token.SERIES:{if(null==e.right||null==e.right.left||null==e.right.right||null==e.right.left.left||null==e.right.left.right)return g("Missing argument for Token SERIES");const t=f(e.right.left.left).re,n=f(e.right.left.right).re,r=e.right.right;for(c=t;E<=n;E++)c=f(r).re;return(0,i.cpx)(c)}case o.Token.DIV_SERIES:return g("Token SERIES not implemented");case o.Token.ITERATOR:return(0,i.cpx)(c);case o.Token.INDEX:return(0,i.cpx)(E);case o.Token.COMPLEX:return g("Token COMPLEX is not allowed");case o.Token.GRADIENT:return g("Token GRADIENT is not allowed");case o.Token.MAGNITUDE:return null==e.right?g("Missing argument for Token MAGNITUDE"):(T=f(e.right),0===T.im?(0,i.cpx)(Math.abs(T.re)):null==e.right?g("Missing argument for Token SIGMOID"):(0,i.cpx)(Math.sqrt(T.re*T.re+T.im*T.im)));case o.Token.ASSIGN:return null==e.left||null==e.right?g("Missing arguments for Token ASSIGN"):e.left.op.tok!==o.Token.ASSIGNABLE?e.left.op.tok===o.Token.USERVAR?((0,o.setUserVariable)(e.left.op.val,f(e.right).re),f(e.right)):g("Left side of ASSIGN must be assignable"):null==(0,o.getExternVariable)(e.left.op.val)?g(`Variable ${e.left.op.val} does not exist`):(T=f(e.right),null===(t=(0,o.getExternVariable)(e.left.op.val))||void 0===t||t.set((null==T?void 0:T.re)?T.re:T),f(e.right));case o.Token.ASSIGNABLE:{if(null==(0,o.getExternVariable)(e.op.val))return g(`Variable ${e.op.val} does not exist`);const t=null===(n=(0,o.getExternVariable)(e.op.val))||void 0===n?void 0:n.get();return(0,i.isIterable)(t)?t:(0,i.cpx)(t)}default:return g(`Unknown token ${e.op.tok}`)}}},533:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPlotsShaderInfo=t.drawPlots=t.drivePlots=t.loadPlots=t.resetPlots=t.setNumInputs=t.setInputAt=void 0;const r=n(607),o=n(85),a=n(195),i=n(103),l=n(849),s=n(320),u=n(984),c=[];let E=0;t.setInputAt=(e,t)=>{e<0||e>E||(c[e]||(c[e]=f(e),(0,s.inputSetColorAt)(e,c[e].color)),c[e].input=t,c[e].inputChanged=!0,(0,r.scheduleRedraw)())},t.setNumInputs=e=>{E=e;for(let e=E;e<c.length;e++)delete c[e];(0,r.scheduleRedraw)()},t.resetPlots=()=>{c.length=0,(0,r.scheduleRedraw)()};const g=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];t.loadPlots=function(e,n){(0,o.resetCanvas)(),(0,s.resetInputs)(),(0,t.setNumInputs)(n.length);for(let e=0;e<n.length;e++)(0,s.addNewInputWithValue)(n[e]);(0,t.drivePlots)(),(0,t.drawPlots)(),(0,s.resetInputs)(),(0,t.setNumInputs)(e.length);for(let t=0;t<e.length;t++)(0,s.addNewInputWithValue)(e[t])};const f=function(e){return{input:"",inputChanged:!1,ast:null,status:a.PlotStatus.PENDING,driver:a.PlotDriver.CANVAS,displayMode:a.PlotDisplayMode.NONE,shaderFunction:"",continuous:!1,color:(t=e,g[(t-1)%g.length]),error:"",iterExpr:""};var t};t.drivePlots=()=>{let e=!1;for(let t=1;t<=E;t++){c[t]||(c[t]=f(t),(0,s.inputSetColorAt)(t,c[t].color));const n=c[t];if(n.inputChanged){e=!0,n.inputChanged=!1;const o=n.status;if(0===n.input.trim().length){n.status=a.PlotStatus.PENDING,n.ast=null,o!==n.status&&(0,s.inputSetStatusAt)(t,n.status),(0,r.scheduleRedraw)();continue}const u=n.ast;n.ast=(0,i.parse)(n.input),console.debug("Parsed AST:",n.ast);const c=n.error,E=(0,i.parserGetError)();E?(n.status=a.PlotStatus.ERROR,n.error=E.desc):(n.status=a.PlotStatus.ACTIVE,n.error=""),JSON.stringify(u)!==JSON.stringify(n.ast)&&(0,r.scheduleRedraw)();const g=(0,i.parserGetDriver)();if(n.driver!==g&&(n.driver=g,(0,s.inputSetDriverAt)(t,g)),n.displayMode=(0,i.parserGetDisplayMode)(),n.driver===a.PlotDriver.WEBGL){n.shaderFunction=(0,l.buildShaderFunction)(n.ast)||"undefined",n.iterExpr=(0,l.shaderFunctionBuilderGetIterExpression)();const e=(0,l.shaderFunctionBuilderGetError)();e&&(n.status=a.PlotStatus.ERROR,n.error=e)}n.continuous=(0,i.parserGetContinuous)(),n.status!==o&&(0,s.inputSetStatusAt)(t,n.status),n.error!==c&&(0,s.inputSetErrorAt)(t,n.error)}}if(e){const e=[];for(let t=1;t<=E;t++)e.push(c[t].input);let t="?";t+="plot="+e.map((e=>encodeURIComponent(e))).join(";");const n=(0,o.getScale)();1!==n&&(t+="&scale="+n),window.history.pushState("","",t)}},t.drawPlots=()=>{for(let e=1;e<=E;e++){const t=c[e];if(t&&t.status===a.PlotStatus.ACTIVE){switch(t.driver){case a.PlotDriver.CONSTANT:{const n=(0,u.constantEval)(t.ast);(0,s.inputSetConstEvalAt)(e,n);const r=(0,u.constantEvalGetError)();r&&(t.status=a.PlotStatus.ERROR,t.error=r,(0,s.inputSetStatusAt)(e,t.status),(0,s.inputSetErrorAt)(e,t.error));break}case a.PlotDriver.CANVAS:{(0,o.canvasDrawFunction)(t.ast,t.color,t.displayMode);const n=(0,u.constantEvalGetError)();n&&(t.status=a.PlotStatus.ERROR,t.error=n,(0,s.inputSetStatusAt)(e,t.status),(0,s.inputSetErrorAt)(e,t.error));break}case a.PlotDriver.WEBGL:break;default:console.error("Unhandled plot driver")}t.continuous&&(0,r.scheduleRedraw)()}}},t.getPlotsShaderInfo=()=>{const e=[],t=[],n=[],r=[];let o=0;for(let i=1;i<=E;i++){const l=c[i];l&&l.driver===a.PlotDriver.WEBGL&&l.status===a.PlotStatus.ACTIVE&&l.driver===a.PlotDriver.WEBGL&&(e.push(l.shaderFunction),t.push(l.color),n.push(l.displayMode),r.push(l.iterExpr),o++)}return{functions:e,colors:t,displayModes:n,numPlots:o,iterExpr:r}}},195:(e,t)=>{var n,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PlotDriver=t.PlotStatus=t.PlotDisplayMode=void 0,(o=t.PlotDisplayMode||(t.PlotDisplayMode={}))[o.NONE=0]="NONE",o[o.CONSTANT_EVAL=1]="CONSTANT_EVAL",o[o.FUNCTION_GRAPH=2]="FUNCTION_GRAPH",o[o.SET=3]="SET",o[o.LEVEL_SET=4]="LEVEL_SET",o[o.VECTOR_FIELD=5]="VECTOR_FIELD",o[o.GRADIENT=6]="GRADIENT",(r=t.PlotStatus||(t.PlotStatus={}))[r.PENDING=0]="PENDING",r[r.ACTIVE=1]="ACTIVE",r[r.ERROR=2]="ERROR",(n=t.PlotDriver||(t.PlotDriver={}))[n.CONSTANT=0]="CONSTANT",n[n.CANVAS=1]="CANVAS",n[n.WEBGL=2]="WEBGL"},99:(e,t)=>{var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.lex=t.clearUserVariables=t.getUserVariable=t.setUserVariable=t.getExternVariable=t.unbindExternVariable=t.bindExternVariable=t.lexerGetError=t.TokenFlag=t.Token=void 0,function(e){e[e.UNDEF=0]="UNDEF",e[e.NONE=1]="NONE",e[e.VAR=2]="VAR",e[e.VAR2=3]="VAR2",e[e.NUM=4]="NUM",e[e.CONST=5]="CONST",e[e.PAREN_OP=6]="PAREN_OP",e[e.PAREN_CL=7]="PAREN_CL",e[e.BRACKET_OP=8]="BRACKET_OP",e[e.BRACKET_CL=9]="BRACKET_CL",e[e.BRACE_OP=10]="BRACE_OP",e[e.BRACE_CL=11]="BRACE_CL",e[e.DELIM=12]="DELIM",e[e.ASSIGN=13]="ASSIGN",e[e.ASSIGNABLE=14]="ASSIGNABLE",e[e.LESS=15]="LESS",e[e.GREATER=16]="GREATER",e[e.LESS_OR_EQUAL=17]="LESS_OR_EQUAL",e[e.GREATER_OR_EQUAL=18]="GREATER_OR_EQUAL",e[e.USERVAR=19]="USERVAR",e[e.ADD=20]="ADD",e[e.SUB=21]="SUB",e[e.MULT=22]="MULT",e[e.DIV=23]="DIV",e[e.POW=24]="POW",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.NOT_EQUAL=27]="NOT_EQUAL",e[e.EQUAL=28]="EQUAL",e[e.TRUE=29]="TRUE",e[e.FALSE=30]="FALSE",e[e.SQRT=31]="SQRT",e[e.EXP=32]="EXP",e[e.LOG=33]="LOG",e[e.SIN=34]="SIN",e[e.COS=35]="COS",e[e.TAN=36]="TAN",e[e.ASIN=37]="ASIN",e[e.ACOS=38]="ACOS",e[e.ATAN=39]="ATAN",e[e.SINH=40]="SINH",e[e.COSH=41]="COSH",e[e.TANH=42]="TANH",e[e.FLOOR=43]="FLOOR",e[e.MIN=44]="MIN",e[e.MAX=45]="MAX",e[e.ABS=46]="ABS",e[e.MOD=47]="MOD",e[e.RAND=48]="RAND",e[e.PERLIN=49]="PERLIN",e[e.FACTORIAL=50]="FACTORIAL",e[e.SIGMOID=51]="SIGMOID",e[e.LEVEL_SET=52]="LEVEL_SET",e[e.VECTOR_FIELD=53]="VECTOR_FIELD",e[e.CIRCLE=54]="CIRCLE",e[e.POINT=55]="POINT",e[e.TIME=56]="TIME",e[e.MAGNITUDE=57]="MAGNITUDE",e[e.IMAGINARY=58]="IMAGINARY",e[e.POLAR=59]="POLAR",e[e.CARTESIAN=60]="CARTESIAN",e[e.MOUSEX=61]="MOUSEX",e[e.MOUSEY=62]="MOUSEY",e[e.MOUSE=63]="MOUSE",e[e.SERIES=64]="SERIES",e[e.DIV_SERIES=65]="DIV_SERIES",e[e.ITERATOR=66]="ITERATOR",e[e.COMPLEX=67]="COMPLEX",e[e.GRADIENT=68]="GRADIENT",e[e.INDEX=69]="INDEX"}(n=t.Token||(t.Token={})),function(e){e[e.IMPL_MULT_BEFORE=1]="IMPL_MULT_BEFORE",e[e.IMPL_MULT_AFTER=2]="IMPL_MULT_AFTER",e[e.PREFIX=4]="PREFIX",e[e.UNIQUE=16]="UNIQUE",e[e.BEGIN_SCOPE=32]="BEGIN_SCOPE",e[e.END_SCOPE=64]="END_SCOPE",e[e.WEBGL_ONLY=128]="WEBGL_ONLY"}(r=t.TokenFlag||(t.TokenFlag={}));const o={"(":{tok:n.PAREN_OP,flags:r.IMPL_MULT_BEFORE|r.UNIQUE|r.BEGIN_SCOPE},")":{tok:n.PAREN_CL,flags:r.IMPL_MULT_AFTER|r.UNIQUE|r.END_SCOPE},"[":{tok:n.BRACKET_OP,flags:r.IMPL_MULT_BEFORE|r.UNIQUE|r.BEGIN_SCOPE},"]":{tok:n.BRACKET_CL,flags:r.IMPL_MULT_AFTER|r.UNIQUE|r.END_SCOPE},"{":{tok:n.BRACE_OP,flags:r.IMPL_MULT_BEFORE|r.UNIQUE|r.BEGIN_SCOPE},"}":{tok:n.BRACE_CL,flags:r.IMPL_MULT_AFTER|r.UNIQUE|r.END_SCOPE},",":{tok:n.DELIM,flags:r.UNIQUE},"=":{tok:n.ASSIGN,flags:0},x:{tok:n.VAR,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},y:{tok:n.VAR2,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER|r.WEBGL_ONLY},"<":{tok:n.LESS,flags:0},">":{tok:n.GREATER,flags:0},"<=":{tok:n.LESS_OR_EQUAL,flags:r.UNIQUE},">=":{tok:n.GREATER_OR_EQUAL,flags:r.UNIQUE},"!=":{tok:n.NOT_EQUAL,flags:r.UNIQUE},"==":{tok:n.EQUAL,flags:r.UNIQUE},"&&":{tok:n.AND,flags:r.UNIQUE},"||":{tok:n.OR,flags:r.UNIQUE},"+":{tok:n.ADD,flags:r.UNIQUE},"-":{tok:n.SUB,flags:r.UNIQUE},"*":{tok:n.MULT,flags:0},"/":{tok:n.DIV,flags:r.UNIQUE},"^":{tok:n.POW,flags:r.UNIQUE},"**":{tok:n.POW,flags:r.UNIQUE},"%":{tok:n.MOD,flags:0},mod:{tok:n.MOD,flags:0},true:{tok:n.TRUE,flags:0},false:{tok:n.FALSE,flags:0},sqrt:{tok:n.SQRT,flags:r.IMPL_MULT_BEFORE|r.PREFIX},exp:{tok:n.EXP,flags:r.IMPL_MULT_BEFORE|r.PREFIX},log:{tok:n.LOG,flags:r.IMPL_MULT_BEFORE|r.PREFIX},ln:{tok:n.LOG,flags:r.IMPL_MULT_BEFORE|r.PREFIX},sin:{tok:n.SIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},cos:{tok:n.COS,flags:r.IMPL_MULT_BEFORE|r.PREFIX},tan:{tok:n.TAN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},asin:{tok:n.ASIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},acos:{tok:n.ACOS,flags:r.IMPL_MULT_BEFORE|r.PREFIX},atan:{tok:n.ATAN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},arcsin:{tok:n.ASIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},arccos:{tok:n.ACOS,flags:r.IMPL_MULT_BEFORE|r.PREFIX},arctan:{tok:n.ATAN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},sinh:{tok:n.SINH,flags:r.IMPL_MULT_BEFORE|r.PREFIX},cosh:{tok:n.COSH,flags:r.IMPL_MULT_BEFORE|r.PREFIX},tanh:{tok:n.TANH,flags:r.IMPL_MULT_BEFORE|r.PREFIX},floor:{tok:n.FLOOR,flags:r.IMPL_MULT_BEFORE|r.PREFIX},min:{tok:n.MIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},max:{tok:n.MAX,flags:r.IMPL_MULT_BEFORE|r.PREFIX},abs:{tok:n.ABS,flags:r.IMPL_MULT_BEFORE|r.PREFIX},rand:{tok:n.RAND,flags:r.IMPL_MULT_BEFORE|r.PREFIX},random:{tok:n.RAND,flags:r.IMPL_MULT_BEFORE|r.PREFIX},perlin:{tok:n.PERLIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},noise:{tok:n.PERLIN,flags:r.IMPL_MULT_BEFORE|r.PREFIX},fact:{tok:n.FACTORIAL,flags:r.IMPL_MULT_BEFORE|r.PREFIX},factorial:{tok:n.FACTORIAL,flags:r.IMPL_MULT_BEFORE|r.PREFIX},sigmoid:{tok:n.SIGMOID,flags:r.IMPL_MULT_BEFORE|r.PREFIX},Level:{tok:n.LEVEL_SET,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},Niveau:{tok:n.LEVEL_SET,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},VectorField:{tok:n.VECTOR_FIELD,flags:r.IMPL_MULT_BEFORE|r.PREFIX},"|":{tok:n.ABS,flags:r.BEGIN_SCOPE|r.END_SCOPE},Circle:{tok:n.CIRCLE,flags:r.PREFIX|r.WEBGL_ONLY},Point:{tok:n.POINT,flags:r.PREFIX|r.WEBGL_ONLY},Polar:{tok:n.POLAR,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},Pol:{tok:n.POLAR,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},Cartesian:{tok:n.CARTESIAN,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},Cart:{tok:n.CARTESIAN,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},t:{tok:n.TIME,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},mouseX:{tok:n.MOUSEX,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},mouseY:{tok:n.MOUSEY,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},mouse:{tok:n.MOUSE,flags:0},i:{tok:n.IMAGINARY,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},Series:{tok:n.SERIES,flags:r.IMPL_MULT_BEFORE|r.PREFIX},DivSeries:{tok:n.DIV_SERIES,flags:r.IMPL_MULT_BEFORE|r.PREFIX|r.WEBGL_ONLY},k:{tok:n.ITERATOR,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},j:{tok:n.INDEX,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},z:{tok:n.COMPLEX,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER},Mag:{tok:n.MAGNITUDE,flags:r.IMPL_MULT_BEFORE|r.PREFIX},Gradient:{tok:n.GRADIENT,flags:r.PREFIX}},a={pi:Math.PI,Pi:Math.PI,e:Math.E};let i=null;t.lexerGetError=()=>i;const l=e=>/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e),s={};t.bindExternVariable=(e,t,n)=>{s[e]={get:t,set:n}},t.unbindExternVariable=e=>{delete s[e]},t.getExternVariable=e=>s[e];let u={};t.setUserVariable=(e,t)=>{u[e]=t},t.getUserVariable=e=>u[e]||0,t.clearUserVariables=()=>{u={}},t.lex=e=>{i=null;const t=(e=e.replace(/\s/g,"")).split(new RegExp(`(${Object.keys(o).filter((e=>o[e].flags&r.UNIQUE)).map((e=>(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(e))).join("|")})`,"g")).filter((e=>""!==e)),u=[];let c=0;return t.forEach((e=>{let t=0;for(let f=e.length;f>t;f--){const T=e.substring(t,f);let h=!1;if(o[T])u.push({tok:o[T].tok,val:0,flags:o[T].flags}),h=!0;else if(a[T])u.push({tok:n.CONST,val:a[T],flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER}),h=!0;else if(s[T])u.push({tok:n.ASSIGNABLE,val:T,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER}),h=!0;else if(isNaN(Number(T))){if(f-1===t){let o="";for(let n=t+1;n<=e.length;n++){const r=e.substring(t,n);if(!l(r))break;o=r}if(""!==o){u.push({tok:n.USERVAR,val:o,flags:r.IMPL_MULT_BEFORE|r.IMPL_MULT_AFTER}),t+=o.length,f=e.length+1;continue}return E=`Unknown token: ´${e.substring(t,e.length)}´`,g=c+t,console.error(`Error at position ${g}: ${E}`),i={desc:E,pos:g},[]}}else u.push({tok:n.NUM,val:parseFloat(T),flags:r.IMPL_MULT_AFTER}),h=!0;h&&(t=f,f=e.length+1)}var E,g;c+=e.length})),u}},103:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.parserGetDisplayMode=t.parserGetDriver=t.parserGetContinuous=t.parserGetError=void 0;const r=n(195),o=n(99),a={[o.Token.OR]:0,[o.Token.DELIM]:1,[o.Token.AND]:2,[o.Token.EQUAL]:3,[o.Token.NOT_EQUAL]:3,[o.Token.ASSIGN]:3,[o.Token.LESS]:4,[o.Token.LESS_OR_EQUAL]:4,[o.Token.GREATER]:4,[o.Token.GREATER_OR_EQUAL]:4,[o.Token.ADD]:5,[o.Token.SUB]:5,[o.Token.MULT]:6,[o.Token.DIV]:6,[o.Token.MOD]:6,[o.Token.POW]:7},i=(e,t)=>{console.error(`Error at position ${t}: ${e}`),l={desc:e,pos:t}};let l=null,s=!1,u=r.PlotDriver.CONSTANT,c=r.PlotDisplayMode.NONE;t.parserGetError=()=>l,t.parserGetContinuous=()=>s,t.parserGetDriver=()=>u,t.parserGetDisplayMode=()=>c,t.parse=e=>{l=null,s=!1,u=r.PlotDriver.CONSTANT,c=r.PlotDisplayMode.NONE;let t=(0,o.lex)(e);console.debug("Lexer output:",t);const n=(0,o.lexerGetError)();if(n)return l=JSON.parse(JSON.stringify(n)),null;if(t=E(t),console.debug("Validated ops:",t),null==t)return null;if(t=g(t),console.debug("Expanded ops:",t),null==t)return null;const a=(t.filter((e=>e.tok===o.Token.VAR)).length>0?1:0)+(t.filter((e=>e.tok===o.Token.VAR2)).length>0?1:0);return t.filter((e=>e.tok===o.Token.VECTOR_FIELD)).length>0?(u=r.PlotDriver.CANVAS,c=r.PlotDisplayMode.VECTOR_FIELD):t.filter((e=>e.flags&o.TokenFlag.WEBGL_ONLY)).length>0?(u=r.PlotDriver.WEBGL,c=r.PlotDisplayMode.SET,t.filter((e=>e.tok===o.Token.LEVEL_SET)).length>0?c=r.PlotDisplayMode.LEVEL_SET:t.filter((e=>e.tok===o.Token.GRADIENT)).length>0&&(c=r.PlotDisplayMode.GRADIENT)):0===a?(u=r.PlotDriver.CONSTANT,c=r.PlotDisplayMode.CONSTANT_EVAL):1===a&&(u=r.PlotDriver.CANVAS,c=r.PlotDisplayMode.FUNCTION_GRAPH),s=t.filter((e=>e.tok===o.Token.TIME)).length>0||t.filter((e=>e.tok===o.Token.MOUSEX)).length>0||t.filter((e=>e.tok===o.Token.MOUSEY)).length>0,t=f(t),console.debug("Optimized ops:",t),null==t?null:T(t)};const E=e=>{const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(r.flags&o.TokenFlag.BEGIN_SCOPE&&t.push({tok:r.tok,pos:n}),r.flags&o.TokenFlag.END_SCOPE){const{tok:e,pos:n}=t.pop()||{tok:o.Token.NONE,pos:0};let a=o.Token.NONE;switch(e){case o.Token.PAREN_OP:a=o.Token.PAREN_CL;break;case o.Token.BRACKET_OP:a=o.Token.BRACKET_CL;break;case o.Token.BRACE_OP:a=o.Token.BRACE_CL;break;case o.Token.ABS:a=o.Token.ABS}if(r.tok!==a)return i("Mismatched parentheses",n),null}}if(t.length>0){const{pos:e}=t[0];return i("Unmatched parentheses",e),null}return e},g=e=>{const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(r.tok===o.Token.ABS&&r.flags&o.TokenFlag.BEGIN_SCOPE){const a=t.pop();if(t.push({tok:r.tok,pos:n}),!a)continue;const i=e.splice(a.pos+1,n-a.pos-1);e.splice(a.pos,2),e.splice(a.pos,0,{tok:o.Token.ABS,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.PREFIX},{tok:o.Token.PAREN_OP,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.UNIQUE|o.TokenFlag.BEGIN_SCOPE},...i,{tok:o.Token.PAREN_CL,val:0,flags:o.TokenFlag.IMPL_MULT_AFTER|o.TokenFlag.UNIQUE|o.TokenFlag.END_SCOPE}),n=a.pos+i.length+3,t.pop()}}for(let t=0;t<e.length;t++)e[t].tok===o.Token.MOUSE?(e.splice(t,1,{tok:o.Token.MOUSEX,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE},{tok:o.Token.DELIM,val:0,flags:0},{tok:o.Token.MOUSEY,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE}),t+=2):e[t].tok===o.Token.COMPLEX&&(e.splice(t,1,{tok:o.Token.PAREN_OP,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.BEGIN_SCOPE},{tok:o.Token.VAR,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.IMPL_MULT_AFTER},{tok:o.Token.ADD,val:0,flags:0},{tok:o.Token.VAR2,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.IMPL_MULT_AFTER|o.TokenFlag.WEBGL_ONLY},{tok:o.Token.IMAGINARY,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.IMPL_MULT_AFTER},{tok:o.Token.PAREN_CL,val:0,flags:o.TokenFlag.IMPL_MULT_AFTER|o.TokenFlag.END_SCOPE}),t+=5);for(let t=1;t<e.length;t++)e[t-1].flags&o.TokenFlag.IMPL_MULT_AFTER&&e[t].flags&o.TokenFlag.IMPL_MULT_BEFORE&&e.splice(t,0,{tok:o.Token.MULT,val:0,flags:0});for(let t=8;t>0;t--)for(let n=0;n<e.length;n++)if(a[e[n].tok]===t){let r=0,i=e.length,l=0;for(let i=n;i>=0;i--)if(e[i].flags&o.TokenFlag.BEGIN_SCOPE?l++:e[i].flags&o.TokenFlag.END_SCOPE&&l--,a[e[i].tok]<t&&0===l||l>0){r=i+1;break}l=0;for(let r=n;r<e.length;r++)if(e[r].flags&o.TokenFlag.BEGIN_SCOPE?l++:e[r].flags&o.TokenFlag.END_SCOPE&&l--,a[e[r].tok]<t&&0===l||l<0){i=r;break}e.splice(i,0,{tok:o.Token.PAREN_CL,val:0,flags:o.TokenFlag.IMPL_MULT_AFTER|o.TokenFlag.UNIQUE|o.TokenFlag.END_SCOPE}),e.splice(r,0,{tok:o.Token.PAREN_OP,val:0,flags:o.TokenFlag.IMPL_MULT_BEFORE|o.TokenFlag.UNIQUE|o.TokenFlag.BEGIN_SCOPE}),n++}for(let t=0;t<e.length;t++)e[t].tok===o.Token.SUB&&(0===t||e[t-1].flags&o.TokenFlag.BEGIN_SCOPE)&&e.splice(t,0,{tok:o.Token.NUM,val:0,flags:o.TokenFlag.IMPL_MULT_AFTER});return e},f=e=>{let t=0;for(let n=0;n<e.length;n++)if(e[n].tok===o.Token.SUB)t++;else{if(t>1)if(t%2==1)for(let r=0;r<t-1;r++)e.splice(n-t,1);else{for(let r=0;r<t;r++)e.splice(n-t,1);e.splice(n-t,0,{tok:o.Token.ADD,val:0,flags:0})}t=0}for(let t=1;t<e.length;t++)e[t].flags&o.TokenFlag.END_SCOPE&&e[t-1].flags&o.TokenFlag.BEGIN_SCOPE&&e.splice(t-1,2);return e},T=e=>{const t={op:{tok:o.Token.NONE,val:0,flags:0},left:null,right:null};let n=t;const r=[];let a=0;for(let t=0;t<e.length;t++){const l=e[t];if(l.flags&o.TokenFlag.BEGIN_SCOPE)a++;else if(l.flags&o.TokenFlag.END_SCOPE){if(a<=0)return i("Unexpected end of scope",t),null;a--,n=r.pop();continue}if(null==n.op||n.op.tok===o.Token.NONE||n.op.flags&o.TokenFlag.BEGIN_SCOPE)n.op=l,n.op.flags&o.TokenFlag.BEGIN_SCOPE&&r.push(n);else if(null==n.left){if(n.op.flags&o.TokenFlag.PREFIX){n.left={op:{tok:o.Token.UNDEF,val:0,flags:0},left:null,right:null},n.right={op:l,left:null,right:null},n.right.op.flags&o.TokenFlag.BEGIN_SCOPE&&(r.push(n),n=n.right);continue}const e=JSON.parse(JSON.stringify(n));n.left=e,n.op=l}else if(null==n.right||n.right.op.flags&o.TokenFlag.BEGIN_SCOPE)n.right={op:l,left:null,right:null},n.right.op.flags&o.TokenFlag.BEGIN_SCOPE&&(r.push(n),n=n.right);else if(n.right.op.flags&o.TokenFlag.PREFIX&&null==n.right.right)r.push(n),n=n.right,n.right={op:l,left:null,right:null};else{const e=JSON.parse(JSON.stringify(n));n.left=e,n.right=null,n.op=l}}return 0!==a?(i("Unexpected end of expression",e.length),null):t}},682:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function l(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.shadersDraw=t.scheduleReloadShaders=t.shaderCoreUpdate=t.initShaderCore=t.shadersClearAll=void 0;const o=n(607),a=n(85),i=n(533),l=n(195),s=n(633),u=n(750);let c=null,E=null,g=!1,f=!1,T=!1;const h={},d=document.getElementById("shader-canvas"),M=d.getContext("webgl2",{preserveDrawingBuffer:!0});function p(e){return r(this,void 0,void 0,(function*(){if(!h[e]){const t=yield fetch(e),n=yield t.text();return h[e]=n,n}return Promise.resolve(h[e])}))}function m(){return r(this,void 0,void 0,(function*(){g=!0,yield Promise.all([p("assets/shaders/plot.vert"),p("assets/shaders/plot.frag")]).then((e=>{e[1]=function(e){const t=(0,i.getPlotsShaderInfo)();return 0===t.numPlots&&(t.functions=[],t.colors=["#000000"],t.displayModes=[l.PlotDisplayMode.NONE],t.iterExpr=[]),t.functions.push("0.0"),t.iterExpr.push("vec2(0.0,0.0)"),e.replace(/USER_NUM_FUNC_INJ/g,`${t.numPlots+1}`).replace(/USER_FUNC_INJ/g,`float[](${t.functions.map((e=>`(${e})`)).join(",")})`).replace(/USER_COL_INJ/g,`vec3[](${t.colors.map((e=>{return`vec3(${t=e,`${parseInt(t.substring(1,3),16)/255}, ${parseInt(t.substring(3,5),16)/255}, ${parseInt(t.substring(5,7),16)/255}`})`;var t})).join(",")})`).replace(/USER_DISP_INJ/g,`int[](${t.displayModes.map((e=>`${e}`)).join(",")})`).replace(/USER_ITER_EXPR_INJ/g,`vec2[](${t.iterExpr.map((e=>`(${e.length>0?e:"vec2(0.0,0.0)"})`)).join(",")})`)}(e[1]);const t=function(e,t){const n=k(M.VERTEX_SHADER,e),r=k(M.FRAGMENT_SHADER,t);if(!n||!r)return null;const o=M.createProgram();return o?(M.attachShader(o,n),M.attachShader(o,r),M.linkProgram(o),M.getProgramParameter(o,M.LINK_STATUS)?o:(console.error("Failed to link program: "+M.getProgramInfoLog(o)),null)):(console.error("Failed to create program"),null)}(e[0],e[1]);t?(c={program:t,attribLocations:{vertexPosition:M.getAttribLocation(t,"aVertexPosition")},uniformLocations:{projectionMatrix:M.getUniformLocation(t,"uProjectionMatrix"),modelViewMatrix:M.getUniformLocation(t,"uModelViewMatrix"),u_resolution:M.getUniformLocation(t,"u_resolution"),u_mouse:M.getUniformLocation(t,"u_mouse"),u_time:M.getUniformLocation(t,"u_time"),u_deviation:M.getUniformLocation(t,"u_deviation"),u_domain_x:M.getUniformLocation(t,"u_domain_x"),u_domain_y:M.getUniformLocation(t,"u_domain_y"),u_display_mode:M.getUniformLocation(t,"u_display_mode")}},E=function(){const e=M.createBuffer();M.bindBuffer(M.ARRAY_BUFFER,e);return M.bufferData(M.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),M.STATIC_DRAW),e}(),f=!0,g=!1):console.error("Failed to load shaders")}))}))}function k(e,t){const n=M.createShader(e);return n?(M.shaderSource(n,t),M.compileShader(n),M.getShaderParameter(n,M.COMPILE_STATUS)?n:(console.error("Failed to compile shader: "+M.getShaderInfoLog(n)),M.getShaderInfoLog(n),M.deleteShader(n),null)):(console.error("Failed to create shader"),null)}function L(){M.clearColor(0,0,0,1),M.clearDepth(1),M.enable(M.DEPTH_TEST),M.depthFunc(M.LEQUAL),M.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT);const e=45*Math.PI/180,t=M.canvas.clientWidth/M.canvas.clientHeight,n=s.create();s.perspective(n,e,t,.1,100);const r=s.create();s.translate(r,r,[0,0,-1]);const i=M.FLOAT;M.bindBuffer(M.ARRAY_BUFFER,E),M.vertexAttribPointer(c.attribLocations.vertexPosition,2,i,!1,0,0),M.enableVertexAttribArray(c.attribLocations.vertexPosition),M.useProgram(c.program);const l=(0,u.getMousePos)(),g=(0,a.getDomain)();M.uniformMatrix4fv(c.uniformLocations.projectionMatrix,!1,n),M.uniformMatrix4fv(c.uniformLocations.modelViewMatrix,!1,r),M.uniform2f(c.uniformLocations.u_resolution,M.canvas.width,M.canvas.height),M.uniform2f(c.uniformLocations.u_mouse,l.x,l.y),M.uniform2f(c.uniformLocations.u_domain_x,g.minX,g.maxX),M.uniform2f(c.uniformLocations.u_domain_y,g.minY,g.maxY),M.uniform1f(c.uniformLocations.u_time,(0,o.getGlobalTime)()),M.uniform1f(c.uniformLocations.u_deviation,.004),M.uniform1i(c.uniformLocations.u_display_mode,0),M.drawArrays(M.TRIANGLE_STRIP,0,4)}t.shadersClearAll=function(){(0,t.scheduleReloadShaders)()},t.initShaderCore=function(){d&&M||console.error("Failed to initialize WebGL context.")},t.shaderCoreUpdate=function(){f||g||T||(m(),T&&console.error("Failed to load shaders"))},t.scheduleReloadShaders=function(){T=!1,f=!1,g=!1},t.shadersDraw=function(){f=!1,!f||T?m().then((()=>{if(!f)return console.error("Failed to initialize shaders"),void M.clearColor(0,0,0,1);L()})):L()}},849:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildShaderFunction=t.shaderFunctionBuilderGetIterExpression=t.shaderFunctionBuilderGetError=void 0;const r=n(607),o=n(99),a=n(283);let i=null;t.shaderFunctionBuilderGetError=()=>i;let l="";t.shaderFunctionBuilderGetIterExpression=()=>l,t.buildShaderFunction=e=>{if(!e)return null;i=null,l="";const t=g(e);return console.debug("Shader function: "+t.val),t.val};const s=function(e){return console.error("Error during constant evaluation: "+e),i=e,{val:null,cpx:!1}},u=function(e){return-1===e.toString().indexOf(".")?e.toString()+".0":e.toString()},c=e=>({val:e,cpx:!1}),E=e=>({val:e,cpx:!0}),g=function(e){var t;let n,i;switch(e.op.tok){case o.Token.UNDEF:return s("Token UNDEFINED is not allowed");case o.Token.NONE:return c("0");case o.Token.PAREN_OP:return s("Token OPEN PARENTHESIS is not allowed");case o.Token.PAREN_CL:return s("Token CLOSE PARENTHESIS is not allowed");case o.Token.BRACKET_OP:return s("Token OPEN BRACKET is not allowed");case o.Token.BRACKET_CL:return s("Token CLOSE BRACKET is not allowed");case o.Token.BRACE_OP:return s("Token OPEN BRACE is not allowed");case o.Token.BRACE_CL:return s("Token CLOSE BRACE is not allowed");case o.Token.NUM:return"number"!=typeof e.op.val?s("Token NUMBER must be a number"):c(u(e.op.val));case o.Token.CONST:return"number"!=typeof e.op.val?s("Token CONSTANT must be a number"):c(u(e.op.val));case o.Token.VAR:return c("x");case o.Token.VAR2:return c("y");case o.Token.TIME:return(0,r.scheduleRedraw)(),c("t");case o.Token.ADD:return null==e.left||null==e.right?s("Missing arguments for Token ADDITION"):(n=g(e.left),i=g(e.right),n.cpx||i.cpx?E(`add(${n.val},${i.val})`):c(`(${n.val}+${i.val})`));case o.Token.SUB:return null==e.left||null==e.right?s("Missing arguments for Token SUBTRACTION"):(n=g(e.left),i=g(e.right),n.cpx||i.cpx?E(`sub(${n.val},${i.val})`):c(`(${n.val}-${i.val})`));case o.Token.MULT:return null==e.left||null==e.right?s("Missing arguments for Token MULTIPLICATION"):(n=g(e.left),i=g(e.right),n.cpx||i.cpx?E(`mul(${n.val},${i.val})`):c(`(${n.val}*${i.val})`));case o.Token.DIV:return null==e.left||null==e.right?s("Missing arguments for Token DIVISION"):(n=g(e.left),i=g(e.right),n.cpx||i.cpx?E(`div(${n.val},${i.val})`):c(`(${n.val}/${i.val})`));case o.Token.POW:return null==e.left||null==e.right?s("Missing arguments for Token POWER"):(n=g(e.left),i=g(e.right),n.cpx||i.cpx?i.cpx?s("Power cannot be complex"):E(`_pow(${n.val},${i.val})`):c(`_pow(${n.val},${i.val})`));case o.Token.SQRT:return null==e.right?s("Missing argument for Token SQUARE ROOT"):(i=g(e.right),i.cpx?s("Square root cannot be complex"):c(`sqrt(${i.val})`));case o.Token.LOG:return null==e.right?s("Missing argument for Token LOGARITHM"):(i=g(e.right),i.cpx?s("Logarithm cannot be complex"):c(`log(${i.val})`));case o.Token.EXP:return null==e.right?s("Missing argument for Token EXPOENTIAL"):(i=g(e.right),i.cpx?s("Exponential cannot be complex"):c(`exp(${i.val})`));case o.Token.SIN:return null==e.right?s("Missing argument for Token SINE"):(i=g(e.right),i.cpx?s("Sine cannot be complex"):c(`sin(${i.val})`));case o.Token.COS:return null==e.right?s("Missing argument for Token COSINE"):(i=g(e.right),i.cpx?s("Cosine cannot be complex"):c(`cos(${i.val})`));case o.Token.TAN:return null==e.right?s("Missing argument for Token TANGENT"):(i=g(e.right),i.cpx?s("Tangent cannot be complex"):c(`tan(${i.val})`));case o.Token.ASIN:return null==e.right?s("Missing argument for Token ARC SINE"):(i=g(e.right),i.cpx?s("Arc sine cannot be complex"):c(`asin(${i.val})`));case o.Token.ACOS:return null==e.right?s("Missing argument for Token ARC COSINE"):(i=g(e.right),i.cpx?s("Arc cosine cannot be complex"):c(`acos(${i.val})`));case o.Token.ATAN:return null==e.right?s("Missing argument for Token ARC TANGENT"):(i=g(e.right),i.cpx?s("Arc tangent cannot be complex"):c(`atan(${i.val})`));case o.Token.SINH:return null==e.right?s("Missing argument for Token HYPERBOLIC SINE"):(i=g(e.right),i.cpx?s("Sine hyperbolicus cannot be complex"):c(`sinh(${i.val})`));case o.Token.COSH:return null==e.right?s("Missing argument for Token HYPERBOLIC COSINE"):(i=g(e.right),i.cpx?s("Cosine hyperbolicus cannot be complex"):c(`cosh(${i.val})`));case o.Token.TANH:return null==e.right?s("Missing argument for Token HYPERBOLIC TANGENT"):(i=g(e.right),i.cpx?s("Hyperbolic tangent cannot be complex"):c(`tanh(${i.val})`));case o.Token.FLOOR:return null==e.right?s("Missing argument for Token FLOOR"):(i=g(e.right),i.cpx?s("Floor cannot be complex"):c(`floor(${i.val})`));case o.Token.MIN:return null==e.right?s("Missing argument for Token MIN"):(0,a.isIterable)(g(e.right).val)?c(`min(${g(e.right).val})`):s("Malformed argument for Token MIN");case o.Token.MAX:return null==e.right?s("Missing argument for Token MAX"):(0,a.isIterable)(g(e.right).val)?c(`max(${g(e.right).val})`):s("Malformed argument for Token MAX");case o.Token.DELIM:return null==e.left||null==e.right?s("Missing arguments for Token DELIMITER"):c(`${g(e.left).val},${g(e.right).val}`);case o.Token.ABS:return null==e.right?s("Missing argument for Token ABSOLUTE"):(i=g(e.right),i.cpx?c(`mag(${i.val})`):c(`abs(${i.val})`));case o.Token.RAND:return null==e.right?s("Missing argument for Token RANDOM"):c(`random(${g(e.right).val})`);case o.Token.PERLIN:return null==e.right?s("Missing arguments for Token PERLIN"):(0,a.isIterable)(g(e.right).val)?c(`noise(vec2(${g(e.right).val}))`):s("Malformed argument for Token PERLIN");case o.Token.MOD:return null==e.left||null==e.right?s("Missing arguments for Token MODULUS"):c(`mod(${g(e.left).val},${g(e.right).val})`);case o.Token.LEVEL_SET:return null==e.right?s("Missing argument for Token LEVEL SET"):e.right.op.tok===o.Token.DELIM?null==e.right.left||null==e.right.right?s("Missing arguments for Token LEVEL SET"):c(`${g(e.right.left).val}+((level=${g(e.right.right).val})>0.0?0.0:0.0)`):g(e.right);case o.Token.VECTOR_FIELD:return s("Token VECTOR FIELD is not allowed");case o.Token.LESS:return null==e.left||null==e.right?s("Missing arguments for Token LESS THAN"):c(`btof(${g(e.left).val}<${g(e.right).val})`);case o.Token.GREATER:return null==e.left||null==e.right?s("Missing arguments for Token GREATER THAN"):c(`btof(${g(e.left).val}>${g(e.right).val})`);case o.Token.LESS_OR_EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token LESS THAN OR EQUAL TO"):c(`btof(${g(e.left).val}<=${g(e.right).val})`);case o.Token.GREATER_OR_EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token GREATER THAN OR EQUAL TO"):c(`btof(${g(e.left).val}>=${g(e.right).val})`);case o.Token.EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token EQUAL TO"):c(`btof(${g(e.left).val}==${g(e.right).val})`);case o.Token.AND:return null==e.left||null==e.right?s("Missing arguments for Token AND"):c(`btof(ftob(${g(e.left).val})&&ftob(${g(e.right).val}))`);case o.Token.OR:return null==e.left||null==e.right?s("Missing arguments for Token OR"):c(`btof(ftob(${g(e.left).val})||ftob(${g(e.right).val}))`);case o.Token.USERVAR:return c(`btof(${(0,o.getUserVariable)(e.op.val)})`);case o.Token.FACTORIAL:return null==e.right?s("Missing argument for Token FACTORIAL"):c(`factorial(${g(e.right).val})`);case o.Token.SIGMOID:return null==e.right?s("Missing argument for Token SIGMOID"):c(`(1.0/(1.0+exp(-(${g(e.right).val}))))`);case o.Token.CIRCLE:return null==e.right?s("Missing argument for Token CIRCLE"):c(`circle(x,y,d,${g(e.right).val})`);case o.Token.POINT:return null==e.right?s("Missing argument for Token POINT"):c(`point(x,y,d,${g(e.right).val})`);case o.Token.TRUE:return c("btof(true)");case o.Token.FALSE:return c("btof(false)");case o.Token.POLAR:return null==e.right?s("Missing argument for Token POLAR"):c(`(POLAR+${g(e.right).val})`);case o.Token.CARTESIAN:return null==e.right?s("Missing argument for Token CARTESIAN"):c(`(CARTESIAN+${g(e.right).val})`);case o.Token.MOUSEX:return c("mx");case o.Token.MOUSEY:return c("my");case o.Token.MOUSE:return s("Token MOUSE is not allowed");case o.Token.IMAGINARY:return E("vec2(0.0,1.0)");case o.Token.SERIES:return s("Token SERIES is not allowed");case o.Token.DIV_SERIES:return null==e.right||null==e.right.left||null==e.right.right?s("Missing argument for Token SERIES"):(l=g(e.right.right).val||"",c(`divseries(i,x,y,t,${g(e.right.left).val})`));case o.Token.ITERATOR:return c("k");case o.Token.INDEX:return c("i");case o.Token.COMPLEX:return s("Token COMPLEX is not allowed");case o.Token.MAGNITUDE:return null==e.right?s("Missing argument for Token MAGNITUDE"):c(`mag(${g(e.right).val})`);case o.Token.GRADIENT:return null==e.right?s("Missing argument for Token GRADIENT"):g(e.right);case o.Token.ASSIGN:return null==e.left||null==e.right?s("Missing arguments for Token ASSIGN"):e.left.op.tok!==o.Token.ASSIGNABLE?e.left.op.tok===o.Token.USERVAR?((0,o.setUserVariable)(e.left.op.val,parseFloat(g(e.right).val)),g(e.right)):c(`btof(abs(${g(e.left).val}-${g(e.right).val})<d)`):null==(0,o.getExternVariable)(e.left.op.val)?s(`Variable ${e.left.op.val} does not exist`):(null===(t=(0,o.getExternVariable)(e.left.op.val))||void 0===t||t.set(parseFloat(g(e.right).val)),g(e.right));default:return s(`Unknown token ${e.op.val}`)}}},320:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLeftPanelWidth=t.inputSetDriverAt=t.inputSetStatusAt=t.inputSetConstEvalAt=t.inputSetErrorAt=t.inputSetColorAt=t.resetInputs=t.addNewInputWithValue=t.addNewInput=t.initInputs=t.initLeftPanel=void 0;const r=n(607),o=n(533),a=n(195),i=n(283),l=n(750),s=document.querySelector(".inputs"),u=document.querySelector(".resize-left-panel"),c=document.getElementById("left-panel");let E=0,g=0;t.initLeftPanel=function(){(0,l.onMouseDrag)(u,(e=>{const t=Math.max(250,Math.min(.95*window.innerWidth,e.x));document.documentElement.style.setProperty("--left-panel-width",`${t}px`),(0,r.scheduleRedraw)()}))},t.initInputs=function(){(0,t.addNewInput)()},t.addNewInput=function(){const e=(0,i.stringToHTML)('\n\t<div class="input">\n\t<div class="status"><div class="indicator"></div></div>\n\t<input type="text" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off" autofocus>\n\t<div class="delete">×</div>\n\t<div class="const-eval"></div>\n\t</div>').firstChild,n=e.querySelector("input"),a=e.querySelector(".delete"),l=e.querySelector(".indicator");null==n||n.addEventListener("keydown",(function(e){if("Enter"===e.key){if(e.preventDefault(),g>E){const e=s.querySelector(`.input[data-input-idx="${++E}"]`);return T(e),void setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}(0,t.addNewInput)()}})),n.addEventListener("click",(function(t){T(e),E=parseInt(e.getAttribute("data-input-idx")||"0"),null==n||n.focus()})),null==n||n.addEventListener("focus",(function(t){T(e),E=parseInt(e.getAttribute("data-input-idx")||"0")})),null==n||n.addEventListener("input",(function(t){E=parseInt(e.getAttribute("data-input-idx")||"0"),l.classList.contains("disabled")?(0,o.setInputAt)(E,""):(0,o.setInputAt)(E,n.value)})),null==a||a.addEventListener("click",(function(t){if(1===g){e.classList.add("illegal");const t=e.querySelector("input");t&&(t.value="");const n=e.querySelector(".indicator");null==n||n.classList.remove("pending","active","error","disabled");const a=e.querySelector(".const-eval");return null==a||a.classList.remove("visible"),setTimeout((()=>e.classList.remove("illegal")),200),(0,r.scheduleRedraw)(),void(0,o.resetPlots)()}e.classList.add("deleted"),setTimeout((function(){e.remove();const t=parseInt(e.getAttribute("data-input-idx")||"0");g--,(0,o.setNumInputs)(g);const r=s.querySelectorAll(".input");for(let e=0;e<r.length;e++){r[e].setAttribute("data-input-idx",(e+1).toString());const t=r[e].querySelector(".indicator");(null==t?void 0:t.classList.contains("disabled"))?(0,o.setInputAt)(e+1,""):(0,o.setInputAt)(e+1,n.value)}if(g>0&&(t<=E||1===t)){const e=s.querySelector(`.input[data-input-idx="${E-1}"]`);T(e),setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}}),120)})),null==l||l.addEventListener("click",(function(t){l.classList.toggle("disabled"),E=parseInt(e.getAttribute("data-input-idx")||"0"),l.classList.contains("disabled")?(0,o.setInputAt)(E,""):(0,o.setInputAt)(E,n.value)})),e.setAttribute("data-input-idx",(++E).toString()),e.classList.add("created"),setTimeout((function(){e.classList.remove("created")}),120),g++,(0,o.setNumInputs)(g),T(e),setTimeout((function(){null==n||n.focus()}),0),s.appendChild(e)},t.addNewInputWithValue=function(e){(0,t.addNewInput)(),(0,o.setInputAt)(E,e);const n=s.querySelector(`.input[data-input-idx="${E}"] input`);n&&(n.value=e)},t.resetInputs=function(){const e=s.querySelectorAll(".input");for(let t=0;t<e.length;t++)e[t].remove();g=0,(0,o.setNumInputs)(g),E=0,(0,o.resetPlots)()};const f=function(e){return s.querySelector(`.input[data-input-idx="${e}"]`)};t.inputSetColorAt=function(e,t){var n;null===(n=f(e))||void 0===n||n.setAttribute("data-color",t)},t.inputSetErrorAt=function(e,t){const n=f(e);if(!n)return;const r=n.querySelector(".indicator");r&&r.setAttribute("data-error",t)},t.inputSetConstEvalAt=function(e,t){const n=f(e);if(!n)return;const r=n.querySelector(".const-eval");r&&((0,i.isIterable)(t)?r.innerText=`= (${t.toString()})`:r.innerText="= "+(0,i.complexToString)(t),r.classList.add("visible"))},t.inputSetStatusAt=function(e,t){const n=f(e);if(!n)return;const r=n.querySelector(".indicator");if(!r)return;r.classList.remove("pending","active","error");const o=n.querySelector(".const-eval");if(o)switch(t){case a.PlotStatus.PENDING:r.classList.add("pending"),r.innerHTML="",o.classList.remove("visible");break;case a.PlotStatus.ACTIVE:r.classList.add("active"),r.style.backgroundColor=n.getAttribute("data-color")||"#000",r.innerHTML="";break;case a.PlotStatus.ERROR:r.classList.add("error"),r.innerHTML="!",o.classList.remove("visible")}},t.inputSetDriverAt=function(e,t){const n=f(e);if(!n)return;const r=n.querySelector(".const-eval");r&&t!==a.PlotDriver.CONSTANT&&r.classList.remove("visible")};const T=function(e){s.querySelectorAll(".input").forEach((e=>{e.classList.remove("active")})),e.classList.add("active")};t.getLeftPanelWidth=function(){return c.offsetWidth}},139:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initMenuBar=void 0;const r=n(85),o=n(533),a=n(283),i=document.getElementById("menu-bar");t.initMenuBar=function(){Array.from(i.querySelectorAll("button")).forEach((e=>{const t=e.dataset.icon||"",n=e.dataset.href||"",r=e.dataset.filter||"";if(t&&n){const o='<div class="button-icon"></div>',i=(0,a.stringToHTML)(o).firstChild;i.style.backgroundImage=`url('${t}')`,i.style.filter=r,e.appendChild(i),e.addEventListener("click",(()=>{window.open(n,"_blank")}))}}));const e=document.querySelector(".demo-button"),t=document.querySelector(".examples-list");let n,l=0;fetch("assets/demo/demo.json").then((e=>e.json())).then((e=>{var r,a;n=e,l=null==e?void 0:e.numPlots;for(let i=0;i<l;i++){const l=document.createElement("div"),s=document.createElement("h3");s.innerHTML=null===(r=null==e?void 0:e.plots[i])||void 0===r?void 0:r.name,l.appendChild(s),l.classList.add("example-list-item");const u=document.createElement("iframe");u.src=`?plot=${(null===(a=null==n?void 0:n.plots[i])||void 0===a?void 0:a.inputs.map(encodeURIComponent).join(";"))||""}&preview=true`,u.classList.add("example-preview"),u.style.overflow="hidden",u.style.border="none",l.appendChild(u);const c=document.createElement("div");c.classList.add("example-clickable"),c.addEventListener("click",(()=>{var e,t;(0,o.loadPlots)((null===(e=null==n?void 0:n.plots[i])||void 0===e?void 0:e.inputs)||"",(null===(t=null==n?void 0:n.plots[i])||void 0===t?void 0:t.defaults)||"")})),l.appendChild(c),t.appendChild(l)}})),e.addEventListener("click",(()=>{t.classList.toggle("hidden")})),document.querySelector(".menu-bar-title h1").onclick=()=>window.location.replace(window.location.origin),document.querySelector(".export-button").addEventListener("click",(()=>{(0,r.enablePreview)()})),document.querySelector(".exit-fullscreen").addEventListener("click",(()=>{window.location.reload()}))}},750:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initUserInteract=t.onMouseDrag=t.getMousePos=void 0;const r=n(283);let o,a=!1,i=!1;const l=new r.Vector(0,0),s=new Map;t.getMousePos=function(){return l},t.onMouseDrag=function(e,t){s.set(e,t)},t.initUserInteract=function(){document.addEventListener("mousedown",(function(e){i=!0})),document.addEventListener("mousemove",(function(e){if(i)if(l.set(e.clientX,e.clientY),a)o(l);else for(const[t,n]of s)if(null==t?void 0:t.contains(e.target))return n(l),a=!0,void(o=n)})),document.addEventListener("mouseup",(function(e){a=!1,i=!1}))}},283:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.map=t.sigmoid=t.factorial=t.perlin2=t.isIterable=t.cpx=t.complexToString=t.Vector=t.stringToHTML=void 0,t.stringToHTML=function(e){return(new DOMParser).parseFromString(e,"text/html").body};class n{constructor(e,t){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}add(e){return this.x+=e.x,this.y+=e.y,this}mult(e){return this.x*=e,this.y*=e,this}copy(){return new n(this.x,this.y)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}heading(){return Math.atan(this.y/this.x)}rotate(e){const t=this.heading()+e,n=this.mag();return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this}normalize(){const e=this.mag();return 0!==e&&this.mult(1/e),this}setMag(e){return this.normalize().mult(e)}}t.Vector=n,t.complexToString=function(e){const t=Math.round(1e6*e.re)/1e6,n=Math.round(1e6*e.im)/1e6;return 0===n?t.toString():t+" + "+n+"i"},t.cpx=e=>({re:e,im:0}),t.isIterable=e=>null!=e&&"function"==typeof e[Symbol.iterator];const r=new Array(512),o=new Array(512),a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];class i{constructor(e,t,n){this.x=e,this.y=t,this.z=n}}const l=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)];function s(e){return e*e*e*(e*(6*e-15)+10)}function u(e,t,n){return(1-n)*e+n*t}!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(let t=0;t<256;t++){let n;n=1&t?a[t]^255&e:a[t]^e>>8&255,r[t]=r[t+256]=n,o[t]=o[t+256]=l[n%12]}}(12345),t.perlin2=function(e,t){let n=Math.floor(e),a=Math.floor(t);e-=n,t-=a,n&=255,a&=255;const i=o[n+r[a]].dot2(e,t),l=o[n+r[a+1]].dot2(e,t-1),c=o[n+1+r[a]].dot2(e-1,t),E=o[n+1+r[a+1]].dot2(e-1,t-1),g=s(e);return u(u(i,c,g),u(l,E,g),s(t))},t.factorial=function(e){const t=Math.floor(e),n=e-t;let r=function(e){return(((((.07288448978215456*e-.31390051543712616)*e+.6538907084614038)*e-.810425715520978)*e+.9737655441276729)*e-.5761851668648887)*e+.9999830044034752}(n);if(e<0)for(let e=0;e<-t;e++)r/=n-e;else for(let e=1;e<t+1;e++)r*=n+e;return e>0?r:1/0},t.sigmoid=function(e){return 1/(1+Math.exp(-e))},t.map=function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r}},607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFPSSmoothed=t.getGlobalTime=t.scheduleExit=t.scheduleSnapshot=t.scheduleRedraw=void 0;const r=n(320),o=n(139),a=n(85),i=n(750),l=n(533),s=n(682);let u=!0,c=!1,E=!1,g=0,f=0,T=0;const h=Array(1).fill(60);t.scheduleRedraw=function(){u=!0},t.scheduleSnapshot=function(){c=!0},t.scheduleExit=function(){E=!0},t.getGlobalTime=()=>g,t.getFPSSmoothed=()=>h.reduce(((e,t)=>e+t))/h.length,window.onload=function(){(0,i.initUserInteract)(),(0,s.initShaderCore)(),(0,r.initInputs)(),(0,a.initCanvas)()||((0,o.initMenuBar)(),(0,r.initLeftPanel)()),d()};const d=function(){u&&(u=!1,(0,a.canvasDraw)(),(0,s.shadersDraw)(),(0,l.drawPlots)()),(0,a.driveCanvas)(),(0,l.drivePlots)(),(0,s.shaderCoreUpdate)(),g+=.01;const e=Date.now();f=e-T,T=e,h.push(1e3/f),h.length>100&&h.shift(),c&&(c=!1,(0,a.canvasFreezeFrame)()),E||requestAnimationFrame(d)}},633:(e,t,n)=>{n.r(t),n.d(t,{add:()=>j,adjoint:()=>f,clone:()=>i,copy:()=>l,create:()=>a,decompose:()=>F,determinant:()=>T,equals:()=>ee,exactEquals:()=>Z,frob:()=>W,fromQuat:()=>y,fromQuat2:()=>_,fromRotation:()=>A,fromRotationTranslation:()=>P,fromRotationTranslationScale:()=>b,fromRotationTranslationScaleOrigin:()=>x,fromScaling:()=>R,fromTranslation:()=>I,fromValues:()=>s,fromXRotation:()=>S,fromYRotation:()=>v,fromZRotation:()=>O,frustum:()=>D,getRotation:()=>C,getScaling:()=>U,getTranslation:()=>N,identity:()=>c,invert:()=>g,lookAt:()=>q,mul:()=>te,multiply:()=>h,multiplyScalar:()=>K,multiplyScalarAndAdd:()=>J,ortho:()=>X,orthoNO:()=>$,orthoZO:()=>Q,perspective:()=>w,perspectiveFromFieldOfView:()=>V,perspectiveNO:()=>B,perspectiveZO:()=>G,rotate:()=>p,rotateX:()=>m,rotateY:()=>k,rotateZ:()=>L,scale:()=>M,set:()=>u,str:()=>Y,sub:()=>ne,subtract:()=>z,targetTo:()=>H,translate:()=>d,transpose:()=>E});var r=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array;function a(){const e=new o(16);return o!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e){const t=new o(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,n,r,a,i,l,s,u,c,E,g,f,T,h,d){const M=new o(16);return M[0]=e,M[1]=t,M[2]=n,M[3]=r,M[4]=a,M[5]=i,M[6]=l,M[7]=s,M[8]=u,M[9]=c,M[10]=E,M[11]=g,M[12]=f,M[13]=T,M[14]=h,M[15]=d,M}function u(e,t,n,r,o,a,i,l,s,u,c,E,g,f,T,h,d){return e[0]=t,e[1]=n,e[2]=r,e[3]=o,e[4]=a,e[5]=i,e[6]=l,e[7]=s,e[8]=u,e[9]=c,e[10]=E,e[11]=g,e[12]=f,e[13]=T,e[14]=h,e[15]=d,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(e,t){if(e===t){const n=t[1],r=t[2],o=t[3],a=t[6],i=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=o,e[13]=i,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function g(e,t){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],l=t[5],s=t[6],u=t[7],c=t[8],E=t[9],g=t[10],f=t[11],T=t[12],h=t[13],d=t[14],M=t[15],p=n*l-r*i,m=n*s-o*i,k=n*u-a*i,L=r*s-o*l,I=r*u-a*l,R=o*u-a*s,A=c*h-E*T,S=c*d-g*T,v=c*M-f*T,O=E*d-g*h,P=E*M-f*h,_=g*M-f*d;let N=p*_-m*P+k*O+L*v-I*S+R*A;return N?(N=1/N,e[0]=(l*_-s*P+u*O)*N,e[1]=(o*P-r*_-a*O)*N,e[2]=(h*R-d*I+M*L)*N,e[3]=(g*I-E*R-f*L)*N,e[4]=(s*v-i*_-u*S)*N,e[5]=(n*_-o*v+a*S)*N,e[6]=(d*k-T*R-M*m)*N,e[7]=(c*R-g*k+f*m)*N,e[8]=(i*P-l*v+u*A)*N,e[9]=(r*v-n*P-a*A)*N,e[10]=(T*I-h*k+M*p)*N,e[11]=(E*k-c*I-f*p)*N,e[12]=(l*S-i*O-s*A)*N,e[13]=(n*O-r*S+o*A)*N,e[14]=(h*m-T*L-d*p)*N,e[15]=(c*L-E*m+g*p)*N,e):null}function f(e,t){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],l=t[5],s=t[6],u=t[7],c=t[8],E=t[9],g=t[10],f=t[11],T=t[12],h=t[13],d=t[14],M=t[15],p=n*l-r*i,m=n*s-o*i,k=n*u-a*i,L=r*s-o*l,I=r*u-a*l,R=o*u-a*s,A=c*h-E*T,S=c*d-g*T,v=c*M-f*T,O=E*d-g*h,P=E*M-f*h,_=g*M-f*d;return e[0]=l*_-s*P+u*O,e[1]=o*P-r*_-a*O,e[2]=h*R-d*I+M*L,e[3]=g*I-E*R-f*L,e[4]=s*v-i*_-u*S,e[5]=n*_-o*v+a*S,e[6]=d*k-T*R-M*m,e[7]=c*R-g*k+f*m,e[8]=i*P-l*v+u*A,e[9]=r*v-n*P-a*A,e[10]=T*I-h*k+M*p,e[11]=E*k-c*I-f*p,e[12]=l*S-i*O-s*A,e[13]=n*O-r*S+o*A,e[14]=h*m-T*L-d*p,e[15]=c*L-E*m+g*p,e}function T(e){const t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],i=e[5],l=e[6],s=e[7],u=e[8],c=e[9],E=e[10],g=e[11],f=e[12],T=e[13],h=e[14],d=t*i-n*a,M=t*l-r*a,p=n*l-r*i,m=u*T-c*f,k=u*h-E*f,L=c*h-E*T;return s*(t*L-n*k+r*m)-o*(a*L-i*k+l*m)+e[15]*(u*p-c*M+E*d)-g*(f*p-T*M+h*d)}function h(e,t,n){const r=t[0],o=t[1],a=t[2],i=t[3],l=t[4],s=t[5],u=t[6],c=t[7],E=t[8],g=t[9],f=t[10],T=t[11],h=t[12],d=t[13],M=t[14],p=t[15];let m=n[0],k=n[1],L=n[2],I=n[3];return e[0]=m*r+k*l+L*E+I*h,e[1]=m*o+k*s+L*g+I*d,e[2]=m*a+k*u+L*f+I*M,e[3]=m*i+k*c+L*T+I*p,m=n[4],k=n[5],L=n[6],I=n[7],e[4]=m*r+k*l+L*E+I*h,e[5]=m*o+k*s+L*g+I*d,e[6]=m*a+k*u+L*f+I*M,e[7]=m*i+k*c+L*T+I*p,m=n[8],k=n[9],L=n[10],I=n[11],e[8]=m*r+k*l+L*E+I*h,e[9]=m*o+k*s+L*g+I*d,e[10]=m*a+k*u+L*f+I*M,e[11]=m*i+k*c+L*T+I*p,m=n[12],k=n[13],L=n[14],I=n[15],e[12]=m*r+k*l+L*E+I*h,e[13]=m*o+k*s+L*g+I*d,e[14]=m*a+k*u+L*f+I*M,e[15]=m*i+k*c+L*T+I*p,e}function d(e,t,n){const r=n[0],o=n[1],a=n[2];let i,l,s,u,c,E,g,f,T,h,d,M;return t===e?(e[12]=t[0]*r+t[4]*o+t[8]*a+t[12],e[13]=t[1]*r+t[5]*o+t[9]*a+t[13],e[14]=t[2]*r+t[6]*o+t[10]*a+t[14],e[15]=t[3]*r+t[7]*o+t[11]*a+t[15]):(i=t[0],l=t[1],s=t[2],u=t[3],c=t[4],E=t[5],g=t[6],f=t[7],T=t[8],h=t[9],d=t[10],M=t[11],e[0]=i,e[1]=l,e[2]=s,e[3]=u,e[4]=c,e[5]=E,e[6]=g,e[7]=f,e[8]=T,e[9]=h,e[10]=d,e[11]=M,e[12]=i*r+c*o+T*a+t[12],e[13]=l*r+E*o+h*a+t[13],e[14]=s*r+g*o+d*a+t[14],e[15]=u*r+f*o+M*a+t[15]),e}function M(e,t,n){const r=n[0],o=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,n,o){let a,i,l,s,u,c,E,g,f,T,h,d,M,p,m,k,L,I,R,A,S,v,O,P,_=o[0],N=o[1],U=o[2],C=Math.hypot(_,N,U);return C<r?null:(C=1/C,_*=C,N*=C,U*=C,a=Math.sin(n),i=Math.cos(n),l=1-i,s=t[0],u=t[1],c=t[2],E=t[3],g=t[4],f=t[5],T=t[6],h=t[7],d=t[8],M=t[9],p=t[10],m=t[11],k=_*_*l+i,L=N*_*l+U*a,I=U*_*l-N*a,R=_*N*l-U*a,A=N*N*l+i,S=U*N*l+_*a,v=_*U*l+N*a,O=N*U*l-_*a,P=U*U*l+i,e[0]=s*k+g*L+d*I,e[1]=u*k+f*L+M*I,e[2]=c*k+T*L+p*I,e[3]=E*k+h*L+m*I,e[4]=s*R+g*A+d*S,e[5]=u*R+f*A+M*S,e[6]=c*R+T*A+p*S,e[7]=E*R+h*A+m*S,e[8]=s*v+g*O+d*P,e[9]=u*v+f*O+M*P,e[10]=c*v+T*O+p*P,e[11]=E*v+h*O+m*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function m(e,t,n){const r=Math.sin(n),o=Math.cos(n),a=t[4],i=t[5],l=t[6],s=t[7],u=t[8],c=t[9],E=t[10],g=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+u*r,e[5]=i*o+c*r,e[6]=l*o+E*r,e[7]=s*o+g*r,e[8]=u*o-a*r,e[9]=c*o-i*r,e[10]=E*o-l*r,e[11]=g*o-s*r,e}function k(e,t,n){const r=Math.sin(n),o=Math.cos(n),a=t[0],i=t[1],l=t[2],s=t[3],u=t[8],c=t[9],E=t[10],g=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-u*r,e[1]=i*o-c*r,e[2]=l*o-E*r,e[3]=s*o-g*r,e[8]=a*r+u*o,e[9]=i*r+c*o,e[10]=l*r+E*o,e[11]=s*r+g*o,e}function L(e,t,n){const r=Math.sin(n),o=Math.cos(n),a=t[0],i=t[1],l=t[2],s=t[3],u=t[4],c=t[5],E=t[6],g=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+u*r,e[1]=i*o+c*r,e[2]=l*o+E*r,e[3]=s*o+g*r,e[4]=u*o-a*r,e[5]=c*o-i*r,e[6]=E*o-l*r,e[7]=g*o-s*r,e}function I(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function R(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t,n){let o,a,i,l=n[0],s=n[1],u=n[2],c=Math.hypot(l,s,u);return c<r?null:(c=1/c,l*=c,s*=c,u*=c,o=Math.sin(t),a=Math.cos(t),i=1-a,e[0]=l*l*i+a,e[1]=s*l*i+u*o,e[2]=u*l*i-s*o,e[3]=0,e[4]=l*s*i-u*o,e[5]=s*s*i+a,e[6]=u*s*i+l*o,e[7]=0,e[8]=l*u*i+s*o,e[9]=s*u*i-l*o,e[10]=u*u*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function S(e,t){const n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t){const n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function P(e,t,n){const r=t[0],o=t[1],a=t[2],i=t[3],l=r+r,s=o+o,u=a+a,c=r*l,E=r*s,g=r*u,f=o*s,T=o*u,h=a*u,d=i*l,M=i*s,p=i*u;return e[0]=1-(f+h),e[1]=E+p,e[2]=g-M,e[3]=0,e[4]=E-p,e[5]=1-(c+h),e[6]=T+d,e[7]=0,e[8]=g+M,e[9]=T-d,e[10]=1-(c+f),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _(e,t){const n=new o(3),r=-t[0],a=-t[1],i=-t[2],l=t[3],s=t[4],u=t[5],c=t[6],E=t[7],g=r*r+a*a+i*i+l*l;return g>0?(n[0]=2*(s*l+E*r+u*i-c*a)/g,n[1]=2*(u*l+E*a+c*r-s*i)/g,n[2]=2*(c*l+E*i+s*a-u*r)/g):(n[0]=2*(s*l+E*r+u*i-c*a),n[1]=2*(u*l+E*a+c*r-s*i),n[2]=2*(c*l+E*i+s*a-u*r)),P(e,t,n),e}function N(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function U(e,t){const n=t[0],r=t[1],o=t[2],a=t[4],i=t[5],l=t[6],s=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(n,r,o),e[1]=Math.hypot(a,i,l),e[2]=Math.hypot(s,u,c),e}function C(e,t){const n=new o(3);U(n,t);const r=1/n[0],a=1/n[1],i=1/n[2],l=t[0]*r,s=t[1]*a,u=t[2]*i,c=t[4]*r,E=t[5]*a,g=t[6]*i,f=t[8]*r,T=t[9]*a,h=t[10]*i,d=l+E+h;let M=0;return d>0?(M=2*Math.sqrt(d+1),e[3]=.25*M,e[0]=(g-T)/M,e[1]=(f-u)/M,e[2]=(s-c)/M):l>E&&l>h?(M=2*Math.sqrt(1+l-E-h),e[3]=(g-T)/M,e[0]=.25*M,e[1]=(s+c)/M,e[2]=(f+u)/M):E>h?(M=2*Math.sqrt(1+E-l-h),e[3]=(f-u)/M,e[0]=(s+c)/M,e[1]=.25*M,e[2]=(g+T)/M):(M=2*Math.sqrt(1+h-l-E),e[3]=(s-c)/M,e[0]=(f+u)/M,e[1]=(g+T)/M,e[2]=.25*M),e}function F(e,t,n,r){t[0]=r[12],t[1]=r[13],t[2]=r[14];const o=r[0],a=r[1],i=r[2],l=r[4],s=r[5],u=r[6],c=r[8],E=r[9],g=r[10];n[0]=Math.hypot(o,a,i),n[1]=Math.hypot(l,s,u),n[2]=Math.hypot(c,E,g);const f=1/n[0],T=1/n[1],h=1/n[2],d=o*f,M=a*T,p=i*h,m=l*f,k=s*T,L=u*h,I=c*f,R=E*T,A=g*h,S=d+k+A;let v=0;return S>0?(v=2*Math.sqrt(S+1),e[3]=.25*v,e[0]=(L-R)/v,e[1]=(I-p)/v,e[2]=(M-m)/v):d>k&&d>A?(v=2*Math.sqrt(1+d-k-A),e[3]=(L-R)/v,e[0]=.25*v,e[1]=(M+m)/v,e[2]=(I+p)/v):k>A?(v=2*Math.sqrt(1+k-d-A),e[3]=(I-p)/v,e[0]=(M+m)/v,e[1]=.25*v,e[2]=(L+R)/v):(v=2*Math.sqrt(1+A-d-k),e[3]=(M-m)/v,e[0]=(I+p)/v,e[1]=(L+R)/v,e[2]=.25*v),e}function b(e,t,n,r){const o=t[0],a=t[1],i=t[2],l=t[3],s=o+o,u=a+a,c=i+i,E=o*s,g=o*u,f=o*c,T=a*u,h=a*c,d=i*c,M=l*s,p=l*u,m=l*c,k=r[0],L=r[1],I=r[2];return e[0]=(1-(T+d))*k,e[1]=(g+m)*k,e[2]=(f-p)*k,e[3]=0,e[4]=(g-m)*L,e[5]=(1-(E+d))*L,e[6]=(h+M)*L,e[7]=0,e[8]=(f+p)*I,e[9]=(h-M)*I,e[10]=(1-(E+T))*I,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function x(e,t,n,r,o){const a=t[0],i=t[1],l=t[2],s=t[3],u=a+a,c=i+i,E=l+l,g=a*u,f=a*c,T=a*E,h=i*c,d=i*E,M=l*E,p=s*u,m=s*c,k=s*E,L=r[0],I=r[1],R=r[2],A=o[0],S=o[1],v=o[2],O=(1-(h+M))*L,P=(f+k)*L,_=(T-m)*L,N=(f-k)*I,U=(1-(g+M))*I,C=(d+p)*I,F=(T+m)*R,b=(d-p)*R,x=(1-(g+h))*R;return e[0]=O,e[1]=P,e[2]=_,e[3]=0,e[4]=N,e[5]=U,e[6]=C,e[7]=0,e[8]=F,e[9]=b,e[10]=x,e[11]=0,e[12]=n[0]+A-(O*A+N*S+F*v),e[13]=n[1]+S-(P*A+U*S+b*v),e[14]=n[2]+v-(_*A+C*S+x*v),e[15]=1,e}function y(e,t){const n=t[0],r=t[1],o=t[2],a=t[3],i=n+n,l=r+r,s=o+o,u=n*i,c=r*i,E=r*l,g=o*i,f=o*l,T=o*s,h=a*i,d=a*l,M=a*s;return e[0]=1-E-T,e[1]=c+M,e[2]=g-d,e[3]=0,e[4]=c-M,e[5]=1-u-T,e[6]=f+h,e[7]=0,e[8]=g+d,e[9]=f-h,e[10]=1-u-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function D(e,t,n,r,o,a,i){const l=1/(n-t),s=1/(o-r),u=1/(a-i);return e[0]=2*a*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*s,e[6]=0,e[7]=0,e[8]=(n+t)*l,e[9]=(o+r)*s,e[10]=(i+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*a*2*u,e[15]=0,e}function B(e,t,n,r,o){const a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0){const t=1/(r-o);e[10]=(o+r)*t,e[14]=2*o*r*t}else e[10]=-1,e[14]=-2*r;return e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){let e=0,t=arguments.length;for(;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var w=B;function G(e,t,n,r,o){const a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0){const t=1/(r-o);e[10]=o*t,e[14]=o*r*t}else e[10]=-1,e[14]=-r;return e}function V(e,t,n,r){const o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+l),u=2/(o+a);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(i-l)*s*.5,e[9]=(o-a)*u*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function $(e,t,n,r,o,a,i){const l=1/(t-n),s=1/(r-o),u=1/(a-i);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*l,e[13]=(o+r)*s,e[14]=(i+a)*u,e[15]=1,e}var X=$;function Q(e,t,n,r,o,a,i){const l=1/(t-n),s=1/(r-o),u=1/(a-i);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+n)*l,e[13]=(o+r)*s,e[14]=a*u,e[15]=1,e}function q(e,t,n,o){let a,i,l,s,u,E,g,f,T,h;const d=t[0],M=t[1],p=t[2],m=o[0],k=o[1],L=o[2],I=n[0],R=n[1],A=n[2];return Math.abs(d-I)<r&&Math.abs(M-R)<r&&Math.abs(p-A)<r?c(e):(g=d-I,f=M-R,T=p-A,h=1/Math.hypot(g,f,T),g*=h,f*=h,T*=h,a=k*T-L*f,i=L*g-m*T,l=m*f-k*g,h=Math.hypot(a,i,l),h?(h=1/h,a*=h,i*=h,l*=h):(a=0,i=0,l=0),s=f*l-T*i,u=T*a-g*l,E=g*i-f*a,h=Math.hypot(s,u,E),h?(h=1/h,s*=h,u*=h,E*=h):(s=0,u=0,E=0),e[0]=a,e[1]=s,e[2]=g,e[3]=0,e[4]=i,e[5]=u,e[6]=f,e[7]=0,e[8]=l,e[9]=E,e[10]=T,e[11]=0,e[12]=-(a*d+i*M+l*p),e[13]=-(s*d+u*M+E*p),e[14]=-(g*d+f*M+T*p),e[15]=1,e)}function H(e,t,n,r){const o=t[0],a=t[1],i=t[2],l=r[0],s=r[1],u=r[2];let c=o-n[0],E=a-n[1],g=i-n[2],f=c*c+E*E+g*g;f>0&&(f=1/Math.sqrt(f),c*=f,E*=f,g*=f);let T=s*g-u*E,h=u*c-l*g,d=l*E-s*c;return f=T*T+h*h+d*d,f>0&&(f=1/Math.sqrt(f),T*=f,h*=f,d*=f),e[0]=T,e[1]=h,e[2]=d,e[3]=0,e[4]=E*d-g*h,e[5]=g*T-c*d,e[6]=c*h-E*T,e[7]=0,e[8]=c,e[9]=E,e[10]=g,e[11]=0,e[12]=o,e[13]=a,e[14]=i,e[15]=1,e}function Y(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function W(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function j(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function z(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function K(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function J(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ee(e,t){const n=e[0],o=e[1],a=e[2],i=e[3],l=e[4],s=e[5],u=e[6],c=e[7],E=e[8],g=e[9],f=e[10],T=e[11],h=e[12],d=e[13],M=e[14],p=e[15],m=t[0],k=t[1],L=t[2],I=t[3],R=t[4],A=t[5],S=t[6],v=t[7],O=t[8],P=t[9],_=t[10],N=t[11],U=t[12],C=t[13],F=t[14],b=t[15];return Math.abs(n-m)<=r*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(o-k)<=r*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(a-L)<=r*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(i-I)<=r*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(l-R)<=r*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(s-A)<=r*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-S)<=r*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-v)<=r*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(E-O)<=r*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(g-P)<=r*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(f-_)<=r*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(T-N)<=r*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(h-U)<=r*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(d-C)<=r*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(M-F)<=r*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(p-b)<=r*Math.max(1,Math.abs(p),Math.abs(b))}var te=h,ne=z}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607)})();