(()=>{"use strict";var e={85:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDomain=t.canvasDrawFunction=t.driveCanvas=t.canvasDraw=t.resetCanvas=t.getOffset=t.getScale=t.canvasGetImageDataURL=t.canvasFreezeFrame=t.enablePreview=t.initCanvas=t.mainCanvas=void 0;const o=n(283),r=n(607),a=n(750),l=n(984),i=n(99),s=n(533);t.mainCanvas=document.getElementById("main-canvas");const u=t.mainCanvas.getContext("2d"),c=document.querySelector(".zoom-in-button"),E=document.querySelector(".zoom-out-button"),g=document.querySelector(".fps-display"),f=document.getElementById("app"),T=new o.Vector(0,0);let h=1;const d=16,M=new o.Vector(0,0),p=new o.Vector(0,0);let k=!1,m=!0,L="";const I=function(e){const t=(h*(e>0?1+.2*e:1/(1-.2*e))-h)/10;let n=0;const o=setInterval((function(){h+=t,(0,r.scheduleRedraw)(),n++,n>=10&&clearInterval(o)}),10)};t.initCanvas=function(){t.mainCanvas.addEventListener("mousedown",(function(e){M.set(T.x,T.y),p.set(e.clientX,e.clientY),k=!0})),(0,a.onMouseDrag)(t.mainCanvas,(e=>{k&&(T.x=M.x+e.x-p.x,T.y=M.y+e.y-p.y,(0,r.scheduleRedraw)())})),t.mainCanvas.addEventListener("mouseup",(()=>{k=!1})),t.mainCanvas.addEventListener("mouseleave",(()=>{k=!1})),t.mainCanvas.addEventListener("wheel",(e=>{!function(e){const t=e>0?1+.2*e:1/(1-.2*e);h*=t,T.x*=t,T.y*=t,(0,r.scheduleRedraw)()}(-e.deltaY/200)})),c.addEventListener("click",(()=>{I(1)})),E.addEventListener("click",(()=>{I(-1)})),(0,i.bindExternVariable)("scale",(()=>h),(e=>{h=e,(0,r.scheduleRedraw)()})),(0,i.bindExternVariable)("grid",(()=>m?1:0),(e=>{m=e>0,(0,r.scheduleRedraw)()})),(0,i.bindExternVariable)("offset",(()=>[T.x,T.y]),(e=>{R(e[0],e[1]),(0,r.scheduleRedraw)()})),window.onresize=()=>(0,r.scheduleRedraw)();const e=new URLSearchParams(window.location.search),n=e.get("plot"),o=e.get("scale"),l=e.get("preview");return n&&(0,s.loadPlots)(n.split(";"),[]),o&&(h=parseFloat(o)),!(!l||"true"!==l||((0,t.enablePreview)(),f.classList.add("preview"),0))},t.enablePreview=function(){m=!1,f.classList.add("fullscreen"),(0,r.scheduleRedraw)(),setTimeout((()=>{(0,r.scheduleSnapshot)(),(0,r.scheduleExit)()}),100)},t.canvasFreezeFrame=function(){const e=document.getElementById("shader-canvas");if(!u)return;u.drawImage(e,0,0,t.mainCanvas.width,t.mainCanvas.height);const n=document.createElement("img");n.src=t.mainCanvas.toDataURL("image/png"),L=n.src,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.objectFit="cover",document.body.appendChild(n)},t.canvasGetImageDataURL=()=>L;const R=function(e,n){T.x=-e*(t.mainCanvas.width/d),T.y=n*(t.mainCanvas.height/d)};t.getScale=()=>h,t.getOffset=()=>T,t.resetCanvas=function(){h=1,T.set(0,0),(0,r.scheduleRedraw)()},t.canvasDraw=function(){u&&(t.mainCanvas.width=t.mainCanvas.clientWidth,t.mainCanvas.height=t.mainCanvas.clientHeight,u.clearRect(0,0,t.mainCanvas.width,t.mainCanvas.height),S())},t.driveCanvas=function(){g.innerHTML=(0,r.getFPSSmoothed)().toFixed(0)};const A=function(e,t,n,o){u&&(u.beginPath(),u.moveTo(e,t),u.lineTo(n,o),u.stroke())},S=function(){if(!u||!m)return;const e=t.mainCanvas.width,n=t.mainCanvas.height,o=e/n;u.strokeStyle="#fff",u.lineWidth=2,A(e/2+T.x,0,e/2+T.x,n),A(0,n/2+T.y,e,n/2+T.y);const r=Math.pow(2,Math.floor(Math.log(h)/Math.log(2))),a=n/d/r*h;let l=-Math.floor(d/h/2*r)/r-Math.floor(T.y/a)/r-(T.y<0?1/r:0)-1/r;const i=(n%(2*a)-2*a)/2,s=T.y%a;for(let t=0;t<n+2*a;t+=a,l+=1/r)u.strokeStyle="#666",u.lineWidth=.5,A(0,t+i+s,e,t+i+s),u.strokeStyle="transparent",u.fillStyle="#fff",u.textAlign="right",0!==l&&(u.beginPath(),u.fillText((-l).toString(),e/2+T.x-10,t+i+s+4));const c=e/d/r/o*h;let E=-Math.floor(d/h/2*r*o)/r-Math.floor(T.x/c)/r-(T.x<0?1/r:0)-1/r;const g=(e%(2*c)-2*c)/2,f=T.x%c;for(let t=0;t<e+c;t+=c,E+=1/r)u.strokeStyle="#666",u.lineWidth=.5,A(t+g+f,0,t+g+f,n),u.strokeStyle="transparent",u.fillStyle="#fff",u.textAlign="center",0!==E?(u.beginPath(),u.fillText(E.toString(),t+g+f,n/2+T.y+20)):(u.beginPath(),u.fillText((-E).toString(),t+g+f-18,n/2+T.y+20))};t.canvasDrawFunction=function(e,n){if(!u||!e)return;const r=t.mainCanvas.width,a=t.mainCanvas.height,i=r/a;u.strokeStyle=n,u.lineWidth=2.5,u.fillStyle="transparent",u.beginPath();const s=r/d/i*h,c=T.x/s;let E=!0;for(let t=-8*i/h-c;t<8*i/h-c;t+=.01/h){const n=(0,l.constantEvalX)(e,t),s="number"==typeof n?n:n.re;if((0,l.constantEvalGetError)())return;const c=(0,o.map)(t,-8*i/h,8*i/h,0,r)+T.x,g=(0,o.map)(s,-8/h,8/h,a,0)+T.y;E&&(u.moveTo(c,g),E=!1),u.lineTo(c,g)}u.stroke()},t.getDomain=function(){const e=t.mainCanvas.width,n=t.mainCanvas.height,o=e/n,r=e/d/o*h,a=T.x/r,l=-8*o/h-a,i=8*o/h-a,s=n/d*h,u=T.y/s;return{minX:l,maxX:i,minY:-8/h+u,maxY:8/h+u}}},984:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.constantEvalGetError=t.constantEvalX=t.constantEval=void 0;const o=n(607),r=n(99),a=n(750),l=n(283);let i,s=null,u=0,c=1;t.constantEval=function(e){return e?(s=null,u=0,c=1,g(e)):0},t.constantEvalX=function(e,n){i=n;const o=(0,t.constantEval)(e);return i=null,o};const E=function(e){return console.error("Error during constant evaluation: "+e),s=e,0};t.constantEvalGetError=()=>s;const g=function(e){var t,n;let s,f;switch(e.op.tok){case r.Token.UNDEF:return E("Token UNDEFINED is not allowed");case r.Token.NONE:return 0;case r.Token.PAREN_OP:return E("Token OPEN PARENTHESIS is not allowed");case r.Token.PAREN_CL:return E("Token CLOSE PARENTHESIS is not allowed");case r.Token.BRACKET_OP:return E("Token OPEN BRACKET is not allowed");case r.Token.BRACKET_CL:return E("Token CLOSE BRACKET is not allowed");case r.Token.BRACE_OP:return E("Token OPEN BRACE is not allowed");case r.Token.BRACE_CL:return E("Token CLOSE BRACE is not allowed");case r.Token.NUM:return"number"!=typeof e.op.val?E("Token NUMBER must be a number"):(0,l.cpx)(e.op.val);case r.Token.CONST:return"number"!=typeof e.op.val?E("Token CONSTANT must be a number"):(0,l.cpx)(e.op.val);case r.Token.VAR:return null==i?E("Token VARIABLE is not defined"):(0,l.cpx)(i);case r.Token.VAR2:return E("Token VARIABLE2 is not allowed");case r.Token.TIME:return(0,o.scheduleRedraw)(),(0,l.cpx)((0,o.getGlobalTime)());case r.Token.ADD:return null==e.left||null==e.right?E("Missing arguments for Token ADDITION"):(s=g(e.left),f=g(e.right),{re:s.re+f.re,im:s.im+f.im});case r.Token.SUB:return null==e.left||null==e.right?E("Missing arguments for Token SUBTRACTION"):(s=g(e.left),f=g(e.right),{re:s.re-f.re,im:s.im-f.im});case r.Token.MULT:return null==e.left||null==e.right?E("Missing arguments for Token MULTIPLICATION"):(s=g(e.left),f=g(e.right),0===s.im&&0===f.im?(0,l.cpx)(s.re*f.re):{re:s.re*f.re-s.im*f.im,im:s.re*f.im+s.im*f.re});case r.Token.DIV:{if(null==e.left||null==e.right)return E("Missing arguments for Token DIVISION");if(s=g(e.left),f=g(e.right),0===f.re&&0===f.im)return E("Division by zero");if(0===s.im&&0===f.im)return(0,l.cpx)(s.re/f.re);const t=f.re*f.re+f.im*f.im;return{re:(s.re*f.re+s.im*f.im)/t,im:(s.im*f.re-s.re*f.im)/t}}case r.Token.POW:{if(null==e.left||null==e.right)return E("Missing arguments for Token POWER");if(s=g(e.left),f=g(e.right),0===s.im&&0===f.im)return(0,l.cpx)(Math.pow(s.re,f.re));if(0!==f.im)return E("Imaginary power is not allowed");const t=Math.sqrt(s.re*s.re+s.im*s.im),n=Math.atan2(s.im,s.re),o=Math.pow(t,f.re),r=f.re*n;return{re:o*Math.cos(r),im:o*Math.sin(r)}}case r.Token.SQRT:return null==e.right?E("Missing argument for Token SQUARE ROOT"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.sqrt(f.re)):E("SQUARE ROOT is not defined for complex numbers"));case r.Token.LOG:return null==e.right?E("Missing argument for Token LOGARITHM"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.log(f.re)):E("LOGARITHM is not defined for complex numbers"));case r.Token.EXP:return null==e.right?E("Missing argument for Token EXPOENTIAL"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.exp(f.re)):{re:Math.exp(f.re)*Math.cos(f.im),im:Math.exp(f.re)*Math.sin(f.im)});case r.Token.SIN:return null==e.right?E("Missing argument for Token SINE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.sin(f.re)):{re:Math.sin(f.re)*Math.cosh(f.im),im:Math.cos(f.re)*Math.sinh(f.im)});case r.Token.COS:return null==e.right?E("Missing argument for Token COSINE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.cos(f.re)):{re:Math.cos(f.re)*Math.cosh(f.im),im:-Math.sin(f.re)*Math.sinh(f.im)});case r.Token.TAN:return null==e.right?E("Missing argument for Token TANGENT"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.tan(f.re)):{re:Math.sin(2*f.re)/(Math.cos(2*f.re)+Math.cosh(2*f.im)),im:Math.sinh(2*f.im)/(Math.cos(2*f.re)+Math.cosh(2*f.im))});case r.Token.ASIN:return null==e.right?E("Missing argument for Token ARC SINE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.asin(f.re)):{re:Math.log(f.re+Math.sqrt(1-f.re*f.re)),im:Math.sign(f.im)*Math.sqrt(1-f.re*f.re)});case r.Token.SINH:return null==e.right?E("Missing argument for Token SINE HYPERBOLICUS"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.sinh(f.re)):{re:Math.cosh(f.re)*Math.cos(f.im),im:Math.sinh(f.re)*Math.sin(f.im)});case r.Token.COSH:return null==e.right?E("Missing argument for Token COSINE HYPERBOLICUS"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.cosh(f.re)):{re:Math.cosh(f.re)*Math.cos(f.im),im:Math.sinh(f.re)*Math.sin(f.im)});case r.Token.TANH:return null==e.right?E("Missing argument for Token TANGENT HYPERBOLICUS"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.tanh(f.re)):{re:Math.cosh(2*f.re)/(Math.cos(2*f.re)+Math.cosh(2*f.im)),im:Math.sinh(2*f.im)/(Math.cos(2*f.re)+Math.cosh(2*f.im))});case r.Token.ACOS:return null==e.right?E("Missing argument for Token ARC COSINE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.acos(f.re)):{re:Math.log(f.re+Math.sqrt(1-f.re*f.re)),im:-Math.sign(f.im)*Math.sqrt(1-f.re*f.re)});case r.Token.ATAN:return null==e.right?E("Missing argument for Token ARC TANGENT"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.atan(f.re)):{re:Math.atan(f.re/f.im),im:Math.log((1+f.im)/(1-f.im))/2});case r.Token.FLOOR:return null==e.right?E("Missing argument for Token FLOOR"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.floor(f.re)):E("FLOOR is not defined for complex numbers"));case r.Token.MIN:{if(null==e.right)return E("Missing argument for Token MIN");if(!(0,l.isIterable)(g(e.right)))return E("Malformed argument for Token MIN");const t=[...g(e.right)];return(0,l.cpx)(Math.min(...t))}case r.Token.MAX:{if(null==e.right)return E("Missing argument for Token MAX");if(!(0,l.isIterable)(g(e.right)))return E("Malformed argument for Token MAX");const t=[...g(e.right)];return(0,l.cpx)(Math.max(...t))}case r.Token.DELIM:{if(null==e.left||null==e.right)return E("Missing arguments for Token DELIMITER");s=g(e.left),f=g(e.right);const t=[];return"number"==typeof(null==s?void 0:s.re)?t.push(null==s?void 0:s.re):t.concat(null==s?void 0:s.re),"number"==typeof(null==f?void 0:f.re)?t.push(null==f?void 0:f.re):t.concat(null==f?void 0:f.re),t}case r.Token.ABS:return null==e.right?E("Missing argument for Token ABSOLUTE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.abs(f.re)):(0,l.cpx)(Math.sqrt(f.re*f.re+f.im*f.im)));case r.Token.RAND:return null==e.right?E("Missing argument for Token RANDOM"):(0,l.cpx)(Math.random()*g(e.right));case r.Token.PERLIN:{if(null==e.right)return E("Missing arguments for Token PERLIN");if(!(0,l.isIterable)(g(e.right)))return E("Malformed argument for Token PERLIN");const[t,n]=g(e.right);return(0,l.cpx)((0,l.perlin2)(t,n))}case r.Token.MOD:return null==e.left||null==e.right?E("Missing arguments for Token MODULUS"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re%f.re):E("MODULUS is not defined for complex numbers"));case r.Token.LEVEL_SET:return E("Token LEVEL SET is not allowed");case r.Token.VECTOR_FIELD:return E("Token VECTOR FIELD is not allowed");case r.Token.LESS:return null==e.left||null==e.right?E("Missing arguments for Token LESS THAN"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re<f.re?1:0):E("LESS THAN is not defined for complex numbers"));case r.Token.GREATER:return null==e.left||null==e.right?E("Missing arguments for Token GREATER THAN"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re>f.re?1:0):E("GREATER THAN is not defined for complex numbers"));case r.Token.LESS_OR_EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token LESS THAN OR EQUAL TO"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re<=f.re?1:0):E("LESS THAN OR EQUAL TO is not defined for complex numbers"));case r.Token.GREATER_OR_EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token GREATER THAN OR EQUAL TO"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re>=f.re?1:0):E("GREATER THAN OR EQUAL TO is not defined for complex numbers"));case r.Token.EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token EQUAL TO"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(Math.abs(s.re-f.re)<1e-10?1:0):(0,l.cpx)(Math.abs(s.re-f.re)<1e-10&&Math.abs(s.im-f.im)<1e-10?1:0));case r.Token.AND:return null==e.left||null==e.right?E("Missing arguments for Token AND"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re&&f.re?1:0):E("AND is not defined for complex numbers"));case r.Token.OR:return null==e.left||null==e.right?E("Missing arguments for Token OR"):(s=g(e.left),f=g(e.right),0===f.im?(0,l.cpx)(s.re||f.re?1:0):E("OR is not defined for complex numbers"));case r.Token.USERVAR:return(0,l.cpx)((0,r.getUserVariable)(e.op.val));case r.Token.FACTORIAL:return null==e.right?E("Missing argument for Token FACTORIAL"):(f=g(e.right),0===f.im?(0,l.cpx)((0,l.factorial)(f.re)):E("FACTORIAL is not defined for complex numbers"));case r.Token.SIGMOID:return null==e.right?E("Missing argument for Token SIGMOID"):(f=g(e.right),0===f.im?(0,l.cpx)((0,l.sigmoid)(f.re)):E("SIGMOID is not defined for complex numbers"));case r.Token.CIRCLE:return E("Token CIRCLE is not allowed");case r.Token.POINT:return E("Token POINT is not allowed");case r.Token.TRUE:return(0,l.cpx)(1);case r.Token.FALSE:return(0,l.cpx)(0);case r.Token.POLAR:return E("Token POLAR is not allowed");case r.Token.CARTESIAN:return E("Token CARTESIAN is not allowed");case r.Token.MOUSEX:return(0,l.cpx)((0,a.getMousePos)().x);case r.Token.MOUSEY:return(0,l.cpx)((0,a.getMousePos)().y);case r.Token.MOUSE:return[(0,a.getMousePos)().x,(0,a.getMousePos)().y];case r.Token.IMAGINARY:return{re:0,im:1};case r.Token.SERIES:{if(null==e.right||null==e.right.left||null==e.right.right||null==e.right.left.left||null==e.right.left.right)return E("Missing argument for Token SERIES");const t=g(e.right.left.left).re,n=g(e.right.left.right).re,o=e.right.right;for(u=t;c<=n;c++)u=g(o).re;return(0,l.cpx)(u)}case r.Token.DIV_SERIES:return E("Token SERIES not implemented");case r.Token.ITERATOR:return(0,l.cpx)(u);case r.Token.INDEX:return(0,l.cpx)(c);case r.Token.COMPLEX:return E("Token COMPLEX is not allowed");case r.Token.GRADIENT:return E("Token GRADIENT is not allowed");case r.Token.MAGNITUDE:return null==e.right?E("Missing argument for Token MAGNITUDE"):(f=g(e.right),0===f.im?(0,l.cpx)(Math.abs(f.re)):null==e.right?E("Missing argument for Token SIGMOID"):(0,l.cpx)(Math.sqrt(f.re*f.re+f.im*f.im)));case r.Token.ASSIGN:return null==e.left||null==e.right?E("Missing arguments for Token ASSIGN"):e.left.op.tok!==r.Token.ASSIGNABLE?e.left.op.tok===r.Token.USERVAR?((0,r.setUserVariable)(e.left.op.val,g(e.right).re),g(e.right)):E("Left side of ASSIGN must be assignable"):null==(0,r.getExternVariable)(e.left.op.val)?E(`Variable ${e.left.op.val} does not exist`):(f=g(e.right),null===(t=(0,r.getExternVariable)(e.left.op.val))||void 0===t||t.set((null==f?void 0:f.re)?f.re:f),g(e.right));case r.Token.ASSIGNABLE:{if(null==(0,r.getExternVariable)(e.op.val))return E(`Variable ${e.op.val} does not exist`);const t=null===(n=(0,r.getExternVariable)(e.op.val))||void 0===n?void 0:n.get();return(0,l.isIterable)(t)?t:(0,l.cpx)(t)}default:return E(`Unknown token ${e.op.tok}`)}}},533:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPlotsShaderInfo=t.drawPlots=t.drivePlots=t.loadPlots=t.resetPlots=t.setNumInputs=t.setInputAt=void 0;const o=n(607),r=n(85),a=n(195),l=n(103),i=n(849),s=n(320),u=n(984),c=[];let E=0;t.setInputAt=(e,t)=>{e<0||e>E||(c[e]||(c[e]=f(e),(0,s.inputSetColorAt)(e,c[e].color)),c[e].input=t,c[e].inputChanged=!0,(0,o.scheduleRedraw)())},t.setNumInputs=e=>{E=e;for(let e=E;e<c.length;e++)delete c[e];(0,o.scheduleRedraw)()},t.resetPlots=()=>{c.length=0,(0,o.scheduleRedraw)()};const g=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];t.loadPlots=function(e,n){(0,r.resetCanvas)(),(0,s.resetInputs)(),(0,t.setNumInputs)(n.length);for(let e=0;e<n.length;e++)(0,s.addNewInputWithValue)(n[e]);(0,t.drivePlots)(),(0,t.drawPlots)(),(0,s.resetInputs)(),(0,t.setNumInputs)(e.length);for(let t=0;t<e.length;t++)(0,s.addNewInputWithValue)(e[t])};const f=function(e){return{input:"",inputChanged:!1,ast:null,status:a.PlotStatus.PENDING,driver:a.PlotDriver.CANVAS,displayMode:a.PlotDisplayMode.NONE,shaderFunction:"",continuous:!1,color:(t=e,g[(t-1)%g.length]),error:"",iterExpr:""};var t};t.drivePlots=()=>{let e=!1;for(let t=1;t<=E;t++){c[t]||(c[t]=f(t),(0,s.inputSetColorAt)(t,c[t].color));const n=c[t];if(n.inputChanged){e=!0,n.inputChanged=!1;const r=n.status;if(0===n.input.trim().length){n.status=a.PlotStatus.PENDING,n.ast=null,r!==n.status&&(0,s.inputSetStatusAt)(t,n.status),(0,o.scheduleRedraw)();continue}const u=n.ast;n.ast=(0,l.parse)(n.input),console.debug("Parsed AST:",n.ast);const c=n.error,E=(0,l.parserGetError)();E?(n.status=a.PlotStatus.ERROR,n.error=E.desc):(n.status=a.PlotStatus.ACTIVE,n.error=""),JSON.stringify(u)!==JSON.stringify(n.ast)&&(0,o.scheduleRedraw)();const g=(0,l.parserGetDriver)();if(n.driver!==g&&(n.driver=g,(0,s.inputSetDriverAt)(t,g)),n.displayMode=(0,l.parserGetDisplayMode)(),n.driver===a.PlotDriver.WEBGL){n.shaderFunction=(0,i.buildShaderFunction)(n.ast)||"undefined",n.iterExpr=(0,i.shaderFunctionBuilderGetIterExpression)();const e=(0,i.shaderFunctionBuilderGetError)();e&&(n.status=a.PlotStatus.ERROR,n.error=e)}n.continuous=(0,l.parserGetContinuous)(),n.status!==r&&(0,s.inputSetStatusAt)(t,n.status),n.error!==c&&(0,s.inputSetErrorAt)(t,n.error)}}if(e){const e=[];for(let t=1;t<=E;t++)e.push(c[t].input);let t="?";t+="plot="+e.map((e=>encodeURIComponent(e))).join(";"),t+="&scale="+(0,r.getScale)(),window.history.pushState("","",t)}},t.drawPlots=()=>{for(let e=1;e<=E;e++){const t=c[e];if(t&&t.status===a.PlotStatus.ACTIVE){switch(t.driver){case a.PlotDriver.CONSTANT:{const n=(0,u.constantEval)(t.ast);(0,s.inputSetConstEvalAt)(e,n);const o=(0,u.constantEvalGetError)();o&&(t.status=a.PlotStatus.ERROR,t.error=o,(0,s.inputSetStatusAt)(e,t.status),(0,s.inputSetErrorAt)(e,t.error));break}case a.PlotDriver.CANVAS:{(0,r.canvasDrawFunction)(t.ast,t.color);const n=(0,u.constantEvalGetError)();n&&(t.status=a.PlotStatus.ERROR,t.error=n,(0,s.inputSetStatusAt)(e,t.status),(0,s.inputSetErrorAt)(e,t.error));break}case a.PlotDriver.WEBGL:}t.continuous&&(0,o.scheduleRedraw)()}}},t.getPlotsShaderInfo=()=>{const e=[],t=[],n=[],o=[];let r=0;for(let l=1;l<=E;l++){const i=c[l];i&&i.driver===a.PlotDriver.WEBGL&&i.status===a.PlotStatus.ACTIVE&&i.driver===a.PlotDriver.WEBGL&&(e.push(i.shaderFunction),t.push(i.color),n.push(i.displayMode),o.push(i.iterExpr),r++)}return{functions:e,colors:t,displayModes:n,numPlots:r,iterExpr:o}}},195:(e,t)=>{var n,o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PlotDriver=t.PlotStatus=t.PlotDisplayMode=void 0,(r=t.PlotDisplayMode||(t.PlotDisplayMode={}))[r.NONE=0]="NONE",r[r.CONSTANT_EVAL=1]="CONSTANT_EVAL",r[r.FUNCTION_GRAPH=2]="FUNCTION_GRAPH",r[r.SET=3]="SET",r[r.LEVEL_SET=4]="LEVEL_SET",r[r.VECTOR_FIELD=5]="VECTOR_FIELD",r[r.GRADIENT=6]="GRADIENT",(o=t.PlotStatus||(t.PlotStatus={}))[o.PENDING=0]="PENDING",o[o.ACTIVE=1]="ACTIVE",o[o.ERROR=2]="ERROR",(n=t.PlotDriver||(t.PlotDriver={}))[n.CONSTANT=0]="CONSTANT",n[n.CANVAS=1]="CANVAS",n[n.WEBGL=2]="WEBGL"},99:(e,t)=>{var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.lex=t.clearUserVariables=t.getUserVariable=t.setUserVariable=t.getExternVariable=t.unbindExternVariable=t.bindExternVariable=t.lexerGetError=t.TokenFlag=t.Token=void 0,function(e){e[e.UNDEF=0]="UNDEF",e[e.NONE=1]="NONE",e[e.VAR=2]="VAR",e[e.VAR2=3]="VAR2",e[e.NUM=4]="NUM",e[e.CONST=5]="CONST",e[e.PAREN_OP=6]="PAREN_OP",e[e.PAREN_CL=7]="PAREN_CL",e[e.BRACKET_OP=8]="BRACKET_OP",e[e.BRACKET_CL=9]="BRACKET_CL",e[e.BRACE_OP=10]="BRACE_OP",e[e.BRACE_CL=11]="BRACE_CL",e[e.DELIM=12]="DELIM",e[e.ASSIGN=13]="ASSIGN",e[e.ASSIGNABLE=14]="ASSIGNABLE",e[e.LESS=15]="LESS",e[e.GREATER=16]="GREATER",e[e.LESS_OR_EQUAL=17]="LESS_OR_EQUAL",e[e.GREATER_OR_EQUAL=18]="GREATER_OR_EQUAL",e[e.USERVAR=19]="USERVAR",e[e.ADD=20]="ADD",e[e.SUB=21]="SUB",e[e.MULT=22]="MULT",e[e.DIV=23]="DIV",e[e.POW=24]="POW",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.NOT_EQUAL=27]="NOT_EQUAL",e[e.EQUAL=28]="EQUAL",e[e.TRUE=29]="TRUE",e[e.FALSE=30]="FALSE",e[e.SQRT=31]="SQRT",e[e.EXP=32]="EXP",e[e.LOG=33]="LOG",e[e.SIN=34]="SIN",e[e.COS=35]="COS",e[e.TAN=36]="TAN",e[e.ASIN=37]="ASIN",e[e.ACOS=38]="ACOS",e[e.ATAN=39]="ATAN",e[e.SINH=40]="SINH",e[e.COSH=41]="COSH",e[e.TANH=42]="TANH",e[e.FLOOR=43]="FLOOR",e[e.MIN=44]="MIN",e[e.MAX=45]="MAX",e[e.ABS=46]="ABS",e[e.MOD=47]="MOD",e[e.RAND=48]="RAND",e[e.PERLIN=49]="PERLIN",e[e.FACTORIAL=50]="FACTORIAL",e[e.SIGMOID=51]="SIGMOID",e[e.LEVEL_SET=52]="LEVEL_SET",e[e.VECTOR_FIELD=53]="VECTOR_FIELD",e[e.CIRCLE=54]="CIRCLE",e[e.POINT=55]="POINT",e[e.TIME=56]="TIME",e[e.MAGNITUDE=57]="MAGNITUDE",e[e.IMAGINARY=58]="IMAGINARY",e[e.POLAR=59]="POLAR",e[e.CARTESIAN=60]="CARTESIAN",e[e.MOUSEX=61]="MOUSEX",e[e.MOUSEY=62]="MOUSEY",e[e.MOUSE=63]="MOUSE",e[e.SERIES=64]="SERIES",e[e.DIV_SERIES=65]="DIV_SERIES",e[e.ITERATOR=66]="ITERATOR",e[e.COMPLEX=67]="COMPLEX",e[e.GRADIENT=68]="GRADIENT",e[e.INDEX=69]="INDEX"}(n=t.Token||(t.Token={})),function(e){e[e.IMPL_MULT_BEFORE=1]="IMPL_MULT_BEFORE",e[e.IMPL_MULT_AFTER=2]="IMPL_MULT_AFTER",e[e.PREFIX=4]="PREFIX",e[e.UNIQUE=16]="UNIQUE",e[e.BEGIN_SCOPE=32]="BEGIN_SCOPE",e[e.END_SCOPE=64]="END_SCOPE",e[e.WEBGL_ONLY=128]="WEBGL_ONLY"}(o=t.TokenFlag||(t.TokenFlag={}));const r={"(":{tok:n.PAREN_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},")":{tok:n.PAREN_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},"[":{tok:n.BRACKET_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},"]":{tok:n.BRACKET_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},"{":{tok:n.BRACE_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},"}":{tok:n.BRACE_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},",":{tok:n.DELIM,flags:o.UNIQUE},"=":{tok:n.ASSIGN,flags:0},x:{tok:n.VAR,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},y:{tok:n.VAR2,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER|o.WEBGL_ONLY},"<":{tok:n.LESS,flags:0},">":{tok:n.GREATER,flags:0},"<=":{tok:n.LESS_OR_EQUAL,flags:o.UNIQUE},">=":{tok:n.GREATER_OR_EQUAL,flags:o.UNIQUE},"!=":{tok:n.NOT_EQUAL,flags:o.UNIQUE},"==":{tok:n.EQUAL,flags:o.UNIQUE},"&&":{tok:n.AND,flags:o.UNIQUE},"||":{tok:n.OR,flags:o.UNIQUE},"+":{tok:n.ADD,flags:o.UNIQUE},"-":{tok:n.SUB,flags:o.UNIQUE},"*":{tok:n.MULT,flags:0},"/":{tok:n.DIV,flags:o.UNIQUE},"^":{tok:n.POW,flags:o.UNIQUE},"**":{tok:n.POW,flags:o.UNIQUE},"%":{tok:n.MOD,flags:0},mod:{tok:n.MOD,flags:0},true:{tok:n.TRUE,flags:0},false:{tok:n.FALSE,flags:0},sqrt:{tok:n.SQRT,flags:o.IMPL_MULT_BEFORE|o.PREFIX},exp:{tok:n.EXP,flags:o.IMPL_MULT_BEFORE|o.PREFIX},log:{tok:n.LOG,flags:o.IMPL_MULT_BEFORE|o.PREFIX},ln:{tok:n.LOG,flags:o.IMPL_MULT_BEFORE|o.PREFIX},sin:{tok:n.SIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},cos:{tok:n.COS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},tan:{tok:n.TAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},asin:{tok:n.ASIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},acos:{tok:n.ACOS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},atan:{tok:n.ATAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arcsin:{tok:n.ASIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arccos:{tok:n.ACOS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arctan:{tok:n.ATAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},sinh:{tok:n.SINH,flags:o.IMPL_MULT_BEFORE|o.PREFIX},cosh:{tok:n.COSH,flags:o.IMPL_MULT_BEFORE|o.PREFIX},tanh:{tok:n.TANH,flags:o.IMPL_MULT_BEFORE|o.PREFIX},floor:{tok:n.FLOOR,flags:o.IMPL_MULT_BEFORE|o.PREFIX},min:{tok:n.MIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},max:{tok:n.MAX,flags:o.IMPL_MULT_BEFORE|o.PREFIX},abs:{tok:n.ABS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},rand:{tok:n.RAND,flags:o.IMPL_MULT_BEFORE|o.PREFIX},random:{tok:n.RAND,flags:o.IMPL_MULT_BEFORE|o.PREFIX},perlin:{tok:n.PERLIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},noise:{tok:n.PERLIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},fact:{tok:n.FACTORIAL,flags:o.IMPL_MULT_BEFORE|o.PREFIX},factorial:{tok:n.FACTORIAL,flags:o.IMPL_MULT_BEFORE|o.PREFIX},sigmoid:{tok:n.SIGMOID,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Level:{tok:n.LEVEL_SET,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},Niveau:{tok:n.LEVEL_SET,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},VectorField:{tok:n.VECTOR_FIELD,flags:o.IMPL_MULT_BEFORE|o.PREFIX},"|":{tok:n.ABS,flags:o.BEGIN_SCOPE|o.END_SCOPE},Circle:{tok:n.CIRCLE,flags:o.PREFIX|o.WEBGL_ONLY},Point:{tok:n.POINT,flags:o.PREFIX|o.WEBGL_ONLY},Polar:{tok:n.POLAR,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},Pol:{tok:n.POLAR,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},Cartesian:{tok:n.CARTESIAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},Cart:{tok:n.CARTESIAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},t:{tok:n.TIME,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouseX:{tok:n.MOUSEX,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouseY:{tok:n.MOUSEY,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouse:{tok:n.MOUSE,flags:0},i:{tok:n.IMAGINARY,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},Series:{tok:n.SERIES,flags:o.IMPL_MULT_BEFORE|o.PREFIX},DivSeries:{tok:n.DIV_SERIES,flags:o.IMPL_MULT_BEFORE|o.PREFIX|o.WEBGL_ONLY},k:{tok:n.ITERATOR,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},j:{tok:n.INDEX,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},z:{tok:n.COMPLEX,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},Mag:{tok:n.MAGNITUDE,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Gradient:{tok:n.GRADIENT,flags:o.PREFIX}},a={pi:Math.PI,Pi:Math.PI,e:Math.E};let l=null;t.lexerGetError=()=>l;const i=e=>/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e),s={};t.bindExternVariable=(e,t,n)=>{s[e]={get:t,set:n}},t.unbindExternVariable=e=>{delete s[e]},t.getExternVariable=e=>s[e];let u={};t.setUserVariable=(e,t)=>{u[e]=t},t.getUserVariable=e=>u[e]||0,t.clearUserVariables=()=>{u={}},t.lex=e=>{l=null;const t=(e=e.replace(/\s/g,"")).split(new RegExp(`(${Object.keys(r).filter((e=>r[e].flags&o.UNIQUE)).map((e=>(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(e))).join("|")})`,"g")).filter((e=>""!==e)),u=[];let c=0;return t.forEach((e=>{let t=0;for(let f=e.length;f>t;f--){const T=e.substring(t,f);let h=!1;if(r[T])u.push({tok:r[T].tok,val:0,flags:r[T].flags}),h=!0;else if(a[T])u.push({tok:n.CONST,val:a[T],flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),h=!0;else if(s[T])u.push({tok:n.ASSIGNABLE,val:T,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),h=!0;else if(isNaN(Number(T))){if(f-1===t){let r="";for(let n=t+1;n<=e.length;n++){const o=e.substring(t,n);if(!i(o))break;r=o}if(""!==r){u.push({tok:n.USERVAR,val:r,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),t+=r.length,f=e.length+1;continue}return E=`Unknown token: ´${e.substring(t,e.length)}´`,g=c+t,console.error(`Error at position ${g}: ${E}`),l={desc:E,pos:g},[]}}else u.push({tok:n.NUM,val:parseFloat(T),flags:o.IMPL_MULT_AFTER}),h=!0;h&&(t=f,f=e.length+1)}var E,g;c+=e.length})),u}},103:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.parserGetDisplayMode=t.parserGetDriver=t.parserGetContinuous=t.parserGetError=void 0;const o=n(195),r=n(99),a={[r.Token.OR]:0,[r.Token.DELIM]:1,[r.Token.AND]:2,[r.Token.EQUAL]:3,[r.Token.NOT_EQUAL]:3,[r.Token.ASSIGN]:3,[r.Token.LESS]:4,[r.Token.LESS_OR_EQUAL]:4,[r.Token.GREATER]:4,[r.Token.GREATER_OR_EQUAL]:4,[r.Token.ADD]:5,[r.Token.SUB]:5,[r.Token.MULT]:6,[r.Token.DIV]:6,[r.Token.MOD]:6,[r.Token.POW]:7},l=(e,t)=>{console.error(`Error at position ${t}: ${e}`),i={desc:e,pos:t}};let i=null,s=!1,u=o.PlotDriver.CONSTANT,c=o.PlotDisplayMode.NONE;t.parserGetError=()=>i,t.parserGetContinuous=()=>s,t.parserGetDriver=()=>u,t.parserGetDisplayMode=()=>c,t.parse=e=>{i=null,s=!1,u=o.PlotDriver.CONSTANT,c=o.PlotDisplayMode.NONE;let t=(0,r.lex)(e);console.debug("Lexer output:",t);const n=(0,r.lexerGetError)();if(n)return i=JSON.parse(JSON.stringify(n)),null;if(t=E(t),console.debug("Validated ops:",t),null==t)return null;if(t=g(t),console.debug("Expanded ops:",t),null==t)return null;const a=(t.filter((e=>e.tok===r.Token.VAR)).length>0?1:0)+(t.filter((e=>e.tok===r.Token.VAR2)).length>0?1:0);return t.filter((e=>e.flags&r.TokenFlag.WEBGL_ONLY)).length>0?(u=o.PlotDriver.WEBGL,c=o.PlotDisplayMode.SET,t.filter((e=>e.tok===r.Token.LEVEL_SET)).length>0?c=o.PlotDisplayMode.LEVEL_SET:t.filter((e=>e.tok===r.Token.VECTOR_FIELD)).length>0?c=o.PlotDisplayMode.VECTOR_FIELD:t.filter((e=>e.tok===r.Token.GRADIENT)).length>0&&(c=o.PlotDisplayMode.GRADIENT)):0===a?(u=o.PlotDriver.CONSTANT,c=o.PlotDisplayMode.CONSTANT_EVAL):1===a&&(u=o.PlotDriver.CANVAS,c=o.PlotDisplayMode.FUNCTION_GRAPH),s=t.filter((e=>e.tok===r.Token.TIME)).length>0||t.filter((e=>e.tok===r.Token.MOUSEX)).length>0||t.filter((e=>e.tok===r.Token.MOUSEY)).length>0,t=f(t),console.debug("Optimized ops:",t),null==t?null:T(t)};const E=e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o.flags&r.TokenFlag.BEGIN_SCOPE&&t.push({tok:o.tok,pos:n}),o.flags&r.TokenFlag.END_SCOPE){const{tok:e,pos:n}=t.pop()||{tok:r.Token.NONE,pos:0};let a=r.Token.NONE;switch(e){case r.Token.PAREN_OP:a=r.Token.PAREN_CL;break;case r.Token.BRACKET_OP:a=r.Token.BRACKET_CL;break;case r.Token.BRACE_OP:a=r.Token.BRACE_CL;break;case r.Token.ABS:a=r.Token.ABS}if(o.tok!==a)return l("Mismatched parentheses",n),null}}if(t.length>0){const{pos:e}=t[0];return l("Unmatched parentheses",e),null}return e},g=e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o.tok===r.Token.ABS&&o.flags&r.TokenFlag.BEGIN_SCOPE){const a=t.pop();if(t.push({tok:o.tok,pos:n}),!a)continue;const l=e.splice(a.pos+1,n-a.pos-1);e.splice(a.pos,2),e.splice(a.pos,0,{tok:r.Token.ABS,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.PREFIX},{tok:r.Token.PAREN_OP,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.UNIQUE|r.TokenFlag.BEGIN_SCOPE},...l,{tok:r.Token.PAREN_CL,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.UNIQUE|r.TokenFlag.END_SCOPE}),n=a.pos+l.length+3,t.pop()}}for(let t=0;t<e.length;t++)e[t].tok===r.Token.MOUSE?(e.splice(t,1,{tok:r.Token.MOUSEX,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE},{tok:r.Token.DELIM,val:0,flags:0},{tok:r.Token.MOUSEY,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE}),t+=2):e[t].tok===r.Token.COMPLEX&&(e.splice(t,1,{tok:r.Token.PAREN_OP,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.BEGIN_SCOPE},{tok:r.Token.VAR,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.IMPL_MULT_AFTER},{tok:r.Token.ADD,val:0,flags:0},{tok:r.Token.VAR2,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.WEBGL_ONLY},{tok:r.Token.IMAGINARY,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.IMPL_MULT_AFTER},{tok:r.Token.PAREN_CL,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.END_SCOPE}),t+=5);for(let t=1;t<e.length;t++)e[t-1].flags&r.TokenFlag.IMPL_MULT_AFTER&&e[t].flags&r.TokenFlag.IMPL_MULT_BEFORE&&e.splice(t,0,{tok:r.Token.MULT,val:0,flags:0});for(let t=8;t>0;t--)for(let n=0;n<e.length;n++)if(a[e[n].tok]===t){let o=0,l=e.length,i=0;for(let l=n;l>=0;l--)if(e[l].flags&r.TokenFlag.BEGIN_SCOPE?i++:e[l].flags&r.TokenFlag.END_SCOPE&&i--,a[e[l].tok]<t&&0===i||i>0){o=l+1;break}i=0;for(let o=n;o<e.length;o++)if(e[o].flags&r.TokenFlag.BEGIN_SCOPE?i++:e[o].flags&r.TokenFlag.END_SCOPE&&i--,a[e[o].tok]<t&&0===i||i<0){l=o;break}e.splice(l,0,{tok:r.Token.PAREN_CL,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.UNIQUE|r.TokenFlag.END_SCOPE}),e.splice(o,0,{tok:r.Token.PAREN_OP,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.UNIQUE|r.TokenFlag.BEGIN_SCOPE}),n++}for(let t=0;t<e.length;t++)e[t].tok===r.Token.SUB&&(0===t||e[t-1].flags&r.TokenFlag.BEGIN_SCOPE)&&e.splice(t,0,{tok:r.Token.NUM,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER});return e},f=e=>{let t=0;for(let n=0;n<e.length;n++)if(e[n].tok===r.Token.SUB)t++;else{if(t>1)if(t%2==1)for(let o=0;o<t-1;o++)e.splice(n-t,1);else{for(let o=0;o<t;o++)e.splice(n-t,1);e.splice(n-t,0,{tok:r.Token.ADD,val:0,flags:0})}t=0}for(let t=1;t<e.length;t++)e[t].flags&r.TokenFlag.END_SCOPE&&e[t-1].flags&r.TokenFlag.BEGIN_SCOPE&&e.splice(t-1,2);return e},T=e=>{const t={op:{tok:r.Token.NONE,val:0,flags:0},left:null,right:null};let n=t;const o=[];let a=0;for(let t=0;t<e.length;t++){const i=e[t];if(i.flags&r.TokenFlag.BEGIN_SCOPE)a++;else if(i.flags&r.TokenFlag.END_SCOPE){if(a<=0)return l("Unexpected end of scope",t),null;a--,n=o.pop();continue}if(null==n.op||n.op.tok===r.Token.NONE||n.op.flags&r.TokenFlag.BEGIN_SCOPE)n.op=i,n.op.flags&r.TokenFlag.BEGIN_SCOPE&&o.push(n);else if(null==n.left){if(n.op.flags&r.TokenFlag.PREFIX){n.left={op:{tok:r.Token.UNDEF,val:0,flags:0},left:null,right:null},n.right={op:i,left:null,right:null},n.right.op.flags&r.TokenFlag.BEGIN_SCOPE&&(o.push(n),n=n.right);continue}const e=JSON.parse(JSON.stringify(n));n.left=e,n.op=i}else if(null==n.right||n.right.op.flags&r.TokenFlag.BEGIN_SCOPE)n.right={op:i,left:null,right:null},n.right.op.flags&r.TokenFlag.BEGIN_SCOPE&&(o.push(n),n=n.right);else if(n.right.op.flags&r.TokenFlag.PREFIX&&null==n.right.right)o.push(n),n=n.right,n.right={op:i,left:null,right:null};else{const e=JSON.parse(JSON.stringify(n));n.left=e,n.right=null,n.op=i}}return 0!==a?(l("Unexpected end of expression",e.length),null):t}},682:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function l(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.shadersDraw=t.scheduleReloadShaders=t.shaderCoreUpdate=t.initShaderCore=t.shadersClearAll=void 0;const r=n(607),a=n(85),l=n(533),i=n(195),s=n(633),u=n(750);let c=null,E=null,g=!1,f=!1,T=!1;const h={},d=document.getElementById("shader-canvas"),M=d.getContext("webgl2",{preserveDrawingBuffer:!0});function p(e){return o(this,void 0,void 0,(function*(){if(!h[e]){const t=yield fetch(e),n=yield t.text();return h[e]=n,n}return Promise.resolve(h[e])}))}function k(){return o(this,void 0,void 0,(function*(){g=!0,yield Promise.all([p("assets/shaders/plot.vert"),p("assets/shaders/plot.frag")]).then((e=>{e[1]=function(e){const t=(0,l.getPlotsShaderInfo)();return 0===t.numPlots&&(t.functions=[],t.colors=["#000000"],t.displayModes=[i.PlotDisplayMode.NONE],t.iterExpr=[]),t.functions.push("0.0"),t.iterExpr.push("vec2(0.0,0.0)"),e.replace(/USER_NUM_FUNC_INJ/g,`${t.numPlots+1}`).replace(/USER_FUNC_INJ/g,`float[](${t.functions.map((e=>`(${e})`)).join(",")})`).replace(/USER_COL_INJ/g,`vec3[](${t.colors.map((e=>{return`vec3(${t=e,`${parseInt(t.substring(1,3),16)/255}, ${parseInt(t.substring(3,5),16)/255}, ${parseInt(t.substring(5,7),16)/255}`})`;var t})).join(",")})`).replace(/USER_DISP_INJ/g,`int[](${t.displayModes.map((e=>`${e}`)).join(",")})`).replace(/USER_ITER_EXPR_INJ/g,`vec2[](${t.iterExpr.map((e=>`(${e.length>0?e:"vec2(0.0,0.0)"})`)).join(",")})`)}(e[1]);const t=function(e,t){const n=m(M.VERTEX_SHADER,e),o=m(M.FRAGMENT_SHADER,t);if(!n||!o)return null;const r=M.createProgram();return r?(M.attachShader(r,n),M.attachShader(r,o),M.linkProgram(r),M.getProgramParameter(r,M.LINK_STATUS)?r:(console.error("Failed to link program: "+M.getProgramInfoLog(r)),null)):(console.error("Failed to create program"),null)}(e[0],e[1]);t?(c={program:t,attribLocations:{vertexPosition:M.getAttribLocation(t,"aVertexPosition")},uniformLocations:{projectionMatrix:M.getUniformLocation(t,"uProjectionMatrix"),modelViewMatrix:M.getUniformLocation(t,"uModelViewMatrix"),u_resolution:M.getUniformLocation(t,"u_resolution"),u_mouse:M.getUniformLocation(t,"u_mouse"),u_time:M.getUniformLocation(t,"u_time"),u_deviation:M.getUniformLocation(t,"u_deviation"),u_domain_x:M.getUniformLocation(t,"u_domain_x"),u_domain_y:M.getUniformLocation(t,"u_domain_y"),u_display_mode:M.getUniformLocation(t,"u_display_mode")}},E=function(){const e=M.createBuffer();M.bindBuffer(M.ARRAY_BUFFER,e);return M.bufferData(M.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),M.STATIC_DRAW),e}(),f=!0,g=!1):console.error("Failed to load shaders")}))}))}function m(e,t){const n=M.createShader(e);return n?(M.shaderSource(n,t),M.compileShader(n),M.getShaderParameter(n,M.COMPILE_STATUS)?n:(console.error("Failed to compile shader: "+M.getShaderInfoLog(n)),M.getShaderInfoLog(n),M.deleteShader(n),null)):(console.error("Failed to create shader"),null)}function L(){M.clearColor(0,0,0,1),M.clearDepth(1),M.enable(M.DEPTH_TEST),M.depthFunc(M.LEQUAL),M.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT);const e=45*Math.PI/180,t=M.canvas.clientWidth/M.canvas.clientHeight,n=s.create();s.perspective(n,e,t,.1,100);const o=s.create();s.translate(o,o,[0,0,-1]);const l=M.FLOAT;M.bindBuffer(M.ARRAY_BUFFER,E),M.vertexAttribPointer(c.attribLocations.vertexPosition,2,l,!1,0,0),M.enableVertexAttribArray(c.attribLocations.vertexPosition),M.useProgram(c.program);const i=(0,u.getMousePos)(),g=(0,a.getDomain)();M.uniformMatrix4fv(c.uniformLocations.projectionMatrix,!1,n),M.uniformMatrix4fv(c.uniformLocations.modelViewMatrix,!1,o),M.uniform2f(c.uniformLocations.u_resolution,M.canvas.width,M.canvas.height),M.uniform2f(c.uniformLocations.u_mouse,i.x,i.y),M.uniform2f(c.uniformLocations.u_domain_x,g.minX,g.maxX),M.uniform2f(c.uniformLocations.u_domain_y,g.minY,g.maxY),M.uniform1f(c.uniformLocations.u_time,(0,r.getGlobalTime)()),M.uniform1f(c.uniformLocations.u_deviation,.004),M.uniform1i(c.uniformLocations.u_display_mode,0),M.drawArrays(M.TRIANGLE_STRIP,0,4)}t.shadersClearAll=function(){(0,t.scheduleReloadShaders)()},t.initShaderCore=function(){d&&M||console.error("Failed to initialize WebGL context.")},t.shaderCoreUpdate=function(){f||g||T||(k(),T&&console.error("Failed to load shaders"))},t.scheduleReloadShaders=function(){T=!1,f=!1,g=!1},t.shadersDraw=function(){f=!1,!f||T?k().then((()=>{if(!f)return console.error("Failed to initialize shaders"),void M.clearColor(0,0,0,1);L()})):L()}},849:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildShaderFunction=t.shaderFunctionBuilderGetIterExpression=t.shaderFunctionBuilderGetError=void 0;const o=n(607),r=n(99),a=n(283);let l=null;t.shaderFunctionBuilderGetError=()=>l;let i="";t.shaderFunctionBuilderGetIterExpression=()=>i,t.buildShaderFunction=e=>{if(!e)return null;l=null,i="";const t=g(e);return console.debug("Shader function: "+t.val),t.val};const s=function(e){return console.error("Error during constant evaluation: "+e),l=e,{val:null,cpx:!1}},u=function(e){return-1===e.toString().indexOf(".")?e.toString()+".0":e.toString()},c=e=>({val:e,cpx:!1}),E=e=>({val:e,cpx:!0}),g=function(e){var t;let n,l;switch(e.op.tok){case r.Token.UNDEF:return s("Token UNDEFINED is not allowed");case r.Token.NONE:return c("0");case r.Token.PAREN_OP:return s("Token OPEN PARENTHESIS is not allowed");case r.Token.PAREN_CL:return s("Token CLOSE PARENTHESIS is not allowed");case r.Token.BRACKET_OP:return s("Token OPEN BRACKET is not allowed");case r.Token.BRACKET_CL:return s("Token CLOSE BRACKET is not allowed");case r.Token.BRACE_OP:return s("Token OPEN BRACE is not allowed");case r.Token.BRACE_CL:return s("Token CLOSE BRACE is not allowed");case r.Token.NUM:return"number"!=typeof e.op.val?s("Token NUMBER must be a number"):c(u(e.op.val));case r.Token.CONST:return"number"!=typeof e.op.val?s("Token CONSTANT must be a number"):c(u(e.op.val));case r.Token.VAR:return c("x");case r.Token.VAR2:return c("y");case r.Token.TIME:return(0,o.scheduleRedraw)(),c("t");case r.Token.ADD:return null==e.left||null==e.right?s("Missing arguments for Token ADDITION"):(n=g(e.left),l=g(e.right),n.cpx||l.cpx?E(`add(${n.val},${l.val})`):c(`(${n.val}+${l.val})`));case r.Token.SUB:return null==e.left||null==e.right?s("Missing arguments for Token SUBTRACTION"):(n=g(e.left),l=g(e.right),n.cpx||l.cpx?E(`sub(${n.val},${l.val})`):c(`(${n.val}-${l.val})`));case r.Token.MULT:return null==e.left||null==e.right?s("Missing arguments for Token MULTIPLICATION"):(n=g(e.left),l=g(e.right),n.cpx||l.cpx?E(`mul(${n.val},${l.val})`):c(`(${n.val}*${l.val})`));case r.Token.DIV:return null==e.left||null==e.right?s("Missing arguments for Token DIVISION"):(n=g(e.left),l=g(e.right),n.cpx||l.cpx?E(`div(${n.val},${l.val})`):c(`(${n.val}/${l.val})`));case r.Token.POW:return null==e.left||null==e.right?s("Missing arguments for Token POWER"):(n=g(e.left),l=g(e.right),n.cpx||l.cpx?l.cpx?s("Power cannot be complex"):E(`_pow(${n.val},${l.val})`):c(`_pow(${n.val},${l.val})`));case r.Token.SQRT:return null==e.right?s("Missing argument for Token SQUARE ROOT"):(l=g(e.right),l.cpx?s("Square root cannot be complex"):c(`sqrt(${l.val})`));case r.Token.LOG:return null==e.right?s("Missing argument for Token LOGARITHM"):(l=g(e.right),l.cpx?s("Logarithm cannot be complex"):c(`log(${l.val})`));case r.Token.EXP:return null==e.right?s("Missing argument for Token EXPOENTIAL"):(l=g(e.right),l.cpx?s("Exponential cannot be complex"):c(`exp(${l.val})`));case r.Token.SIN:return null==e.right?s("Missing argument for Token SINE"):(l=g(e.right),l.cpx?s("Sine cannot be complex"):c(`sin(${l.val})`));case r.Token.COS:return null==e.right?s("Missing argument for Token COSINE"):(l=g(e.right),l.cpx?s("Cosine cannot be complex"):c(`cos(${l.val})`));case r.Token.TAN:return null==e.right?s("Missing argument for Token TANGENT"):(l=g(e.right),l.cpx?s("Tangent cannot be complex"):c(`tan(${l.val})`));case r.Token.ASIN:return null==e.right?s("Missing argument for Token ARC SINE"):(l=g(e.right),l.cpx?s("Arc sine cannot be complex"):c(`asin(${l.val})`));case r.Token.ACOS:return null==e.right?s("Missing argument for Token ARC COSINE"):(l=g(e.right),l.cpx?s("Arc cosine cannot be complex"):c(`acos(${l.val})`));case r.Token.ATAN:return null==e.right?s("Missing argument for Token ARC TANGENT"):(l=g(e.right),l.cpx?s("Arc tangent cannot be complex"):c(`atan(${l.val})`));case r.Token.SINH:return null==e.right?s("Missing argument for Token HYPERBOLIC SINE"):(l=g(e.right),l.cpx?s("Sine hyperbolicus cannot be complex"):c(`sinh(${l.val})`));case r.Token.COSH:return null==e.right?s("Missing argument for Token HYPERBOLIC COSINE"):(l=g(e.right),l.cpx?s("Cosine hyperbolicus cannot be complex"):c(`cosh(${l.val})`));case r.Token.TANH:return null==e.right?s("Missing argument for Token HYPERBOLIC TANGENT"):(l=g(e.right),l.cpx?s("Hyperbolic tangent cannot be complex"):c(`tanh(${l.val})`));case r.Token.FLOOR:return null==e.right?s("Missing argument for Token FLOOR"):(l=g(e.right),l.cpx?s("Floor cannot be complex"):c(`floor(${l.val})`));case r.Token.MIN:return null==e.right?s("Missing argument for Token MIN"):(0,a.isIterable)(g(e.right).val)?c(`min(${g(e.right).val})`):s("Malformed argument for Token MIN");case r.Token.MAX:return null==e.right?s("Missing argument for Token MAX"):(0,a.isIterable)(g(e.right).val)?c(`max(${g(e.right).val})`):s("Malformed argument for Token MAX");case r.Token.DELIM:return null==e.left||null==e.right?s("Missing arguments for Token DELIMITER"):c(`${g(e.left).val},${g(e.right).val}`);case r.Token.ABS:return null==e.right?s("Missing argument for Token ABSOLUTE"):(l=g(e.right),l.cpx?c(`mag(${l.val})`):c(`abs(${l.val})`));case r.Token.RAND:return null==e.right?s("Missing argument for Token RANDOM"):c(`random(${g(e.right).val})`);case r.Token.PERLIN:return null==e.right?s("Missing arguments for Token PERLIN"):(0,a.isIterable)(g(e.right).val)?c(`noise(vec2(${g(e.right).val}))`):s("Malformed argument for Token PERLIN");case r.Token.MOD:return null==e.left||null==e.right?s("Missing arguments for Token MODULUS"):c(`mod(${g(e.left).val},${g(e.right).val})`);case r.Token.LEVEL_SET:return null==e.right?s("Missing argument for Token LEVEL SET"):e.right.op.tok===r.Token.DELIM?null==e.right.left||null==e.right.right?s("Missing arguments for Token LEVEL SET"):c(`${g(e.right.left).val}+((level=${g(e.right.right).val})>0.0?0.0:0.0)`):g(e.right);case r.Token.VECTOR_FIELD:return s("Token VECTOR FIELD is not allowed");case r.Token.LESS:return null==e.left||null==e.right?s("Missing arguments for Token LESS THAN"):c(`btof(${g(e.left).val}<${g(e.right).val})`);case r.Token.GREATER:return null==e.left||null==e.right?s("Missing arguments for Token GREATER THAN"):c(`btof(${g(e.left).val}>${g(e.right).val})`);case r.Token.LESS_OR_EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token LESS THAN OR EQUAL TO"):c(`btof(${g(e.left).val}<=${g(e.right).val})`);case r.Token.GREATER_OR_EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token GREATER THAN OR EQUAL TO"):c(`btof(${g(e.left).val}>=${g(e.right).val})`);case r.Token.EQUAL:return null==e.left||null==e.right?s("Missing arguments for Token EQUAL TO"):c(`btof(${g(e.left).val}==${g(e.right).val})`);case r.Token.AND:return null==e.left||null==e.right?s("Missing arguments for Token AND"):c(`btof(ftob(${g(e.left).val})&&ftob(${g(e.right).val}))`);case r.Token.OR:return null==e.left||null==e.right?s("Missing arguments for Token OR"):c(`btof(ftob(${g(e.left).val})||ftob(${g(e.right).val}))`);case r.Token.USERVAR:return c(`btof(${(0,r.getUserVariable)(e.op.val)})`);case r.Token.FACTORIAL:return null==e.right?s("Missing argument for Token FACTORIAL"):c(`factorial(${g(e.right).val})`);case r.Token.SIGMOID:return null==e.right?s("Missing argument for Token SIGMOID"):c(`(1.0/(1.0+exp(-(${g(e.right).val}))))`);case r.Token.CIRCLE:return null==e.right?s("Missing argument for Token CIRCLE"):c(`circle(x,y,d,${g(e.right).val})`);case r.Token.POINT:return null==e.right?s("Missing argument for Token POINT"):c(`point(x,y,d,${g(e.right).val})`);case r.Token.TRUE:return c("btof(true)");case r.Token.FALSE:return c("btof(false)");case r.Token.POLAR:return null==e.right?s("Missing argument for Token POLAR"):c(`(POLAR+${g(e.right).val})`);case r.Token.CARTESIAN:return null==e.right?s("Missing argument for Token CARTESIAN"):c(`(CARTESIAN+${g(e.right).val})`);case r.Token.MOUSEX:return c("mx");case r.Token.MOUSEY:return c("my");case r.Token.MOUSE:return s("Token MOUSE is not allowed");case r.Token.IMAGINARY:return E("vec2(0.0,1.0)");case r.Token.SERIES:return s("Token SERIES is not allowed");case r.Token.DIV_SERIES:return null==e.right||null==e.right.left||null==e.right.right?s("Missing argument for Token SERIES"):(i=g(e.right.right).val||"",c(`divseries(i,x,y,t,${g(e.right.left).val})`));case r.Token.ITERATOR:return c("k");case r.Token.INDEX:return c("i");case r.Token.COMPLEX:return s("Token COMPLEX is not allowed");case r.Token.MAGNITUDE:return null==e.right?s("Missing argument for Token MAGNITUDE"):c(`mag(${g(e.right).val})`);case r.Token.GRADIENT:return null==e.right?s("Missing argument for Token GRADIENT"):g(e.right);case r.Token.ASSIGN:return null==e.left||null==e.right?s("Missing arguments for Token ASSIGN"):e.left.op.tok!==r.Token.ASSIGNABLE?e.left.op.tok===r.Token.USERVAR?((0,r.setUserVariable)(e.left.op.val,parseFloat(g(e.right).val)),g(e.right)):c(`btof(abs(${g(e.left).val}-${g(e.right).val})<d)`):null==(0,r.getExternVariable)(e.left.op.val)?s(`Variable ${e.left.op.val} does not exist`):(null===(t=(0,r.getExternVariable)(e.left.op.val))||void 0===t||t.set(parseFloat(g(e.right).val)),g(e.right));default:return s(`Unknown token ${e.op.val}`)}}},320:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLeftPanelWidth=t.inputSetDriverAt=t.inputSetStatusAt=t.inputSetConstEvalAt=t.inputSetErrorAt=t.inputSetColorAt=t.resetInputs=t.addNewInputWithValue=t.addNewInput=t.initInputs=t.initLeftPanel=void 0;const o=n(607),r=n(533),a=n(195),l=n(283),i=n(750),s=document.querySelector(".inputs"),u=document.querySelector(".resize-left-panel"),c=document.getElementById("left-panel");let E=0,g=0;t.initLeftPanel=function(){(0,i.onMouseDrag)(u,(e=>{const t=Math.max(250,Math.min(.95*window.innerWidth,e.x));document.documentElement.style.setProperty("--left-panel-width",`${t}px`),(0,o.scheduleRedraw)()}))},t.initInputs=function(){(0,t.addNewInput)()},t.addNewInput=function(){const e=(0,l.stringToHTML)('\n\t<div class="input">\n\t<div class="status"><div class="indicator"></div></div>\n\t<input type="text" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off" autofocus>\n\t<div class="delete">×</div>\n\t<div class="const-eval"></div>\n\t</div>').firstChild,n=e.querySelector("input"),a=e.querySelector(".delete"),i=e.querySelector(".indicator");null==n||n.addEventListener("keydown",(function(e){if("Enter"===e.key){if(e.preventDefault(),g>E){const e=s.querySelector(`.input[data-input-idx="${++E}"]`);return T(e),void setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}(0,t.addNewInput)()}})),n.addEventListener("click",(function(t){T(e),E=parseInt(e.getAttribute("data-input-idx")||"0"),null==n||n.focus()})),null==n||n.addEventListener("focus",(function(t){T(e),E=parseInt(e.getAttribute("data-input-idx")||"0")})),null==n||n.addEventListener("input",(function(t){E=parseInt(e.getAttribute("data-input-idx")||"0"),i.classList.contains("disabled")?(0,r.setInputAt)(E,""):(0,r.setInputAt)(E,n.value)})),null==a||a.addEventListener("click",(function(t){if(1===g){e.classList.add("illegal");const t=e.querySelector("input");t&&(t.value="");const n=e.querySelector(".indicator");null==n||n.classList.remove("pending","active","error","disabled");const a=e.querySelector(".const-eval");return null==a||a.classList.remove("visible"),setTimeout((()=>e.classList.remove("illegal")),200),(0,o.scheduleRedraw)(),void(0,r.resetPlots)()}e.classList.add("deleted"),setTimeout((function(){e.remove();const t=parseInt(e.getAttribute("data-input-idx")||"0");g--,(0,r.setNumInputs)(g);const o=s.querySelectorAll(".input");for(let e=0;e<o.length;e++){o[e].setAttribute("data-input-idx",(e+1).toString());const t=o[e].querySelector(".indicator");(null==t?void 0:t.classList.contains("disabled"))?(0,r.setInputAt)(e+1,""):(0,r.setInputAt)(e+1,n.value)}if(g>0&&(t<=E||1===t)){const e=s.querySelector(`.input[data-input-idx="${E-1}"]`);T(e),setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}}),120)})),null==i||i.addEventListener("click",(function(t){i.classList.toggle("disabled"),E=parseInt(e.getAttribute("data-input-idx")||"0"),i.classList.contains("disabled")?(0,r.setInputAt)(E,""):(0,r.setInputAt)(E,n.value)})),e.setAttribute("data-input-idx",(++E).toString()),e.classList.add("created"),setTimeout((function(){e.classList.remove("created")}),120),g++,(0,r.setNumInputs)(g),T(e),setTimeout((function(){null==n||n.focus()}),0),s.appendChild(e)},t.addNewInputWithValue=function(e){(0,t.addNewInput)(),(0,r.setInputAt)(E,e);const n=s.querySelector(`.input[data-input-idx="${E}"] input`);n&&(n.value=e)},t.resetInputs=function(){const e=s.querySelectorAll(".input");for(let t=0;t<e.length;t++)e[t].remove();g=0,(0,r.setNumInputs)(g),E=0,(0,r.resetPlots)()};const f=function(e){return s.querySelector(`.input[data-input-idx="${e}"]`)};t.inputSetColorAt=function(e,t){var n;null===(n=f(e))||void 0===n||n.setAttribute("data-color",t)},t.inputSetErrorAt=function(e,t){const n=f(e);if(!n)return;const o=n.querySelector(".indicator");o&&o.setAttribute("data-error",t)},t.inputSetConstEvalAt=function(e,t){const n=f(e);if(!n)return;const o=n.querySelector(".const-eval");o&&((0,l.isIterable)(t)?o.innerText=`= (${t.toString()})`:o.innerText="= "+(0,l.complexToString)(t),o.classList.add("visible"))},t.inputSetStatusAt=function(e,t){const n=f(e);if(!n)return;const o=n.querySelector(".indicator");if(!o)return;o.classList.remove("pending","active","error");const r=n.querySelector(".const-eval");if(r)switch(t){case a.PlotStatus.PENDING:o.classList.add("pending"),o.innerHTML="",r.classList.remove("visible");break;case a.PlotStatus.ACTIVE:o.classList.add("active"),o.style.backgroundColor=n.getAttribute("data-color")||"#000",o.innerHTML="";break;case a.PlotStatus.ERROR:o.classList.add("error"),o.innerHTML="!",r.classList.remove("visible")}},t.inputSetDriverAt=function(e,t){const n=f(e);if(!n)return;const o=n.querySelector(".const-eval");o&&t!==a.PlotDriver.CONSTANT&&o.classList.remove("visible")};const T=function(e){s.querySelectorAll(".input").forEach((e=>{e.classList.remove("active")})),e.classList.add("active")};t.getLeftPanelWidth=function(){return c.offsetWidth}},139:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initMenuBar=void 0;const o=n(85),r=n(533),a=n(283),l=document.getElementById("menu-bar");t.initMenuBar=function(){Array.from(l.querySelectorAll("button")).forEach((e=>{const t=e.dataset.icon||"",n=e.dataset.href||"",o=e.dataset.filter||"";if(t&&n){const r='<div class="button-icon"></div>',l=(0,a.stringToHTML)(r).firstChild;l.style.backgroundImage=`url('${t}')`,l.style.filter=o,e.appendChild(l),e.addEventListener("click",(()=>{window.open(n,"_blank")}))}}));const e=document.querySelector(".demo-button"),t=document.querySelector(".examples-list");let n,i=0;fetch("assets/demo/demo.json").then((e=>e.json())).then((e=>{var o,a;n=e,i=null==e?void 0:e.numPlots;for(let l=0;l<i;l++){const i=document.createElement("div"),s=document.createElement("h3");s.innerHTML=null===(o=null==e?void 0:e.plots[l])||void 0===o?void 0:o.name,i.appendChild(s),i.classList.add("example-list-item");const u=document.createElement("iframe");u.src=`?plot=${(null===(a=null==n?void 0:n.plots[l])||void 0===a?void 0:a.inputs.map(encodeURIComponent).join(";"))||""}&preview=true`,u.classList.add("example-preview"),u.style.overflow="hidden",u.style.border="none",i.appendChild(u);const c=document.createElement("div");c.classList.add("example-clickable"),c.addEventListener("click",(()=>{var e,t;(0,r.loadPlots)((null===(e=null==n?void 0:n.plots[l])||void 0===e?void 0:e.inputs)||"",(null===(t=null==n?void 0:n.plots[l])||void 0===t?void 0:t.defaults)||"")})),i.appendChild(c),t.appendChild(i)}})),e.addEventListener("click",(()=>{t.classList.toggle("hidden")})),document.querySelector(".menu-bar-title h1").onclick=()=>window.location.replace(window.location.origin),document.querySelector(".export-button").addEventListener("click",(()=>{(0,o.enablePreview)()})),document.querySelector(".exit-fullscreen").addEventListener("click",(()=>{window.location.reload()}))}},750:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initUserInteract=t.onMouseDrag=t.getMousePos=void 0;const o=n(283);let r,a=!1,l=!1;const i=new o.Vector(0,0),s=new Map;t.getMousePos=function(){return i},t.onMouseDrag=function(e,t){s.set(e,t)},t.initUserInteract=function(){document.addEventListener("mousedown",(function(e){l=!0})),document.addEventListener("mousemove",(function(e){if(l)if(i.set(e.clientX,e.clientY),a)r(i);else for(const[t,n]of s)if(null==t?void 0:t.contains(e.target))return n(i),a=!0,void(r=n)})),document.addEventListener("mouseup",(function(e){a=!1,l=!1}))}},283:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.map=t.sigmoid=t.factorial=t.perlin2=t.isIterable=t.cpx=t.complexToString=t.Vector=t.stringToHTML=void 0,t.stringToHTML=function(e){return(new DOMParser).parseFromString(e,"text/html").body},t.Vector=class{constructor(e,t){this.x=e,this.y=t}set(e,t){this.x=e,this.y=t}},t.complexToString=function(e){const t=Math.round(1e6*e.re)/1e6,n=Math.round(1e6*e.im)/1e6;return 0===n?t.toString():t+" + "+n+"i"},t.cpx=e=>({re:e,im:0}),t.isIterable=e=>null!=e&&"function"==typeof e[Symbol.iterator];const n=new Array(512),o=new Array(512),r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];class a{constructor(e,t,n){this.x=e,this.y=t,this.z=n}}const l=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)];function i(e){return e*e*e*(e*(6*e-15)+10)}function s(e,t,n){return(1-n)*e+n*t}!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(let t=0;t<256;t++){let a;a=1&t?r[t]^255&e:r[t]^e>>8&255,n[t]=n[t+256]=a,o[t]=o[t+256]=l[a%12]}}(12345),t.perlin2=function(e,t){let r=Math.floor(e),a=Math.floor(t);e-=r,t-=a,r&=255,a&=255;const l=o[r+n[a]].dot2(e,t),u=o[r+n[a+1]].dot2(e,t-1),c=o[r+1+n[a]].dot2(e-1,t),E=o[r+1+n[a+1]].dot2(e-1,t-1),g=i(e);return s(s(l,c,g),s(u,E,g),i(t))},t.factorial=function(e){const t=Math.floor(e),n=e-t;let o=function(e){return(((((.07288448978215456*e-.31390051543712616)*e+.6538907084614038)*e-.810425715520978)*e+.9737655441276729)*e-.5761851668648887)*e+.9999830044034752}(n);if(e<0)for(let e=0;e<-t;e++)o/=n-e;else for(let e=1;e<t+1;e++)o*=n+e;return e>0?o:1/0},t.sigmoid=function(e){return 1/(1+Math.exp(-e))},t.map=function(e,t,n,o,r){return(e-t)/(n-t)*(r-o)+o}},607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFPSSmoothed=t.getGlobalTime=t.scheduleExit=t.scheduleSnapshot=t.scheduleRedraw=void 0;const o=n(320),r=n(139),a=n(85),l=n(750),i=n(533),s=n(682);let u=!0,c=!1,E=!1,g=0,f=0,T=0;const h=Array(1).fill(60);t.scheduleRedraw=function(){u=!0},t.scheduleSnapshot=function(){c=!0},t.scheduleExit=function(){E=!0},t.getGlobalTime=()=>g,t.getFPSSmoothed=()=>h.reduce(((e,t)=>e+t))/h.length,window.onload=function(){(0,l.initUserInteract)(),(0,s.initShaderCore)(),(0,o.initInputs)(),(0,a.initCanvas)()||((0,r.initMenuBar)(),(0,o.initLeftPanel)()),d()};const d=function(){u&&(u=!1,(0,a.canvasDraw)(),(0,s.shadersDraw)(),(0,i.drawPlots)()),(0,a.driveCanvas)(),(0,i.drivePlots)(),(0,s.shaderCoreUpdate)(),g+=.01;const e=Date.now();f=e-T,T=e,h.push(1e3/f),h.length>100&&h.shift(),c&&(c=!1,(0,a.canvasFreezeFrame)()),E||requestAnimationFrame(d)}},633:(e,t,n)=>{n.r(t),n.d(t,{add:()=>j,adjoint:()=>f,clone:()=>l,copy:()=>i,create:()=>a,decompose:()=>F,determinant:()=>T,equals:()=>ee,exactEquals:()=>Z,frob:()=>Y,fromQuat:()=>D,fromQuat2:()=>_,fromRotation:()=>A,fromRotationTranslation:()=>P,fromRotationTranslationScale:()=>b,fromRotationTranslationScaleOrigin:()=>x,fromScaling:()=>R,fromTranslation:()=>I,fromValues:()=>s,fromXRotation:()=>S,fromYRotation:()=>O,fromZRotation:()=>v,frustum:()=>y,getRotation:()=>C,getScaling:()=>U,getTranslation:()=>N,identity:()=>c,invert:()=>g,lookAt:()=>H,mul:()=>te,multiply:()=>h,multiplyScalar:()=>z,multiplyScalarAndAdd:()=>J,ortho:()=>X,orthoNO:()=>$,orthoZO:()=>Q,perspective:()=>w,perspectiveFromFieldOfView:()=>V,perspectiveNO:()=>B,perspectiveZO:()=>G,rotate:()=>p,rotateX:()=>k,rotateY:()=>m,rotateZ:()=>L,scale:()=>M,set:()=>u,str:()=>W,sub:()=>ne,subtract:()=>K,targetTo:()=>q,translate:()=>d,transpose:()=>E});var o=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function a(){const e=new r(16);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){const t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,n,o,a,l,i,s,u,c,E,g,f,T,h,d){const M=new r(16);return M[0]=e,M[1]=t,M[2]=n,M[3]=o,M[4]=a,M[5]=l,M[6]=i,M[7]=s,M[8]=u,M[9]=c,M[10]=E,M[11]=g,M[12]=f,M[13]=T,M[14]=h,M[15]=d,M}function u(e,t,n,o,r,a,l,i,s,u,c,E,g,f,T,h,d){return e[0]=t,e[1]=n,e[2]=o,e[3]=r,e[4]=a,e[5]=l,e[6]=i,e[7]=s,e[8]=u,e[9]=c,e[10]=E,e[11]=g,e[12]=f,e[13]=T,e[14]=h,e[15]=d,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(e,t){if(e===t){const n=t[1],o=t[2],r=t[3],a=t[6],l=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=a,e[11]=t[14],e[12]=r,e[13]=l,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function g(e,t){const n=t[0],o=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],u=t[7],c=t[8],E=t[9],g=t[10],f=t[11],T=t[12],h=t[13],d=t[14],M=t[15],p=n*i-o*l,k=n*s-r*l,m=n*u-a*l,L=o*s-r*i,I=o*u-a*i,R=r*u-a*s,A=c*h-E*T,S=c*d-g*T,O=c*M-f*T,v=E*d-g*h,P=E*M-f*h,_=g*M-f*d;let N=p*_-k*P+m*v+L*O-I*S+R*A;return N?(N=1/N,e[0]=(i*_-s*P+u*v)*N,e[1]=(r*P-o*_-a*v)*N,e[2]=(h*R-d*I+M*L)*N,e[3]=(g*I-E*R-f*L)*N,e[4]=(s*O-l*_-u*S)*N,e[5]=(n*_-r*O+a*S)*N,e[6]=(d*m-T*R-M*k)*N,e[7]=(c*R-g*m+f*k)*N,e[8]=(l*P-i*O+u*A)*N,e[9]=(o*O-n*P-a*A)*N,e[10]=(T*I-h*m+M*p)*N,e[11]=(E*m-c*I-f*p)*N,e[12]=(i*S-l*v-s*A)*N,e[13]=(n*v-o*S+r*A)*N,e[14]=(h*k-T*L-d*p)*N,e[15]=(c*L-E*k+g*p)*N,e):null}function f(e,t){const n=t[0],o=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],u=t[7],c=t[8],E=t[9],g=t[10],f=t[11],T=t[12],h=t[13],d=t[14],M=t[15],p=n*i-o*l,k=n*s-r*l,m=n*u-a*l,L=o*s-r*i,I=o*u-a*i,R=r*u-a*s,A=c*h-E*T,S=c*d-g*T,O=c*M-f*T,v=E*d-g*h,P=E*M-f*h,_=g*M-f*d;return e[0]=i*_-s*P+u*v,e[1]=r*P-o*_-a*v,e[2]=h*R-d*I+M*L,e[3]=g*I-E*R-f*L,e[4]=s*O-l*_-u*S,e[5]=n*_-r*O+a*S,e[6]=d*m-T*R-M*k,e[7]=c*R-g*m+f*k,e[8]=l*P-i*O+u*A,e[9]=o*O-n*P-a*A,e[10]=T*I-h*m+M*p,e[11]=E*m-c*I-f*p,e[12]=i*S-l*v-s*A,e[13]=n*v-o*S+r*A,e[14]=h*k-T*L-d*p,e[15]=c*L-E*k+g*p,e}function T(e){const t=e[0],n=e[1],o=e[2],r=e[3],a=e[4],l=e[5],i=e[6],s=e[7],u=e[8],c=e[9],E=e[10],g=e[11],f=e[12],T=e[13],h=e[14],d=t*l-n*a,M=t*i-o*a,p=n*i-o*l,k=u*T-c*f,m=u*h-E*f,L=c*h-E*T;return s*(t*L-n*m+o*k)-r*(a*L-l*m+i*k)+e[15]*(u*p-c*M+E*d)-g*(f*p-T*M+h*d)}function h(e,t,n){const o=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],u=t[6],c=t[7],E=t[8],g=t[9],f=t[10],T=t[11],h=t[12],d=t[13],M=t[14],p=t[15];let k=n[0],m=n[1],L=n[2],I=n[3];return e[0]=k*o+m*i+L*E+I*h,e[1]=k*r+m*s+L*g+I*d,e[2]=k*a+m*u+L*f+I*M,e[3]=k*l+m*c+L*T+I*p,k=n[4],m=n[5],L=n[6],I=n[7],e[4]=k*o+m*i+L*E+I*h,e[5]=k*r+m*s+L*g+I*d,e[6]=k*a+m*u+L*f+I*M,e[7]=k*l+m*c+L*T+I*p,k=n[8],m=n[9],L=n[10],I=n[11],e[8]=k*o+m*i+L*E+I*h,e[9]=k*r+m*s+L*g+I*d,e[10]=k*a+m*u+L*f+I*M,e[11]=k*l+m*c+L*T+I*p,k=n[12],m=n[13],L=n[14],I=n[15],e[12]=k*o+m*i+L*E+I*h,e[13]=k*r+m*s+L*g+I*d,e[14]=k*a+m*u+L*f+I*M,e[15]=k*l+m*c+L*T+I*p,e}function d(e,t,n){const o=n[0],r=n[1],a=n[2];let l,i,s,u,c,E,g,f,T,h,d,M;return t===e?(e[12]=t[0]*o+t[4]*r+t[8]*a+t[12],e[13]=t[1]*o+t[5]*r+t[9]*a+t[13],e[14]=t[2]*o+t[6]*r+t[10]*a+t[14],e[15]=t[3]*o+t[7]*r+t[11]*a+t[15]):(l=t[0],i=t[1],s=t[2],u=t[3],c=t[4],E=t[5],g=t[6],f=t[7],T=t[8],h=t[9],d=t[10],M=t[11],e[0]=l,e[1]=i,e[2]=s,e[3]=u,e[4]=c,e[5]=E,e[6]=g,e[7]=f,e[8]=T,e[9]=h,e[10]=d,e[11]=M,e[12]=l*o+c*r+T*a+t[12],e[13]=i*o+E*r+h*a+t[13],e[14]=s*o+g*r+d*a+t[14],e[15]=u*o+f*r+M*a+t[15]),e}function M(e,t,n){const o=n[0],r=n[1],a=n[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,n,r){let a,l,i,s,u,c,E,g,f,T,h,d,M,p,k,m,L,I,R,A,S,O,v,P,_=r[0],N=r[1],U=r[2],C=Math.hypot(_,N,U);return C<o?null:(C=1/C,_*=C,N*=C,U*=C,a=Math.sin(n),l=Math.cos(n),i=1-l,s=t[0],u=t[1],c=t[2],E=t[3],g=t[4],f=t[5],T=t[6],h=t[7],d=t[8],M=t[9],p=t[10],k=t[11],m=_*_*i+l,L=N*_*i+U*a,I=U*_*i-N*a,R=_*N*i-U*a,A=N*N*i+l,S=U*N*i+_*a,O=_*U*i+N*a,v=N*U*i-_*a,P=U*U*i+l,e[0]=s*m+g*L+d*I,e[1]=u*m+f*L+M*I,e[2]=c*m+T*L+p*I,e[3]=E*m+h*L+k*I,e[4]=s*R+g*A+d*S,e[5]=u*R+f*A+M*S,e[6]=c*R+T*A+p*S,e[7]=E*R+h*A+k*S,e[8]=s*O+g*v+d*P,e[9]=u*O+f*v+M*P,e[10]=c*O+T*v+p*P,e[11]=E*O+h*v+k*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function k(e,t,n){const o=Math.sin(n),r=Math.cos(n),a=t[4],l=t[5],i=t[6],s=t[7],u=t[8],c=t[9],E=t[10],g=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+u*o,e[5]=l*r+c*o,e[6]=i*r+E*o,e[7]=s*r+g*o,e[8]=u*r-a*o,e[9]=c*r-l*o,e[10]=E*r-i*o,e[11]=g*r-s*o,e}function m(e,t,n){const o=Math.sin(n),r=Math.cos(n),a=t[0],l=t[1],i=t[2],s=t[3],u=t[8],c=t[9],E=t[10],g=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-u*o,e[1]=l*r-c*o,e[2]=i*r-E*o,e[3]=s*r-g*o,e[8]=a*o+u*r,e[9]=l*o+c*r,e[10]=i*o+E*r,e[11]=s*o+g*r,e}function L(e,t,n){const o=Math.sin(n),r=Math.cos(n),a=t[0],l=t[1],i=t[2],s=t[3],u=t[4],c=t[5],E=t[6],g=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+u*o,e[1]=l*r+c*o,e[2]=i*r+E*o,e[3]=s*r+g*o,e[4]=u*r-a*o,e[5]=c*r-l*o,e[6]=E*r-i*o,e[7]=g*r-s*o,e}function I(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function R(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t,n){let r,a,l,i=n[0],s=n[1],u=n[2],c=Math.hypot(i,s,u);return c<o?null:(c=1/c,i*=c,s*=c,u*=c,r=Math.sin(t),a=Math.cos(t),l=1-a,e[0]=i*i*l+a,e[1]=s*i*l+u*r,e[2]=u*i*l-s*r,e[3]=0,e[4]=i*s*l-u*r,e[5]=s*s*l+a,e[6]=u*s*l+i*r,e[7]=0,e[8]=i*u*l+s*r,e[9]=s*u*l-i*r,e[10]=u*u*l+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function S(e,t){const n=Math.sin(t),o=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t){const n=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const n=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function P(e,t,n){const o=t[0],r=t[1],a=t[2],l=t[3],i=o+o,s=r+r,u=a+a,c=o*i,E=o*s,g=o*u,f=r*s,T=r*u,h=a*u,d=l*i,M=l*s,p=l*u;return e[0]=1-(f+h),e[1]=E+p,e[2]=g-M,e[3]=0,e[4]=E-p,e[5]=1-(c+h),e[6]=T+d,e[7]=0,e[8]=g+M,e[9]=T-d,e[10]=1-(c+f),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _(e,t){const n=new r(3),o=-t[0],a=-t[1],l=-t[2],i=t[3],s=t[4],u=t[5],c=t[6],E=t[7],g=o*o+a*a+l*l+i*i;return g>0?(n[0]=2*(s*i+E*o+u*l-c*a)/g,n[1]=2*(u*i+E*a+c*o-s*l)/g,n[2]=2*(c*i+E*l+s*a-u*o)/g):(n[0]=2*(s*i+E*o+u*l-c*a),n[1]=2*(u*i+E*a+c*o-s*l),n[2]=2*(c*i+E*l+s*a-u*o)),P(e,t,n),e}function N(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function U(e,t){const n=t[0],o=t[1],r=t[2],a=t[4],l=t[5],i=t[6],s=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(n,o,r),e[1]=Math.hypot(a,l,i),e[2]=Math.hypot(s,u,c),e}function C(e,t){const n=new r(3);U(n,t);const o=1/n[0],a=1/n[1],l=1/n[2],i=t[0]*o,s=t[1]*a,u=t[2]*l,c=t[4]*o,E=t[5]*a,g=t[6]*l,f=t[8]*o,T=t[9]*a,h=t[10]*l,d=i+E+h;let M=0;return d>0?(M=2*Math.sqrt(d+1),e[3]=.25*M,e[0]=(g-T)/M,e[1]=(f-u)/M,e[2]=(s-c)/M):i>E&&i>h?(M=2*Math.sqrt(1+i-E-h),e[3]=(g-T)/M,e[0]=.25*M,e[1]=(s+c)/M,e[2]=(f+u)/M):E>h?(M=2*Math.sqrt(1+E-i-h),e[3]=(f-u)/M,e[0]=(s+c)/M,e[1]=.25*M,e[2]=(g+T)/M):(M=2*Math.sqrt(1+h-i-E),e[3]=(s-c)/M,e[0]=(f+u)/M,e[1]=(g+T)/M,e[2]=.25*M),e}function F(e,t,n,o){t[0]=o[12],t[1]=o[13],t[2]=o[14];const r=o[0],a=o[1],l=o[2],i=o[4],s=o[5],u=o[6],c=o[8],E=o[9],g=o[10];n[0]=Math.hypot(r,a,l),n[1]=Math.hypot(i,s,u),n[2]=Math.hypot(c,E,g);const f=1/n[0],T=1/n[1],h=1/n[2],d=r*f,M=a*T,p=l*h,k=i*f,m=s*T,L=u*h,I=c*f,R=E*T,A=g*h,S=d+m+A;let O=0;return S>0?(O=2*Math.sqrt(S+1),e[3]=.25*O,e[0]=(L-R)/O,e[1]=(I-p)/O,e[2]=(M-k)/O):d>m&&d>A?(O=2*Math.sqrt(1+d-m-A),e[3]=(L-R)/O,e[0]=.25*O,e[1]=(M+k)/O,e[2]=(I+p)/O):m>A?(O=2*Math.sqrt(1+m-d-A),e[3]=(I-p)/O,e[0]=(M+k)/O,e[1]=.25*O,e[2]=(L+R)/O):(O=2*Math.sqrt(1+A-d-m),e[3]=(M-k)/O,e[0]=(I+p)/O,e[1]=(L+R)/O,e[2]=.25*O),e}function b(e,t,n,o){const r=t[0],a=t[1],l=t[2],i=t[3],s=r+r,u=a+a,c=l+l,E=r*s,g=r*u,f=r*c,T=a*u,h=a*c,d=l*c,M=i*s,p=i*u,k=i*c,m=o[0],L=o[1],I=o[2];return e[0]=(1-(T+d))*m,e[1]=(g+k)*m,e[2]=(f-p)*m,e[3]=0,e[4]=(g-k)*L,e[5]=(1-(E+d))*L,e[6]=(h+M)*L,e[7]=0,e[8]=(f+p)*I,e[9]=(h-M)*I,e[10]=(1-(E+T))*I,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function x(e,t,n,o,r){const a=t[0],l=t[1],i=t[2],s=t[3],u=a+a,c=l+l,E=i+i,g=a*u,f=a*c,T=a*E,h=l*c,d=l*E,M=i*E,p=s*u,k=s*c,m=s*E,L=o[0],I=o[1],R=o[2],A=r[0],S=r[1],O=r[2],v=(1-(h+M))*L,P=(f+m)*L,_=(T-k)*L,N=(f-m)*I,U=(1-(g+M))*I,C=(d+p)*I,F=(T+k)*R,b=(d-p)*R,x=(1-(g+h))*R;return e[0]=v,e[1]=P,e[2]=_,e[3]=0,e[4]=N,e[5]=U,e[6]=C,e[7]=0,e[8]=F,e[9]=b,e[10]=x,e[11]=0,e[12]=n[0]+A-(v*A+N*S+F*O),e[13]=n[1]+S-(P*A+U*S+b*O),e[14]=n[2]+O-(_*A+C*S+x*O),e[15]=1,e}function D(e,t){const n=t[0],o=t[1],r=t[2],a=t[3],l=n+n,i=o+o,s=r+r,u=n*l,c=o*l,E=o*i,g=r*l,f=r*i,T=r*s,h=a*l,d=a*i,M=a*s;return e[0]=1-E-T,e[1]=c+M,e[2]=g-d,e[3]=0,e[4]=c-M,e[5]=1-u-T,e[6]=f+h,e[7]=0,e[8]=g+d,e[9]=f-h,e[10]=1-u-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t,n,o,r,a,l){const i=1/(n-t),s=1/(r-o),u=1/(a-l);return e[0]=2*a*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*s,e[6]=0,e[7]=0,e[8]=(n+t)*i,e[9]=(r+o)*s,e[10]=(l+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=l*a*2*u,e[15]=0,e}function B(e,t,n,o,r){const a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(o-r);e[10]=(r+o)*t,e[14]=2*r*o*t}else e[10]=-1,e[14]=-2*o;return e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){let e=0,t=arguments.length;for(;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var w=B;function G(e,t,n,o,r){const a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(o-r);e[10]=r*t,e[14]=r*o*t}else e[10]=-1,e[14]=-o;return e}function V(e,t,n,o){const r=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),l=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),s=2/(l+i),u=2/(r+a);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(l-i)*s*.5,e[9]=(r-a)*u*.5,e[10]=o/(n-o),e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n/(n-o),e[15]=0,e}function $(e,t,n,o,r,a,l){const i=1/(t-n),s=1/(o-r),u=1/(a-l);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*i,e[13]=(r+o)*s,e[14]=(l+a)*u,e[15]=1,e}var X=$;function Q(e,t,n,o,r,a,l){const i=1/(t-n),s=1/(o-r),u=1/(a-l);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+n)*i,e[13]=(r+o)*s,e[14]=a*u,e[15]=1,e}function H(e,t,n,r){let a,l,i,s,u,E,g,f,T,h;const d=t[0],M=t[1],p=t[2],k=r[0],m=r[1],L=r[2],I=n[0],R=n[1],A=n[2];return Math.abs(d-I)<o&&Math.abs(M-R)<o&&Math.abs(p-A)<o?c(e):(g=d-I,f=M-R,T=p-A,h=1/Math.hypot(g,f,T),g*=h,f*=h,T*=h,a=m*T-L*f,l=L*g-k*T,i=k*f-m*g,h=Math.hypot(a,l,i),h?(h=1/h,a*=h,l*=h,i*=h):(a=0,l=0,i=0),s=f*i-T*l,u=T*a-g*i,E=g*l-f*a,h=Math.hypot(s,u,E),h?(h=1/h,s*=h,u*=h,E*=h):(s=0,u=0,E=0),e[0]=a,e[1]=s,e[2]=g,e[3]=0,e[4]=l,e[5]=u,e[6]=f,e[7]=0,e[8]=i,e[9]=E,e[10]=T,e[11]=0,e[12]=-(a*d+l*M+i*p),e[13]=-(s*d+u*M+E*p),e[14]=-(g*d+f*M+T*p),e[15]=1,e)}function q(e,t,n,o){const r=t[0],a=t[1],l=t[2],i=o[0],s=o[1],u=o[2];let c=r-n[0],E=a-n[1],g=l-n[2],f=c*c+E*E+g*g;f>0&&(f=1/Math.sqrt(f),c*=f,E*=f,g*=f);let T=s*g-u*E,h=u*c-i*g,d=i*E-s*c;return f=T*T+h*h+d*d,f>0&&(f=1/Math.sqrt(f),T*=f,h*=f,d*=f),e[0]=T,e[1]=h,e[2]=d,e[3]=0,e[4]=E*d-g*h,e[5]=g*T-c*d,e[6]=c*h-E*T,e[7]=0,e[8]=c,e[9]=E,e[10]=g,e[11]=0,e[12]=r,e[13]=a,e[14]=l,e[15]=1,e}function W(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Y(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function j(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function K(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function z(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function J(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e[2]=t[2]+n[2]*o,e[3]=t[3]+n[3]*o,e[4]=t[4]+n[4]*o,e[5]=t[5]+n[5]*o,e[6]=t[6]+n[6]*o,e[7]=t[7]+n[7]*o,e[8]=t[8]+n[8]*o,e[9]=t[9]+n[9]*o,e[10]=t[10]+n[10]*o,e[11]=t[11]+n[11]*o,e[12]=t[12]+n[12]*o,e[13]=t[13]+n[13]*o,e[14]=t[14]+n[14]*o,e[15]=t[15]+n[15]*o,e}function Z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ee(e,t){const n=e[0],r=e[1],a=e[2],l=e[3],i=e[4],s=e[5],u=e[6],c=e[7],E=e[8],g=e[9],f=e[10],T=e[11],h=e[12],d=e[13],M=e[14],p=e[15],k=t[0],m=t[1],L=t[2],I=t[3],R=t[4],A=t[5],S=t[6],O=t[7],v=t[8],P=t[9],_=t[10],N=t[11],U=t[12],C=t[13],F=t[14],b=t[15];return Math.abs(n-k)<=o*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(r-m)<=o*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-L)<=o*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(l-I)<=o*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(i-R)<=o*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(s-A)<=o*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-S)<=o*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-O)<=o*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(E-v)<=o*Math.max(1,Math.abs(E),Math.abs(v))&&Math.abs(g-P)<=o*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(f-_)<=o*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(T-N)<=o*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(h-U)<=o*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(d-C)<=o*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(M-F)<=o*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(p-b)<=o*Math.max(1,Math.abs(p),Math.abs(b))}var te=h,ne=K}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607)})();