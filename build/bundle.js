(()=>{"use strict";var e={85:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.canvasDrawFunction=t.canvasDraw=t.initCanvas=t.mainCanvas=void 0;const o=n(283),r=n(607),l=n(750),s=n(984);t.mainCanvas=document.getElementById("main-canvas");const a=t.mainCanvas.getContext("2d"),i=document.querySelector(".zoom-in-button"),E=document.querySelector(".zoom-out-button"),u=new o.Vector(0,0);let c=1;const T=new o.Vector(0,0),g=new o.Vector(0,0);let f=!1;const k=function(e){const t=(c*(e>0?1+.2*e:1/(1-.2*e))-c)/10;let n=0;const o=setInterval((function(){c+=t,(0,r.scheduleRedraw)(),n++,n>=10&&clearInterval(o)}),10)};t.initCanvas=function(){t.mainCanvas.addEventListener("mousedown",(function(e){T.set(u.x,u.y),g.set(e.clientX,e.clientY),f=!0})),(0,l.onMouseDrag)(t.mainCanvas,(e=>{f&&(u.x=T.x+e.x-g.x,u.y=T.y+e.y-g.y,(0,r.scheduleRedraw)())})),t.mainCanvas.addEventListener("mouseup",(()=>{f=!1})),t.mainCanvas.addEventListener("mouseleave",(()=>{f=!1})),t.mainCanvas.addEventListener("wheel",(e=>{var t;t=-e.deltaY/200,c*=t>0?1+.2*t:1/(1-.2*t),(0,r.scheduleRedraw)()})),i.addEventListener("click",(()=>{k(1)})),E.addEventListener("click",(()=>{k(-1)}))},t.canvasDraw=function(){a&&(t.mainCanvas.width=t.mainCanvas.clientWidth,t.mainCanvas.height=t.mainCanvas.clientHeight,a.clearRect(0,0,t.mainCanvas.width,t.mainCanvas.height),d())};const L=function(e,t,n,o){a&&(a.beginPath(),a.moveTo(e,t),a.lineTo(n,o),a.stroke())},d=function(){if(!a)return;const e=t.mainCanvas.width,n=t.mainCanvas.height,o=e/n;a.strokeStyle="#fff",a.lineWidth=2,L(e/2+u.x,0,e/2+u.x,n),L(0,n/2+u.y,e,n/2+u.y);const r=Math.pow(2,Math.floor(Math.log(c)/Math.log(2))),l=n/16/r*c;let s=-Math.floor(16/c/2*r)/r-Math.floor(u.y/l)/r-(u.y<0?1/r:0)-1/r;const i=(n%(2*l)-2*l)/2,E=u.y%l;for(let t=0;t<n+2*l;t+=l,s+=1/r)a.strokeStyle="#666",a.lineWidth=.5,L(0,t+i+E,e,t+i+E),a.strokeStyle="transparent",a.fillStyle="#fff",a.textAlign="right",0!==s&&(a.beginPath(),a.fillText((-s).toString(),e/2+u.x-10,t+i+E+4));const T=e/16/r/o*c;let g=-Math.floor(16/c/2*r*o)/r-Math.floor(u.x/T)/r-(u.x<0?1/r:0)-1/r;const f=(e%(2*T)-2*T)/2,k=u.x%T;for(let t=0;t<e+T;t+=T,g+=1/r)a.strokeStyle="#666",a.lineWidth=.5,L(t+f+k,0,t+f+k,n),a.strokeStyle="transparent",a.fillStyle="#fff",a.textAlign="center",0!==g?(a.beginPath(),a.fillText(g.toString(),t+f+k,n/2+u.y+20)):(a.beginPath(),a.fillText((-g).toString(),t+f+k-18,n/2+u.y+20))};t.canvasDrawFunction=function(e,n){if(!a||!e)return;const r=t.mainCanvas.width,l=t.mainCanvas.height,i=r/l;a.strokeStyle=n,a.lineWidth=2.5,a.fillStyle="transparent",a.beginPath();const E=r/16/i*c,T=u.x/E;let g=!0;for(let t=-8*i/c-T;t<8*i/c-T;t+=.01/c){const n=(0,s.constantEvalX)(e,t);if((0,s.constantEvalGetError)())return;const E=(0,o.map)(t,-8*i/c,8*i/c,0,r)+u.x,T=(0,o.map)(n,-8/c,8/c,l,0)+u.y;g&&(a.moveTo(E,T),g=!1),a.lineTo(E,T)}a.stroke()}},984:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.constantEvalGetError=t.constantEvalX=t.constantEval=void 0;const o=n(607),r=n(99),l=n(750),s=n(283);let a,i=null;t.constantEval=function(e){return e?(i=null,c(e)):0},t.constantEvalX=function(e,n){a=n;const o=(0,t.constantEval)(e);return a=null,o};const E=function(e){return console.error("Error during constant evaluation: "+e),i=e,0};t.constantEvalGetError=()=>i;const u=e=>null!=e&&"function"==typeof e[Symbol.iterator],c=function(e){var t;switch(e.op.tok){case r.Token.UNDEF:return E("Token UNDEFINED is not allowed");case r.Token.NONE:return 0;case r.Token.PAREN_OP:return E("Token OPEN PARENTHESIS is not allowed");case r.Token.PAREN_CL:return E("Token CLOSE PARENTHESIS is not allowed");case r.Token.BRACKET_OP:return E("Token OPEN BRACKET is not allowed");case r.Token.BRACKET_CL:return E("Token CLOSE BRACKET is not allowed");case r.Token.BRACE_OP:return E("Token OPEN BRACE is not allowed");case r.Token.BRACE_CL:return E("Token CLOSE BRACE is not allowed");case r.Token.NUM:return"number"!=typeof e.op.val?E("Token NUMBER must be a number"):e.op.val;case r.Token.CONST:return"number"!=typeof e.op.val?E("Token CONSTANT must be a number"):e.op.val;case r.Token.VAR:return null==a?E("Token VARIABLE is not allowed"):a;case r.Token.VAR2:return E("Token VARIABLE2 is not allowed");case r.Token.TIME:return(0,o.scheduleRedraw)(),(0,o.getGlobalTime)();case r.Token.ADD:return null==e.left||null==e.right?E("Missing arguments for Token ADDITION"):c(e.left)+c(e.right);case r.Token.SUB:return null==e.left||null==e.right?E("Missing arguments for Token SUBTRACTION"):c(e.left)-c(e.right);case r.Token.MULT:return null==e.left||null==e.right?E("Missing arguments for Token MULTIPLICATION"):c(e.left)*c(e.right);case r.Token.DIV:return null==e.left||null==e.right?E("Missing arguments for Token DIVISION"):c(e.left)/c(e.right);case r.Token.POW:return null==e.left||null==e.right?E("Missing arguments for Token POWER"):Math.pow(c(e.left),c(e.right));case r.Token.SQRT:return null==e.right?E("Missing argument for Token SQUARE ROOT"):Math.sqrt(c(e.right));case r.Token.LOG:return null==e.right?E("Missing argument for Token LOGARITHM"):Math.log(c(e.right));case r.Token.EXP:return null==e.right?E("Missing argument for Token EXPOENTIAL"):Math.exp(c(e.right));case r.Token.SIN:return null==e.right?E("Missing argument for Token SINE"):Math.sin(c(e.right));case r.Token.COS:return null==e.right?E("Missing argument for Token COSINE"):Math.cos(c(e.right));case r.Token.TAN:return null==e.right?E("Missing argument for Token TANGENT"):Math.tan(c(e.right));case r.Token.ASIN:return null==e.right?E("Missing argument for Token ARC SINE"):Math.asin(c(e.right));case r.Token.ACOS:return null==e.right?E("Missing argument for Token ARC COSINE"):Math.acos(c(e.right));case r.Token.ATAN:return null==e.right?E("Missing argument for Token ARC TANGENT"):Math.atan(c(e.right));case r.Token.FLOOR:return null==e.right?E("Missing argument for Token FLOOR"):Math.floor(c(e.right));case r.Token.MIN:return null==e.right?E("Missing argument for Token MIN"):u(c(e.right))?Math.min(...c(e.right)):E("Malformed argument for Token MIN");case r.Token.MAX:return null==e.right?E("Missing argument for Token MAX"):u(c(e.right))?Math.max(...c(e.right)):E("Malformed argument for Token MAX");case r.Token.DELIM:return null==e.left||null==e.right?E("Missing arguments for Token DELIMITER"):[c(e.left),c(e.right)];case r.Token.ABS:return null==e.right?E("Missing argument for Token ABSOLUTE"):Math.abs(c(e.right));case r.Token.RAND:return null==e.right?E("Missing argument for Token RANDOM"):Math.random()*c(e.right);case r.Token.PERLIN:{if(null==e.right)return E("Missing arguments for Token PERLIN");if(!u(c(e.right)))return E("Malformed argument for Token PERLIN");const[t,n]=c(e.right);return(0,s.perlin2)(t,n)}case r.Token.MOD:return null==e.left||null==e.right?E("Missing arguments for Token MODULUS"):c(e.left)%c(e.right);case r.Token.LEVEL_SET:return E("Token LEVEL SET is not allowed");case r.Token.VECTOR_FIELD:return E("Token VECTOR FIELD is not allowed");case r.Token.LESS:return null==e.left||null==e.right?E("Missing arguments for Token LESS THAN"):c(e.left)<c(e.right)?1:0;case r.Token.GREATER:return null==e.left||null==e.right?E("Missing arguments for Token GREATER THAN"):c(e.left)>c(e.right)?1:0;case r.Token.LESS_OR_EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token LESS THAN OR EQUAL TO"):c(e.left)<=c(e.right)?1:0;case r.Token.GREATER_OR_EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token GREATER THAN OR EQUAL TO"):c(e.left)>=c(e.right)?1:0;case r.Token.EQUAL:return null==e.left||null==e.right?E("Missing arguments for Token EQUAL TO"):c(e.left)-c(e.right)<1e-5?1:0;case r.Token.AND:return null==e.left||null==e.right?E("Missing arguments for Token AND"):c(e.left)&&c(e.right)?1:0;case r.Token.OR:return null==e.left||null==e.right?E("Missing arguments for Token OR"):c(e.left)||c(e.right)?1:0;case r.Token.USERVAR:return(0,r.getUserVariable)(e.op.val);case r.Token.FACTORIAL:return null==e.right?E("Missing argument for Token FACTORIAL"):(0,s.factorial)(c(e.right));case r.Token.SIGMOID:return null==e.right?E("Missing argument for Token SIGMOID"):(0,s.sigmoid)(c(e.right));case r.Token.CIRCLE:return E("Token CIRCLE is not allowed");case r.Token.POINT:return E("Token POINT is not allowed");case r.Token.TRUE:return 1;case r.Token.FALSE:return 0;case r.Token.POLAR:return E("Token POLAR is not allowed");case r.Token.CARTESIAN:return E("Token CARTESIAN is not allowed");case r.Token.MOUSEX:return(0,l.getMousePos)().x;case r.Token.MOUSEY:return(0,l.getMousePos)().y;case r.Token.MOUSE:return[(0,l.getMousePos)().x,(0,l.getMousePos)().y];case r.Token.ASSIGN:return null==e.left||null==e.right?E("Missing arguments for Token ASSIGN"):e.left.op.tok!==r.Token.ASSIGNABLE?e.left.op.tok===r.Token.USERVAR?((0,r.setUserVariable)(e.left.op.val,c(e.right)),c(e.right)):E("Left side of ASSIGN must be assignable"):null==(0,r.getExternVariable)(e.left.op.val)?E(`Variable ${e.left.op.val} does not exist`):(null===(t=(0,r.getExternVariable)(e.left.op.val))||void 0===t||t.set(c(e.right)),c(e.right));default:return E(`Unknown token ${e.op.val}`)}}},533:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawPlots=t.drivePlots=t.resetPlots=t.setNumInputs=t.setInputAt=void 0;const o=n(607),r=n(85),l=n(195),s=n(103),a=n(320),i=n(984),E=[];let u=0;t.setInputAt=(e,t)=>{e<0||e>u||(E[e].input=t,E[e].inputChanged=!0,(0,o.scheduleRedraw)())},t.setNumInputs=e=>{u=e;for(let e=u;e<E.length;e++)delete E[e];(0,o.scheduleRedraw)()},t.resetPlots=()=>{E.length=0,(0,o.scheduleRedraw)()};const c=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];t.drivePlots=()=>{for(let t=1;t<=u;t++){E[t]||(E[t]={input:"",inputChanged:!1,ast:null,status:l.PlotStatus.PENDING,driver:l.PlotDriver.CANVAS,displayMode:l.PlotDisplayMode.NONE,color:(e=t,c[e%c.length]),error:""},(0,a.inputSetColorAt)(t,E[t].color));const n=E[t];if(n.inputChanged){n.inputChanged=!1;const e=n.status;if(0===n.input.trim().length){n.status=l.PlotStatus.PENDING,n.ast=null,e!==n.status&&(0,a.inputSetStatusAt)(t,n.status),(0,o.scheduleRedraw)();continue}const r=n.ast;n.ast=(0,s.parse)(n.input),console.debug("Parsed AST:",n.ast);const i=n.error,E=(0,s.parserGetError)();E?(n.status=l.PlotStatus.ERROR,n.error=E.desc):(n.status=l.PlotStatus.ACTIVE,n.error=""),n.status!==e&&(0,a.inputSetStatusAt)(t,n.status),n.error!==i&&(0,a.inputSetErrorAt)(t,n.error),JSON.stringify(r)!==JSON.stringify(n.ast)&&(0,o.scheduleRedraw)();const u=(0,s.parserGetNumVars)(),c=n.driver;switch(u){case 0:n.driver=l.PlotDriver.CONSTANT;break;case 1:n.driver=l.PlotDriver.CANVAS;break;case 2:n.driver=l.PlotDriver.WEBGL}n.driver!==c&&(0,a.inputSetDriverAt)(t,n.driver),n.displayMode=(0,s.parserGetDisplayMode)()}}var e},t.drawPlots=()=>{for(let e=1;e<=u;e++){const t=E[e];if(t&&t.status===l.PlotStatus.ACTIVE)switch(t.driver){case l.PlotDriver.CONSTANT:{const n=(0,i.constantEval)(t.ast);(0,a.inputSetConstEvalAt)(e,n);const o=(0,i.constantEvalGetError)();o&&(t.status=l.PlotStatus.ERROR,t.error=o,(0,a.inputSetStatusAt)(e,t.status),(0,a.inputSetErrorAt)(e,t.error));break}case l.PlotDriver.CANVAS:{(0,r.canvasDrawFunction)(t.ast,t.color);const n=(0,i.constantEvalGetError)();n&&(t.status=l.PlotStatus.ERROR,t.error=n,(0,a.inputSetStatusAt)(e,t.status),(0,a.inputSetErrorAt)(e,t.error));break}case l.PlotDriver.WEBGL:}}}},195:(e,t)=>{var n,o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PlotDriver=t.PlotStatus=t.PlotDisplayMode=void 0,(r=t.PlotDisplayMode||(t.PlotDisplayMode={}))[r.NONE=0]="NONE",r[r.CONSTANT_EVAL=1]="CONSTANT_EVAL",r[r.FUNCTION_GRAPH=2]="FUNCTION_GRAPH",r[r.SET=3]="SET",r[r.LEVEL_SET=4]="LEVEL_SET",r[r.VECTOR_FIELD=5]="VECTOR_FIELD",(o=t.PlotStatus||(t.PlotStatus={}))[o.PENDING=0]="PENDING",o[o.ACTIVE=1]="ACTIVE",o[o.ERROR=2]="ERROR",(n=t.PlotDriver||(t.PlotDriver={}))[n.CONSTANT=0]="CONSTANT",n[n.CANVAS=1]="CANVAS",n[n.WEBGL=2]="WEBGL"},99:(e,t)=>{var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.lex=t.clearUserVariables=t.getUserVariable=t.setUserVariable=t.getExternVariable=t.unbindExternVariable=t.bindExternVariable=t.lexerGetError=t.TokenFlag=t.Token=void 0,function(e){e[e.UNDEF=0]="UNDEF",e[e.NONE=1]="NONE",e[e.VAR=2]="VAR",e[e.VAR2=3]="VAR2",e[e.NUM=4]="NUM",e[e.CONST=5]="CONST",e[e.PAREN_OP=6]="PAREN_OP",e[e.PAREN_CL=7]="PAREN_CL",e[e.BRACKET_OP=8]="BRACKET_OP",e[e.BRACKET_CL=9]="BRACKET_CL",e[e.BRACE_OP=10]="BRACE_OP",e[e.BRACE_CL=11]="BRACE_CL",e[e.DELIM=12]="DELIM",e[e.ASSIGN=13]="ASSIGN",e[e.ASSIGNABLE=14]="ASSIGNABLE",e[e.LESS=15]="LESS",e[e.GREATER=16]="GREATER",e[e.LESS_OR_EQUAL=17]="LESS_OR_EQUAL",e[e.GREATER_OR_EQUAL=18]="GREATER_OR_EQUAL",e[e.USERVAR=19]="USERVAR",e[e.ADD=20]="ADD",e[e.SUB=21]="SUB",e[e.MULT=22]="MULT",e[e.DIV=23]="DIV",e[e.POW=24]="POW",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.NOT_EQUAL=27]="NOT_EQUAL",e[e.EQUAL=28]="EQUAL",e[e.TRUE=29]="TRUE",e[e.FALSE=30]="FALSE",e[e.SQRT=31]="SQRT",e[e.EXP=32]="EXP",e[e.LOG=33]="LOG",e[e.SIN=34]="SIN",e[e.COS=35]="COS",e[e.TAN=36]="TAN",e[e.ASIN=37]="ASIN",e[e.ACOS=38]="ACOS",e[e.ATAN=39]="ATAN",e[e.FLOOR=40]="FLOOR",e[e.MIN=41]="MIN",e[e.MAX=42]="MAX",e[e.ABS=43]="ABS",e[e.MOD=44]="MOD",e[e.RAND=45]="RAND",e[e.PERLIN=46]="PERLIN",e[e.FACTORIAL=47]="FACTORIAL",e[e.SIGMOID=48]="SIGMOID",e[e.LEVEL_SET=49]="LEVEL_SET",e[e.VECTOR_FIELD=50]="VECTOR_FIELD",e[e.CIRCLE=51]="CIRCLE",e[e.POINT=52]="POINT",e[e.TIME=53]="TIME",e[e.COMPLEX=54]="COMPLEX",e[e.POLAR=55]="POLAR",e[e.CARTESIAN=56]="CARTESIAN",e[e.MOUSEX=57]="MOUSEX",e[e.MOUSEY=58]="MOUSEY",e[e.MOUSE=59]="MOUSE"}(n=t.Token||(t.Token={})),function(e){e[e.IMPL_MULT_BEFORE=1]="IMPL_MULT_BEFORE",e[e.IMPL_MULT_AFTER=2]="IMPL_MULT_AFTER",e[e.PREFIX=4]="PREFIX",e[e.UNIQUE=16]="UNIQUE",e[e.BEGIN_SCOPE=32]="BEGIN_SCOPE",e[e.END_SCOPE=64]="END_SCOPE"}(o=t.TokenFlag||(t.TokenFlag={}));const r={"(":{tok:n.PAREN_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},")":{tok:n.PAREN_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},"[":{tok:n.BRACKET_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},"]":{tok:n.BRACKET_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},"{":{tok:n.BRACE_OP,flags:o.IMPL_MULT_BEFORE|o.UNIQUE|o.BEGIN_SCOPE},"}":{tok:n.BRACE_CL,flags:o.IMPL_MULT_AFTER|o.UNIQUE|o.END_SCOPE},",":{tok:n.DELIM,flags:o.UNIQUE},"=":{tok:n.ASSIGN,flags:0},x:{tok:n.VAR,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},y:{tok:n.VAR2,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},"<":{tok:n.LESS,flags:0},">":{tok:n.GREATER,flags:0},"<=":{tok:n.LESS_OR_EQUAL,flags:o.UNIQUE},">=":{tok:n.GREATER_OR_EQUAL,flags:o.UNIQUE},"!=":{tok:n.NOT_EQUAL,flags:o.UNIQUE},"==":{tok:n.EQUAL,flags:o.UNIQUE},"&&":{tok:n.AND,flags:o.UNIQUE},"||":{tok:n.OR,flags:o.UNIQUE},"+":{tok:n.ADD,flags:o.UNIQUE},"-":{tok:n.SUB,flags:o.UNIQUE},"*":{tok:n.MULT,flags:0},"/":{tok:n.DIV,flags:o.UNIQUE},"^":{tok:n.POW,flags:o.UNIQUE},"**":{tok:n.POW,flags:o.UNIQUE},"%":{tok:n.MOD,flags:0},mod:{tok:n.MOD,flags:0},true:{tok:n.TRUE,flags:0},false:{tok:n.FALSE,flags:0},sqrt:{tok:n.SQRT,flags:o.IMPL_MULT_BEFORE|o.PREFIX},exp:{tok:n.EXP,flags:o.IMPL_MULT_BEFORE|o.PREFIX},log:{tok:n.LOG,flags:o.IMPL_MULT_BEFORE|o.PREFIX},ln:{tok:n.LOG,flags:o.IMPL_MULT_BEFORE|o.PREFIX},sin:{tok:n.SIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},cos:{tok:n.COS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},tan:{tok:n.TAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},asin:{tok:n.ASIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},acos:{tok:n.ACOS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},atan:{tok:n.ATAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arcsin:{tok:n.ASIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arccos:{tok:n.ACOS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},arctan:{tok:n.ATAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},floor:{tok:n.FLOOR,flags:o.IMPL_MULT_BEFORE|o.PREFIX},min:{tok:n.MIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},max:{tok:n.MAX,flags:o.IMPL_MULT_BEFORE|o.PREFIX},abs:{tok:n.ABS,flags:o.IMPL_MULT_BEFORE|o.PREFIX},rand:{tok:n.RAND,flags:o.IMPL_MULT_BEFORE|o.PREFIX},random:{tok:n.RAND,flags:o.IMPL_MULT_BEFORE|o.PREFIX},perlin:{tok:n.PERLIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},noise:{tok:n.PERLIN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},fact:{tok:n.FACTORIAL,flags:o.IMPL_MULT_BEFORE|o.PREFIX},factorial:{tok:n.FACTORIAL,flags:o.IMPL_MULT_BEFORE|o.PREFIX},sigmoid:{tok:n.SIGMOID,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Level:{tok:n.LEVEL_SET,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Niveau:{tok:n.LEVEL_SET,flags:o.IMPL_MULT_BEFORE|o.PREFIX},VectorField:{tok:n.VECTOR_FIELD,flags:o.IMPL_MULT_BEFORE|o.PREFIX},"|":{tok:n.ABS,flags:o.BEGIN_SCOPE|o.END_SCOPE},Circle:{tok:n.CIRCLE,flags:o.PREFIX},Point:{tok:n.POINT,flags:o.PREFIX},Polar:{tok:n.POLAR,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Pol:{tok:n.POLAR,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Cartesian:{tok:n.CARTESIAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},Cart:{tok:n.CARTESIAN,flags:o.IMPL_MULT_BEFORE|o.PREFIX},t:{tok:n.TIME,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouseX:{tok:n.MOUSEX,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouseY:{tok:n.MOUSEY,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER},mouse:{tok:n.MOUSE,flags:0}},l={pi:Math.PI,Pi:Math.PI,e:Math.E};let s=null;t.lexerGetError=()=>s;const a=e=>/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e),i={};t.bindExternVariable=(e,t,n)=>{i[e]={get:t,set:n}},t.unbindExternVariable=e=>{delete i[e]},t.getExternVariable=e=>i[e];let E={};t.setUserVariable=(e,t)=>{E[e]=t},t.getUserVariable=e=>E[e]||0,t.clearUserVariables=()=>{E={}},t.lex=e=>{s=null;const t=(e=e.replace(/\s/g,"")).split(new RegExp(`(${Object.keys(r).filter((e=>r[e].flags&o.UNIQUE)).map((e=>(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(e))).join("|")})`,"g")).filter((e=>""!==e)),E=[];let u=0;return t.forEach((e=>{let t=0;for(let g=e.length;g>t;g--){const f=e.substring(t,g);let k=!1;if(r[f])E.push({tok:r[f].tok,val:0,flags:r[f].flags}),k=!0;else if(l[f])E.push({tok:n.CONST,val:l[f],flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),k=!0;else if(i[f])E.push({tok:n.ASSIGNABLE,val:f,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),k=!0;else if(isNaN(Number(f))){if(g-1===t){let r="";for(let n=t+1;n<=e.length;n++){const o=e.substring(t,n);if(!a(o))break;r=o}if(""!==r){E.push({tok:n.USERVAR,val:r,flags:o.IMPL_MULT_BEFORE|o.IMPL_MULT_AFTER}),t+=r.length,g=e.length+1;continue}return c=`Unknown token: ´${e.substring(t,e.length)}´`,T=u+t,console.error(`Error at position ${T}: ${c}`),s={desc:c,pos:T},[]}}else E.push({tok:n.NUM,val:parseFloat(f),flags:o.IMPL_MULT_AFTER}),k=!0;k&&(t=g,g=e.length+1)}var c,T;u+=e.length})),E}},103:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.parserGetDisplayMode=t.parserGetNumVars=t.parserGetError=void 0;const o=n(195),r=n(99),l={[r.Token.OR]:0,[r.Token.DELIM]:1,[r.Token.AND]:2,[r.Token.EQUAL]:3,[r.Token.NOT_EQUAL]:3,[r.Token.ASSIGN]:3,[r.Token.LESS]:4,[r.Token.LESS_OR_EQUAL]:4,[r.Token.GREATER]:4,[r.Token.GREATER_OR_EQUAL]:4,[r.Token.ADD]:5,[r.Token.SUB]:5,[r.Token.MULT]:6,[r.Token.DIV]:6,[r.Token.MOD]:6,[r.Token.POW]:7};let s=null;t.parserGetError=()=>s;const a=(e,t)=>{console.error(`Error at position ${t}: ${e}`),s={desc:e,pos:t}};let i=0,E=o.PlotDisplayMode.NONE;t.parserGetNumVars=()=>i,t.parserGetDisplayMode=()=>E,t.parse=e=>{s=null,i=0,E=o.PlotDisplayMode.NONE;let t=(0,r.lex)(e);console.debug("Lexer output:",t);const n=(0,r.lexerGetError)();return n?(s=JSON.parse(JSON.stringify(n)),null):(i=t.filter((e=>e.tok===r.Token.VAR)).length>0||0+t.filter((e=>e.tok===r.Token.VAR2)).length>0?1:0,0===i?E=o.PlotDisplayMode.CONSTANT_EVAL:1===i?E=o.PlotDisplayMode.FUNCTION_GRAPH:2===i&&(E=o.PlotDisplayMode.SET,t.filter((e=>e.tok===r.Token.LEVEL_SET)).length>0?E=o.PlotDisplayMode.LEVEL_SET:t.filter((e=>e.tok===r.Token.VECTOR_FIELD)).length>0&&(E=o.PlotDisplayMode.VECTOR_FIELD)),t=u(t),console.debug("Validated ops:",t),null==t?null:(t=c(t),console.debug("Expanded ops:",t),null==t?null:(t=T(t),console.debug("Optimized ops:",t),null==t?null:g(t))))};const u=e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o.flags&r.TokenFlag.BEGIN_SCOPE&&t.push({tok:o.tok,pos:n}),o.flags&r.TokenFlag.END_SCOPE){const{tok:e,pos:n}=t.pop()||{tok:r.Token.NONE,pos:0};let l=r.Token.NONE;switch(e){case r.Token.PAREN_OP:l=r.Token.PAREN_CL;break;case r.Token.BRACKET_OP:l=r.Token.BRACKET_CL;break;case r.Token.BRACE_OP:l=r.Token.BRACE_CL;break;case r.Token.ABS:l=r.Token.ABS}if(o.tok!==l)return a("Mismatched parentheses",n),null}}if(t.length>0){const{pos:e}=t[0];return a("Unmatched parentheses",e),null}return e},c=e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o.tok===r.Token.ABS&&o.flags&r.TokenFlag.BEGIN_SCOPE){const l=t.pop();if(t.push({tok:o.tok,pos:n}),!l)continue;const s=e.splice(l.pos+1,n-l.pos-1);e.splice(l.pos,2),e.splice(l.pos,0,{tok:r.Token.ABS,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.PREFIX},{tok:r.Token.PAREN_OP,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.UNIQUE|r.TokenFlag.BEGIN_SCOPE},...s,{tok:r.Token.PAREN_CL,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.UNIQUE|r.TokenFlag.END_SCOPE}),n=l.pos+s.length+3,t.pop()}}for(let t=0;t<e.length;t++)e[t].tok===r.Token.MOUSE&&(e.splice(t,1,{tok:r.Token.MOUSEX,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE},{tok:r.Token.DELIM,val:0,flags:0},{tok:r.Token.MOUSEY,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE}),t+=2);for(let t=1;t<e.length;t++)e[t-1].flags&r.TokenFlag.IMPL_MULT_AFTER&&e[t].flags&r.TokenFlag.IMPL_MULT_BEFORE&&e.splice(t,0,{tok:r.Token.MULT,val:0,flags:0});for(let t=8;t>0;t--)for(let n=0;n<e.length;n++)if(l[e[n].tok]===t){let o=0,s=e.length,a=0;for(let s=n;s>=0;s--)if(e[s].flags&r.TokenFlag.BEGIN_SCOPE?a++:e[s].flags&r.TokenFlag.END_SCOPE&&a--,l[e[s].tok]<t&&0===a||a>0){o=s+1;break}a=0;for(let o=n;o<e.length;o++)if(e[o].flags&r.TokenFlag.BEGIN_SCOPE?a++:e[o].flags&r.TokenFlag.END_SCOPE&&a--,l[e[o].tok]<t&&0===a||a<0){s=o;break}e.splice(s,0,{tok:r.Token.PAREN_CL,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER|r.TokenFlag.UNIQUE|r.TokenFlag.END_SCOPE}),e.splice(o,0,{tok:r.Token.PAREN_OP,val:0,flags:r.TokenFlag.IMPL_MULT_BEFORE|r.TokenFlag.UNIQUE|r.TokenFlag.BEGIN_SCOPE}),n++}for(let t=0;t<e.length;t++)e[t].tok===r.Token.SUB&&(0===t||e[t-1].flags&r.TokenFlag.BEGIN_SCOPE)&&e.splice(t,0,{tok:r.Token.NUM,val:0,flags:r.TokenFlag.IMPL_MULT_AFTER});return e},T=e=>{let t=0;for(let n=0;n<e.length;n++)if(e[n].tok===r.Token.SUB)t++;else{if(t>1)if(t%2==1)for(let o=0;o<t-1;o++)e.splice(n-t,1);else{for(let o=0;o<t;o++)e.splice(n-t,1);e.splice(n-t,0,{tok:r.Token.ADD,val:0,flags:0})}t=0}for(let t=1;t<e.length;t++)e[t].flags&r.TokenFlag.END_SCOPE&&e[t-1].flags&r.TokenFlag.BEGIN_SCOPE&&e.splice(t-1,2);return e},g=e=>{const t={op:{tok:r.Token.NONE,val:0,flags:0},left:null,right:null};let n=t;const o=[];let l=0;for(let t=0;t<e.length;t++){const s=e[t];if(s.flags&r.TokenFlag.BEGIN_SCOPE)l++;else if(s.flags&r.TokenFlag.END_SCOPE){if(l<=0)return a("Unexpected end of scope",t),null;l--,n=o.pop();continue}if(null==n.op||n.op.tok===r.Token.NONE||n.op.flags&r.TokenFlag.BEGIN_SCOPE)n.op=s,n.op.flags&r.TokenFlag.BEGIN_SCOPE&&o.push(n);else if(null==n.left){if(n.op.flags&r.TokenFlag.PREFIX){n.left={op:{tok:r.Token.UNDEF,val:0,flags:0},left:null,right:null},n.right={op:s,left:null,right:null},n.right.op.flags&r.TokenFlag.BEGIN_SCOPE&&(o.push(n),n=n.right);continue}const e=JSON.parse(JSON.stringify(n));n.left=e,n.op=s}else if(null==n.right||n.right.op.flags&r.TokenFlag.BEGIN_SCOPE)n.right={op:s,left:null,right:null},n.right.op.flags&r.TokenFlag.BEGIN_SCOPE&&(o.push(n),n=n.right);else if(n.right.op.flags&r.TokenFlag.PREFIX&&null==n.right.right)o.push(n),n=n.right,n.right={op:s,left:null,right:null};else{const e=JSON.parse(JSON.stringify(n));n.left=e,n.right=null,n.op=s}}return 0!==l?(a("Unexpected end of expression",e.length),null):t}},320:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.inputSetDriverAt=t.inputSetStatusAt=t.inputSetConstEvalAt=t.inputSetErrorAt=t.inputSetColorAt=t.addNewInput=t.initLeftPanel=void 0;const o=n(607),r=n(533),l=n(195),s=n(283),a=n(750),i=document.querySelector(".inputs"),E=document.querySelector(".resize-left-panel");let u=0,c=0;t.initLeftPanel=function(){(0,a.onMouseDrag)(E,(e=>{const t=Math.max(250,Math.min(.95*window.innerWidth,e.x));document.documentElement.style.setProperty("--left-panel-width",`${t}px`),(0,o.scheduleRedraw)()})),(0,t.addNewInput)()},t.addNewInput=function(){const e=(0,s.stringToHTML)('\n\t<div class="input">\n\t<div class="status"><div class="indicator"></div></div>\n\t<input type="text" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off" autofocus>\n\t<div class="delete">×</div>\n\t<div class="const-eval"></div>\n\t</div>').firstChild,n=e.querySelector("input"),l=e.querySelector(".delete"),a=e.querySelector(".indicator");null==n||n.addEventListener("keydown",(function(e){if("Enter"===e.key){if(e.preventDefault(),c>u){const e=i.querySelector(`.input[data-input-idx="${++u}"]`);return g(e),void setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}(0,t.addNewInput)()}})),n.addEventListener("click",(function(t){g(e),u=parseInt(e.getAttribute("data-input-idx")||"0"),null==n||n.focus()})),null==n||n.addEventListener("focus",(function(t){g(e),u=parseInt(e.getAttribute("data-input-idx")||"0")})),null==n||n.addEventListener("input",(function(t){u=parseInt(e.getAttribute("data-input-idx")||"0"),a.classList.contains("disabled")?(0,r.setInputAt)(u,""):(0,r.setInputAt)(u,n.value)})),null==l||l.addEventListener("click",(function(t){if(1===c){e.classList.add("illegal");const t=e.querySelector("input");t&&(t.value="");const n=e.querySelector(".indicator");null==n||n.classList.remove("pending","active","error","disabled");const l=e.querySelector(".const-eval");return null==l||l.classList.remove("visible"),setTimeout((()=>e.classList.remove("illegal")),200),(0,o.scheduleRedraw)(),void(0,r.resetPlots)()}e.classList.add("deleted"),setTimeout((function(){e.remove();const t=parseInt(e.getAttribute("data-input-idx")||"0");c--,(0,r.setNumInputs)(c);const o=i.querySelectorAll(".input");for(let e=0;e<o.length;e++){o[e].setAttribute("data-input-idx",(e+1).toString());const t=o[e].querySelector(".indicator");(null==t?void 0:t.classList.contains("disabled"))?(0,r.setInputAt)(e+1,""):(0,r.setInputAt)(e+1,n.value)}if(c>0&&(t<=u||1===t)){const e=i.querySelector(`.input[data-input-idx="${u-1}"]`);g(e),setTimeout((function(){var t;null===(t=e.querySelector("input"))||void 0===t||t.focus()}),0)}}),120)})),null==a||a.addEventListener("click",(function(t){a.classList.toggle("disabled"),u=parseInt(e.getAttribute("data-input-idx")||"0"),a.classList.contains("disabled")?(0,r.setInputAt)(u,""):(0,r.setInputAt)(u,n.value)})),e.setAttribute("data-input-idx",(++u).toString()),e.classList.add("created"),setTimeout((function(){e.classList.remove("created")}),120),c++,(0,r.setNumInputs)(c),g(e),setTimeout((function(){null==n||n.focus()}),0),i.appendChild(e)};const T=function(e){return i.querySelector(`.input[data-input-idx="${e}"]`)};t.inputSetColorAt=function(e,t){var n;null===(n=T(e))||void 0===n||n.setAttribute("data-color",t)},t.inputSetErrorAt=function(e,t){const n=T(e);if(!n)return;const o=n.querySelector(".indicator");o&&o.setAttribute("data-error",t)},t.inputSetConstEvalAt=function(e,t){const n=T(e);if(!n)return;const o=n.querySelector(".const-eval");o&&(o.innerText="= "+t.toString(),o.classList.add("visible"))},t.inputSetStatusAt=function(e,t){const n=T(e);if(!n)return;const o=n.querySelector(".indicator");if(!o)return;o.classList.remove("pending","active","error");const r=n.querySelector(".const-eval");if(r)switch(t){case l.PlotStatus.PENDING:o.classList.add("pending"),o.innerHTML="",r.classList.remove("visible");break;case l.PlotStatus.ACTIVE:o.classList.add("active"),o.style.backgroundColor=n.getAttribute("data-color")||"#000",o.innerHTML="";break;case l.PlotStatus.ERROR:o.classList.add("error"),o.innerHTML="!",r.classList.remove("visible")}},t.inputSetDriverAt=function(e,t){const n=T(e);if(!n)return;const o=n.querySelector(".const-eval");o&&t!==l.PlotDriver.CONSTANT&&o.classList.remove("visible")};const g=function(e){i.querySelectorAll(".input").forEach((e=>{e.classList.remove("active")})),e.classList.add("active")}},139:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initMenuBar=void 0;const o=n(283),r=document.getElementById("menu-bar");t.initMenuBar=function(){Array.from(r.querySelectorAll("button")).forEach((e=>{const t=e.dataset.icon||"",n=e.dataset.href||"",r=e.dataset.filter||"";if(t&&n){const l='<div class="button-icon"></div>',s=(0,o.stringToHTML)(l).firstChild;s.style.backgroundImage=`url('${t}')`,s.style.filter=r,e.appendChild(s),e.addEventListener("click",(()=>{window.open(n,"_blank")}))}}))}},750:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initUserInteract=t.onMouseDrag=t.getMousePos=void 0;const o=n(283);let r,l=!1,s=!1;const a=new o.Vector(0,0),i=new Map;t.getMousePos=function(){return a},t.onMouseDrag=function(e,t){i.set(e,t)},t.initUserInteract=function(){document.addEventListener("mousedown",(function(e){s=!0})),document.addEventListener("mousemove",(function(e){if(s)if(a.set(e.clientX,e.clientY),l)r(a);else for(const[t,n]of i)if(null==t?void 0:t.contains(e.target))return n(a),l=!0,void(r=n)})),document.addEventListener("mouseup",(function(e){l=!1,s=!1}))}},283:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.map=t.sigmoid=t.factorial=t.perlin2=t.Vector=t.stringToHTML=void 0,t.stringToHTML=function(e){return(new DOMParser).parseFromString(e,"text/html").body},t.Vector=class{constructor(e,t){this.x=e,this.y=t}set(e,t){this.x=e,this.y=t}};const n=new Array(512),o=new Array(512),r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];class l{constructor(e,t,n){this.x=e,this.y=t,this.z=n}}const s=[new l(1,1,0),new l(-1,1,0),new l(1,-1,0),new l(-1,-1,0),new l(1,0,1),new l(-1,0,1),new l(1,0,-1),new l(-1,0,-1),new l(0,1,1),new l(0,-1,1),new l(0,1,-1),new l(0,-1,-1)];function a(e){return e*e*e*(e*(6*e-15)+10)}function i(e,t,n){return(1-n)*e+n*t}!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(let t=0;t<256;t++){let l;l=1&t?r[t]^255&e:r[t]^e>>8&255,n[t]=n[t+256]=l,o[t]=o[t+256]=s[l%12]}}(12345),t.perlin2=function(e,t){let r=Math.floor(e),l=Math.floor(t);e-=r,t-=l,r&=255,l&=255;const s=o[r+n[l]].dot2(e,t),E=o[r+n[l+1]].dot2(e,t-1),u=o[r+1+n[l]].dot2(e-1,t),c=o[r+1+n[l+1]].dot2(e-1,t-1),T=a(e);return i(i(s,u,T),i(E,c,T),a(t))},t.factorial=function(e){const t=Math.floor(e),n=e-t;let o=function(e){return(((((.07288448978215456*e-.31390051543712616)*e+.6538907084614038)*e-.810425715520978)*e+.9737655441276729)*e-.5761851668648887)*e+.9999830044034752}(n);if(e<0)for(let e=0;e<-t;e++)o/=n-e;else for(let e=1;e<t+1;e++)o*=n+e;return e>0?o:1/0},t.sigmoid=function(e){return 1/(1+Math.exp(-e))},t.map=function(e,t,n,o,r){return(e-t)/(n-t)*(r-o)+o}},607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGlobalTime=t.scheduleRedraw=void 0;const o=n(320),r=n(139),l=n(85),s=n(750),a=n(533);let i=!0,E=0;t.scheduleRedraw=function(){i=!0},t.getGlobalTime=()=>E,window.onload=function(){(0,s.initUserInteract)(),(0,r.initMenuBar)(),(0,o.initLeftPanel)(),(0,l.initCanvas)(),u()};const u=function(){i&&(i=!1,(0,l.canvasDraw)(),(0,a.drawPlots)()),(0,a.drivePlots)(),E+=.01,requestAnimationFrame(u)}}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,n),l.exports}(607)})();